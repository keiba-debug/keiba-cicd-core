# ç«¶é¦¬ãƒ–ãƒƒã‚¯ ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚·ã‚¹ãƒ†ãƒ  - ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

## ğŸ“Š ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦

ç«¶é¦¬ãƒ–ãƒƒã‚¯ï¼ˆkeibabook.co.jpï¼‰ã‹ã‚‰ç«¶é¦¬ãƒ‡ãƒ¼ã‚¿ã‚’è‡ªå‹•å–å¾—ãƒ»åˆ†æã™ã‚‹ã‚·ã‚¹ãƒ†ãƒ ã®çµ±åˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã™ã€‚

**æœ€çµ‚æ›´æ–°**: 2025å¹´2æœˆ4æ—¥  
**ã‚·ã‚¹ãƒ†ãƒ ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: v2.0ï¼ˆãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°å®Œäº†ï¼‰  
**ä¸»è¦æ©Ÿèƒ½**: ãƒ¬ãƒ¼ã‚¹æ—¥ç¨‹å–å¾—ã€ãƒ‡ãƒ¼ã‚¿å–å¾—ã€çµ±è¨ˆåˆ†æ

---

## ğŸ—‚ï¸ ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ§‹æˆ

### ğŸ“‹ åŸºæœ¬ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
| ãƒ•ã‚¡ã‚¤ãƒ« | å¯¾è±¡èª­è€… | å†…å®¹ |
|---------|---------|------|
| [setup_guide.md](setup_guide.md) | åˆå›åˆ©ç”¨è€… | ç’°å¢ƒæ§‹ç¯‰ãƒ»åˆæœŸè¨­å®š |
| [api_reference.md](api_reference.md) | é–‹ç™ºè€… | APIãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ |
| [configuration_guide.md](configuration_guide.md) | é‹ç”¨è€… | è¨­å®šãƒ»ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º |

### ğŸ“Š ãƒ‡ãƒ¼ã‚¿é–¢é€£
| ãƒ•ã‚¡ã‚¤ãƒ« | å¯¾è±¡èª­è€… | å†…å®¹ |
|---------|---------|------|
| [data_specification.md](data_specification.md) | ãƒ‡ãƒ¼ã‚¿åˆ†æè€… | ãƒ‡ãƒ¼ã‚¿æ§‹é€ ãƒ»ä»•æ§˜ |
| [usage_examples.md](usage_examples.md) | åˆ©ç”¨è€… | å®Ÿç”¨ä¾‹ãƒ»ã‚µãƒ³ãƒ—ãƒ« |

### ğŸ”§ é‹ç”¨ãƒ»ä¿å®ˆ
| ãƒ•ã‚¡ã‚¤ãƒ« | å¯¾è±¡èª­è€… | å†…å®¹ |
|---------|---------|------|
| [troubleshooting.md](troubleshooting.md) | é‹ç”¨è€… | ãƒˆãƒ©ãƒ–ãƒ«å¯¾å¿œ |
| [workflow_guide.md](workflow_guide.md) | å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ | å®Œå…¨ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ |

---

## ğŸš€ ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ

### 1. ç’°å¢ƒæ§‹ç¯‰
```bash
# ä¾å­˜é–¢ä¿‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
pip install -r requirements.txt

# è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆ
python -m src.keibabook.batch_cli --help
```

### 2. åŸºæœ¬çš„ãªä½¿ç”¨æ–¹æ³•
```bash
# ãƒ¬ãƒ¼ã‚¹æ—¥ç¨‹å–å¾—
python -m src.keibabook.batch_cli schedule --start-date 2025/02/01

# ãƒ¬ãƒ¼ã‚¹ãƒ‡ãƒ¼ã‚¿å–å¾—  
python -m src.keibabook.batch_cli data --start-date 2025/02/01 --data-types seiseki

# å…¨å‡¦ç†å®Ÿè¡Œï¼ˆæ—¥ç¨‹â†’ãƒ‡ãƒ¼ã‚¿ï¼‰
python -m src.keibabook.batch_cli full --start-date 2025/02/01
```

### 3. æ—¢å­˜ã‚·ã‚¹ãƒ†ãƒ ã¨ã®äº’æ›æ€§
```bash
# å¾“æ¥ã®main.pyã‚‚å¼•ãç¶šãåˆ©ç”¨å¯èƒ½
python src/keibabook/main.py --race-id 202502041211 --mode scrape_and_parse
```

---

## ğŸ—ï¸ ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆ

### æ–°ã—ã„çµ±åˆã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ï¼ˆv2.0ï¼‰

```
src/keibabook/
â”œâ”€â”€ ğŸ“ batch/                   # ğŸ†• çµ±åˆãƒãƒƒãƒå‡¦ç†ã‚·ã‚¹ãƒ†ãƒ 
â”‚   â”œâ”€â”€ core/
â”‚   â”‚   â””â”€â”€ common.py           # å…±é€šãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â”‚   â”œâ”€â”€ data_fetcher.py         # ãƒ‡ãƒ¼ã‚¿å–å¾—ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«
â”‚   â””â”€â”€ __init__.py
â”œâ”€â”€ ğŸ“ scrapers/                # ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ‘ãƒ¼ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«
â”‚   â”œâ”€â”€ legacy_scrapers.py      # ğŸ†• ãƒ¬ã‚¬ã‚·ãƒ¼æ©Ÿèƒ½çµ±åˆ
â”‚   â”œâ”€â”€ requests_scraper.py     
â”‚   â””â”€â”€ keibabook_scraper.py
â”œâ”€â”€ ğŸ“ parsers/                 # ãƒ‘ãƒ¼ã‚µãƒ¼ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«
â”œâ”€â”€ ğŸ“ utils/                   # ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â”œâ”€â”€ batch_cli.py                # ğŸ†• çµ±åˆCLIã‚·ã‚¹ãƒ†ãƒ 
â”œâ”€â”€ main.py                     # å¾“æ¥ãƒ¡ã‚¤ãƒ³ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
â””â”€â”€ auth.py                     # èªè¨¼æ©Ÿèƒ½
```

### ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°åŠ¹æœ
- **ãƒ•ã‚¡ã‚¤ãƒ«æ•°**: 28å€‹ â†’ 11å€‹ï¼ˆ**61%å‰Šæ¸›**ï¼‰
- **é‡è¤‡ã‚³ãƒ¼ãƒ‰**: å¤§å¹…å‰Šé™¤
- **ä¿å®ˆæ€§**: ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åŒ–ã«ã‚ˆã‚Šå‘ä¸Š
- **æ–°æ©Ÿèƒ½**: çµ±åˆCLIã€çµ±è¨ˆç®¡ç†ã€é€²æ—è¡¨ç¤º

---

## ğŸ“š ä¸»è¦æ©Ÿèƒ½

### ğŸ”„ ãƒãƒƒãƒå‡¦ç†ã‚·ã‚¹ãƒ†ãƒ ï¼ˆv2.0ï¼‰
æ–°ã—ã„çµ±åˆCLIã‚·ã‚¹ãƒ†ãƒ ã§ä»¥ä¸‹ã®æ©Ÿèƒ½ã‚’æä¾›ï¼š

1. **ãƒ¬ãƒ¼ã‚¹æ—¥ç¨‹å–å¾—** (`schedule`)
   - ç«¶é¦¬ãƒ–ãƒƒã‚¯ã‹ã‚‰ãƒ¬ãƒ¼ã‚¹æ—¥ç¨‹ã‚’å–å¾—
   - ãƒ¬ãƒ¼ã‚¹IDã®è‡ªå‹•ç”Ÿæˆãƒ»ä¿å­˜

2. **ãƒ¬ãƒ¼ã‚¹ãƒ‡ãƒ¼ã‚¿å–å¾—** (`data`)
   - æˆç¸¾ã€å‡ºé¦¬è¡¨ã€èª¿æ•™ã€å©èˆã®è©±ãƒ‡ãƒ¼ã‚¿
   - ä¸¦åˆ—å‡¦ç†å¯¾å¿œ

3. **å…¨å‡¦ç†å®Ÿè¡Œ** (`full`)
   - æ—¥ç¨‹å–å¾—ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿å–å¾—ã¾ã§ä¸€æ‹¬å®Ÿè¡Œ
   - é€²æ—è¡¨ç¤ºãƒ»çµ±è¨ˆã‚µãƒãƒªãƒ¼

### ğŸ› ï¸ å¾“æ¥æ©Ÿèƒ½ï¼ˆäº’æ›æ€§ç¶­æŒï¼‰
- å˜ä¸€ãƒ¬ãƒ¼ã‚¹ã®è©³ç´°å–å¾—
- HTMLãƒ‘ãƒ¼ã‚¹ãƒ»ãƒ‡ãƒ¼ã‚¿æŠ½å‡º
- èªè¨¼ãƒ»ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†

---

## ğŸ’¡ ä½¿ç”¨ä¾‹

### åŸºæœ¬çš„ãªãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼
```bash
# 1. ä»Šé€±ã®ãƒ¬ãƒ¼ã‚¹æ—¥ç¨‹ã‚’å–å¾—
python -m src.keibabook.batch_cli schedule \
  --start-date $(date +%Y/%m/%d) \
  --end-date $(date -d '+7 days' +%Y/%m/%d)

# 2. ä»Šæ—¥ã®ãƒ¬ãƒ¼ã‚¹ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
python -m src.keibabook.batch_cli data \
  --start-date $(date +%Y/%m/%d) \
  --data-types seiseki,shutsuba

# 3. ç‰¹å®šãƒ¬ãƒ¼ã‚¹ã®è©³ç´°åˆ†æ
python src/keibabook/main.py \
  --race-id 202502041211 \
  --mode scrape_and_parse
```

### è‡ªå‹•åŒ–ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
```bash
# Windows PowerShell
.\scripts\daily_batch.ps1

# Linux/macOS
./scripts/daily_batch.sh
```

---

## âš™ï¸ è¨­å®šãƒ»ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º

### ç’°å¢ƒå¤‰æ•°è¨­å®š
```bash
# .env ãƒ•ã‚¡ã‚¤ãƒ«
KEIBA_DATA_DIR=/path/to/data           # ãƒ‡ãƒ¼ã‚¿ä¿å­˜å…ˆ
KEIBABOOK_SESSION=session_value        # èªè¨¼æƒ…å ±
KEIBABOOK_TK=tk_value                  # èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³
LOG_LEVEL=INFO                         # ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«
```

### è©³ç´°è¨­å®š
- **ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ **: [configuration_guide.md](configuration_guide.md)
- **èªè¨¼è¨­å®š**: [setup_guide.md](setup_guide.md)
- **ãƒ‡ãƒ¼ã‚¿å½¢å¼**: [data_specification.md](data_specification.md)

---

## ğŸ” ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚ˆãã‚ã‚‹å•é¡Œ
1. **èªè¨¼ã‚¨ãƒ©ãƒ¼** â†’ Cookieã®æ›´æ–°ãŒå¿…è¦
2. **ãƒ‘ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼** â†’ HTMLãƒ•ã‚¡ã‚¤ãƒ«ã®æ§‹é€ ç¢ºèª
3. **ãƒ•ã‚¡ã‚¤ãƒ«æ¨©é™** â†’ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®æ¨©é™è¨­å®š

### ãƒ‡ãƒãƒƒã‚°æ–¹æ³•
```bash
# è©³ç´°ãƒ­ã‚°ä»˜ãã§å®Ÿè¡Œ
python -m src.keibabook.batch_cli full \
  --start-date 2025/02/01 \
  --debug

# è¨­å®šç¢ºèª
python tools/config_manager.py --show
```

è©³ç´°ã¯ [troubleshooting.md](troubleshooting.md) ã‚’å‚ç…§

---

## ğŸ†• v2.0ã®æ–°æ©Ÿèƒ½

### çµ±åˆCLIã‚·ã‚¹ãƒ†ãƒ 
- 3ã¤ã®ã‚µãƒ–ã‚³ãƒãƒ³ãƒ‰ï¼ˆschedule/data/fullï¼‰
- é€²æ—è¡¨ç¤ºãƒ»çµ±è¨ˆæƒ…å ±
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°å¼·åŒ–

### å…±é€šãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
- é‡è¤‡ã‚³ãƒ¼ãƒ‰ã®çµ±åˆ
- çµ±ä¸€ã•ã‚ŒãŸãƒ­ã‚°ãƒ»è¨­å®šç®¡ç†
- BatchStats ã«ã‚ˆã‚‹è©³ç´°çµ±è¨ˆ

### ãƒ¬ã‚¬ã‚·ãƒ¼æ©Ÿèƒ½ã®ä¿æŒ
- æ—¢å­˜ã® main.py ã¯å¤‰æ›´ãªã—
- å…¨ã¦ã®æ—§æ©Ÿèƒ½ãŒ legacy_scrapers.py ã§åˆ©ç”¨å¯èƒ½
- è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®äº’æ›æ€§ç¶­æŒ

---

## ğŸ”— é–¢é€£ãƒªãƒ³ã‚¯

- **ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆ**: `../../`
- **ã‚¹ã‚¯ãƒªãƒ—ãƒˆé›†**: `../../scripts/`
- **è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«**: `../../.env`
- **ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«**: `../../logs/`

---

## ğŸ“ ã‚µãƒãƒ¼ãƒˆ

### é–‹ç™ºè€…å‘ã‘
- APIè©³ç´°: [api_reference.md](api_reference.md)
- è¨­å®šæ–¹æ³•: [configuration_guide.md](configuration_guide.md)

### åˆ©ç”¨è€…å‘ã‘
- å°å…¥æ–¹æ³•: [setup_guide.md](setup_guide.md)
- ä½¿ç”¨ä¾‹: [usage_examples.md](usage_examples.md)

### é‹ç”¨è€…å‘ã‘
- è‡ªå‹•åŒ–: `../scripts/`
- ç›£è¦–: [troubleshooting.md](troubleshooting.md)

---

**æœ€çµ‚æ›´æ–°**: 2025å¹´2æœˆ4æ—¥  
**ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°**: v1.0 â†’ v2.0 å®Œäº†  
**æ¬¡æœŸè¨ˆç”»**: ä¸¦åˆ—å‡¦ç†ã€WebUIã€æ©Ÿæ¢°å­¦ç¿’é€£æº