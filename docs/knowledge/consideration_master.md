# 競馬AI×機械学習 考察マスター

今後の開発のために、既存の気づきを土台に**考察を加速・発展**させるための包括ドキュメント。
ナレッジベース全体の「羅針盤」として使い、新しいテーマの立案・優先付け・深掘りの指針とする。

> 最終更新: 2026-02-12

---

## 1. このドキュメントの使い方

| 目的 | 使い方 |
|------|--------|
| **全体像を押さえたい** | セクション2「世界観の統合」→ セクション4「テーママップ」を順に読む |
| **あるテーマを深掘りしたい** | セクション4で該当テーマを探し、「参照insights」と「次の問い」から進める |
| **新しい考察テーマを立てたい** | セクション5「考察を加速するフレーム」に従い、問いを立ててから該当insightに紐づける |
| **何を検証すべきか決めたい** | [仮説検証計画マスター](insights/hypothesis_verification_master.md) と本ドキュメントのテーママップを照合 |
| **用語・MLの基礎を確認したい** | [ML用語集](insights/ml_glossary.md)・[ML学習ロードマップ](insights/ml_learning_roadmap.md) を参照 |

---

## 2. 世界観の統合：既存の気づきが指し示す6本柱

これまでのブログ考察・insightsから抽出した「競馬AI×機械学習」の**共通世界観**。  
今後の考察は、この世界観を拡張・精緻化する形で進めると一貫する。

### 柱1: 確率論的競馬観とオッズの歪み

- **着順は確率変数**。予測の本質は確率分布であり、評価はキャリブレーション（較正精度）。
- **利益の源泉はオッズの歪み**。AI予測確率と市場オッズの乖離を突く。予測精度向上と利益は別問題。
- **人間の認知バイアス**（Favorite-Longshot、応援馬券、均等配分等）が歪みを生む → AIの優位性。

**参照**: [松風ブログ核心知見](insights/matsukaze_core_insights.md) 1–3, [馬券市場の構造的非効率性](insights/market_structural_inefficiencies.md), [ランダムネスの認知錯誤](insights/randomness_cognitive_errors.md)

---

### 柱2: 収支最大化 ≠ 回収率最大化

- **EV > 1.0 の馬券を漏らさず購入**し、購入点数・バンクロール回転率を上げる。
- 回収率115%は「結果」であり「目標」ではない。回収率を下げてでも購入量を増やす戦略が利益・安定性の両面で有効。
- 税務設計（雑所得要件）を最初から設計に織り込む。

**参照**: [松風ブログ核心知見](insights/matsukaze_core_insights.md) 1, 4, [回収率と購入量のトレードオフ](insights/roi_volume_tradeoff.md), [バンクロール管理の原則](insights/bankroll_management_principles.md)

---

### 柱3: 特徴量とターゲットが全て。アルゴリズムは道具

- **差別化は特徴量と目的変数の設計**から生まれる。アルゴリズム選択は「何でもいい」に近い。
- 特徴量は「仮説駆動（人間）」と「データ駆動（AI/自動化）」の二層。評価指標・検証方法の設計は人間の責務。
- **着順以外の目的変数**（能力スコア・着差・パフォーマンス指標）の設計が、モデルの天井を決める。

**参照**: [松風ブログ核心知見](insights/matsukaze_core_insights.md) 5, [特徴量設計とハイパラ: 人間 vs AI](insights/human_vs_ai_in_model_design.md), [着順以外の目的変数](insights/alternative_target_variables.md), [features.md](features.md)

---

### 柱4: 過学習の徹底回避と検証の設計

- **少数条件分けは平均回帰**。細かい条件での「好成績」はノイズにフィットしがち。
- 時系列分割・Walk-Forward検証が必須。ランダム分割はデータリーク。
- 仮説は**事前に定義し、検証結果に応じて代替戦略を用意**する。

**参照**: [松風ブログ核心知見](insights/matsukaze_core_insights.md) 6, [仮説検証計画マスター](insights/hypothesis_verification_master.md), [ML学習ロードマップ](insights/ml_learning_roadmap.md) Level 1–3

---

### 柱5: 購入決定の分離と運用リスク

- **Themisの思想**: 購入決定は「確率・オッズ・バンクロール」だけを入力とする。馬名・騎手名は知らない。
- **最大のリスクはモデルではなく運用**（障害・入金忘れ・チューニングの攻めすぎ・バグ）。完全自動化と保守的パラメータ、バンクロール同期の一貫性が重要。
- 馬券種は**ポートフォリオ**として扱い、相関の低い組み合わせでリスク分散。

**参照**: [松風ブログ核心知見](insights/matsukaze_core_insights.md) 8–13, [運用アーキテクチャ設計指針](insights/operations_architecture_principles.md), [バンクロール管理の原則](insights/bankroll_management_principles.md)

---

### 柱6: 能力はスカラーではなくベクトル。条件×能力の適合

- **能力の方向性は条件で変わる**。1つの「強さ」ではなく、距離・馬場・ペース・コースなどに対する適合度のベクトルとして扱うと、穴馬・条件特化馬の構造が説明しやすくなる。
- 着順だけでなく**着差・スピード指数・上がり3Fギャップ・負けの質**など、多様な評価軸を目的変数や特徴量に取り込む余地がある。
- HarvilleのIIA前提の限界を踏まえ、**条件付き確率・着順の依存関係**を明示的にモデル化する方向が有効。

**参照**: [能力はスカラーではなくベクトル](insights/ability_is_not_scalar.md), [着順以外の目的変数](insights/alternative_target_variables.md), [着順以外の評価基準](insights/beyond_finishing_position.md), [着順バイアス](insights/finishing_position_vs_margin_bias.md), [HarvilleのIIA批判](insights/harville_iia_critique.md), [馬の着順分布の形状](insights/horse_performance_distribution.md)

---

## 3. 洞察のつながり（簡易マップ）

```
[確率論的競馬観] ──→ [キャリブレーション重視] ──→ [EV計算・購入判断]
       │                        │                        │
       └──→ [オッズの歪み] ──→ [市場非効率性] ──→ [三連単・組合せ確率]
                                      │                  │
[特徴量・ターゲット設計] ←─────────────┼──→ [人間vsAI分業]  │
       │                              │                  │
       ├──→ [過学習回避] ←── [仮説検証計画]              │
       │         │                                       │
       └──→ [能力ベクトル×条件適合] ──→ [展開・ペース・着差]
                    │
[運用・Themis・バンクロール] ←── [ポートフォリオ・税務]
       │                              │
       └──→ [モジュール分離・状態管理] │
                                       │
[競合戦略・参入障壁] ←── [独自データ投資・規模の経済]
```

- **上流**: 世界観・評価の設計（確率論、歪み、特徴量/ターゲット）
- **中流**: モデルと検証（過学習、仮説検証、能力ベクトル×条件適合）
- **下流**: 購入・運用・法務（Themis、バンクロール、税務、モジュール分離）
- **外環**: 競合環境・市場構造（参入障壁、独自データ投資、オッズの食い合い）

新しい考察は「どの柱／どのレイヤーを拡張するか」を意識すると、既存ナレッジと接続しやすい。

---

## 4. テーマ別マップ：参照と「次の問い」

各テーマについて、**要点・参照すべきinsights・今後の考察を促す問い**を整理する。

### 4-1. 戦略・思想

| テーマ | 要点 | 参照insights | 次の問い |
|--------|------|--------------|----------|
| 確率論的競馬観 | 確率推定・較正が本質。的中率で判断しない | matsukaze_core_insights, randomness_cognitive_errors | 較正を条件別（芝/ダート/頭数）に検証するとどうか |
| オッズの歪み | 乖離が利益の源泉。FLB・応援馬券・均等配分 | market_structural_inefficiencies, blog-001 | 歪みの時系列変化・競合AIの影響は |
| 収支vs回収率 | EV>1.0全購入。回収率は結果 | roi_volume_tradeoff, bankroll_management_principles | 税引後EV・購入レース比率とEV閾値の同時最適化は |
| 税務設計 | 雑所得要件を設計に織り込む | blog-010, matsukaze_core_insights §4 | 購入証跡・自動チェックの仕様は十分か |
| 競合戦略・参入障壁 | 規模の優位性・独自データ・オッズの食い合い | blog-012, blog-002 | 後発参入のエッジをどこに求めるか。独自データ投資のROI検討 |

### 4-2. モデル・特徴量・ターゲット

| テーマ | 要点 | 参照insights | 次の問い |
|--------|------|--------------|----------|
| 特徴量設計 | 仮説駆動（人間）×データ駆動（AI）。第一層が差別化 | human_vs_ai_in_model_design, features | 新データソース（映像・コメント）の特徴量化は |
| 目的変数 | 着順以外の設計が天井を決める。能力スコア・着差 | alternative_target_variables, beyond_finishing_position | パフォーマンススコアの三層（自動/ルール/人間）の実装方針は |
| 能力ベクトル | 能力はスカラーでなく条件別適合のベクトル | ability_is_not_scalar, horse_performance_distribution | 条件×能力の交互作用をどう特徴量化するか |
| 過学習回避 | 少数条件分けは平均回帰。時系列分割必須 | matsukaze_core_insights §6, hypothesis_verification_master H-14 | 新特徴量追加時のリークチェックリストは |
| モデル分離 | 芝/ダート/障害の分離判断。サンプル数閾値 | model_separation_strategy | 距離帯・馬場別のサブモデルは必要か |
| 馬主特徴量 | 馬主タイプ・成績。応援馬券と能力の代理 | owner_as_feature | 馬主クラブフラグのオッズ歪み検証（H-09）の結果は |
| 独自データ投資 | 目視データ・映像解析が最大の差別化。データはパワー | blog-012 | 取得可能な独自データの費用対効果。レース映像解析の自動化は |

### 4-3. 市場・オッズ・馬券種

| テーマ | 要点 | 参照insights | 次の問い |
|--------|------|--------------|----------|
| 構造的非効率性 | 均等配分・FLB・条件付き確率の無視等 | market_structural_inefficiencies | 三連単の条件付き確率モデルの具体的設計は |
| 組合せ馬券確率 | Harville/Henery。条件付き確率の正しい計算 | combination_ticket_probability, harville_iia_critique | IIA違反を緩和する段階的改善（Thurstone等）の実装は |
| ワイドEV | 3着全候補の条件付き期待値の合算 | matsukaze_core_insights §10, blog-007 | 三連単EVの全組合せ計算と購入フィルタの効率化は |
| ポートフォリオ | 馬券種間相関。ワイド+枠連等の分散 | bankroll_management_principles, blog-008 | 馬券種比率の最適化・事後選択バイアスの検証は |
| 三連単展開 | 三連単の導入で利益が急増。高分散×高リターン | blog-012, combination_ticket_probability | 三連単EVの精度要求と購入点数の最適化は |
| 馬券種の事後選択バイアス | 負け馬券種を止める＝サイコロ100個の偏り選び | blog-012, randomness_cognitive_errors | レート変動を除いた均等ベースでの馬券種評価方法は |

### 4-4. 展開・ペース・レース構造

| テーマ | 要点 | 参照insights | 次の問い |
|--------|------|--------------|----------|
| 展開シミュレーション | 脚質×ペース×出遅れ。レベル0〜3の段階的アプローチ | race_scenario_simulation | ペース予測の精度と、それを特徴量にしたときの寄与は |
| 脚質サブタイプ | スロー捲り型 vs ハイペース追込型。ペース適性 | closer_subtypes_slow_vs_highpace | 差し馬サブタイプ×予想ペースの交互作用の効果は |
| ポジショニング・出たなり | ポジションコスト。逃げ馬の外の恵み | positioning_cost_and_natural_running, start_to_first_corner_gate_bias | 1コーナー距離×枠番×頭数の定数テーブルは十分か |
| マクリ・ペースクラッシャー | マクリ検出。先行馬への道連れ効果 | pace_crasher_and_makuri | 被害馬の次走戦略を特徴量に含めるか |
| スムーズな走り | 展開予測は必須か。不利の4類型。特徴量で8割 | smooth_trip_without_simulation | 「予測より回避」の特徴量セットは十分か |

### 4-5. 評価・着順・パフォーマンス

| テーマ | 要点 | 参照insights | 次の問い |
|--------|------|--------------|----------|
| 着順vs着差 | 序数思考バイアス。0.5秒差5着と0.2秒差6着 | finishing_position_vs_margin_bias | 着差weightを目的変数や損失に組み込む設計は |
| 盛り返しパターン | 位置を下げてから盛り返す＝充実の証拠 | rally_after_dropping_position | 盛り返し強度の閾値と馬券種別の効き方は |
| 環境物理学 | 空気抵抗・気温・風・含水率。馬体重×風等 | environmental_physics | 気象データの取得コストと効果のトレードオフは |
| ローテーション | 間隔・叩き2戦目・消耗度・臨戦過程 | rotation_interval_analysis | 休養明け日数と「実戦勘」の交互作用は |

### 4-6. 運用・アーキテクチャ・検証

| テーマ | 要点 | 参照insights | 次の問い |
|--------|------|--------------|----------|
| Themis・購入決定 | 確率・オッズ・バンクロールのみ。目隠し設計 | operations_architecture_principles, matsukaze_core_insights §8 | 購入実行と記録の改ざん防止・監査ログは |
| バンクロール・破産確率 | 追い下げ。複利の二面性。safety_factor | bankroll_management_principles, blog-008, blog-009 | 最適safety_factor・EV閾値のモンテカルロ設計は |
| 仮説検証 | 20仮説の優先度・Phase別実行・棄却時の代替 | hypothesis_verification_master | Phase 1検証の結果を次の特徴量・モデルにどう反映するか |
| 予測の説明可能性 | SHAP・馬ごとの好材料・懸念材料。インタビュー機能 | prediction_interview_feature | 購入理由の説明と税務・監査要件の整合は |
| モジュール分離・状態管理 | 松風8モジュール構成。プロセス間のバンクロール同期 | operations_architecture_principles, blog-011 | マルチプロセス運用時の状態同期方式の選定は |
| 開発速度vs安定性 | バグで200万損でも改善速度を優先。テスト戦略 | blog-011 | バンクロール更新の一貫性テスト・CI設計は |
| データ品質管理 | 品質ゲート（スキーマ検証・異常検出）でGIGO防止 | data_engineering_roadmap Phase 1-2 | pandera/pydantic での品質チェック自動化は |
| ETL・データウェアハウス | JSON→SQL Server のETL構築。増分更新・分析ビュー | data_engineering_roadmap Phase 3, blog-011（Zeus） | 既存スキーマを活用した日次ETLの設計は |
| パイプライン自動化・監視 | 収集→品質→DB→特徴量の一気通貫。障害検知 | data_engineering_roadmap Phase 4, operations_architecture_principles | Prefect等のオーケストレーション選定は |
| データ鮮度・完全性 | 「今日のデータがまだ来ていない」の検知 | data_engineering_roadmap Phase 4 | 日次/週次バッチの監視ダッシュボード設計は |

---

## 5. 考察を加速するフレーム：新テーマの立て方と優先付け

### 5-1. 新しい考察テーマの立て方

1. **起点を明示する**  
   「〇〇について考察したい」「△△の知見を深めたい」を一文で書く。
2. **既存の柱・テーマに紐づける**  
   セクション2の6本柱のどれを拡張するか、セクション4のどのテーマと隣接するかを書く。
3. **問いを具体化する**  
   「〇〇は有効か」「△△を特徴量にするとどうか」「□□の検証方法は」など、答え可能な問いに落とす。
4. **成果の置き場を決める**  
   - 新規insight → `insights/` に新ファイル。READMEの横断整理に1行追加。  
   - 特徴量候補 → [features.md](features.md) に追記。  
   - 検証仮説 → [仮説検証計画マスター](insights/hypothesis_verification_master.md) にID付きで追加。  
   - ブログ考察の要約 → `blog-analyses/` に番号付き。必要ならinsightsに横断整理。

### 5-2. 優先付けの考え方

| 優先度 | 条件 | 例 |
|--------|------|-----|
| 高 | 仮説検証・モデル設計・運用リスクに直結。データが揃っている | H-03 FLB検証、キャリブレーション条件別、Themisの入出力仕様 |
| 中 | 差別化・精度向上に効く。実装難度は中 | 三連単条件付き確率、能力ベクトル特徴量、ペース×脚質交互作用 |
| 低 | 知見の拡張・将来の種。実装難度高 or データ不足 | 映像解析、LLM×コメント、対抗的オッズシミュレーション |

**松風の教訓**: 「検証に時間をかけすぎない。80%の確信で実装開始し、実運用データで再検証するサイクルを回す」（仮説検証マスター 6-6）

### 5-3. 考察の深掘りパターン

- **分解**: テーマをサブテーマに分ける（例: 三連単 → 条件付き確率 / EV計算 / 購入フィルタ / 歪みの検証）。
- **接続**: 別のinsightとの接続を書く（例: 市場非効率性 × 組合せ確率 × 馬主クラブ）。
- **反証**: 「〇〇が成り立たない場合はどうするか」を事前に考える（仮説検証マスターの「棄却時の代替」）。
- **定量化**: 可能なら検証方法・成功基準・必要データをセクションに含める。

### 5-4. データ分析スキルと6本柱の関係

データサイエンスの分析手法（記述統計・可視化・クロス集計・相関分析・統計検定等）は、特定の柱だけでなく**全柱に通底する基盤スキル**として位置づける。

| 分析手法 | 関わる柱 | 具体的な使い方 |
|----------|----------|----------------|
| 記述統計・EDA・可視化 | 全柱 | データの姿を知る出発点。キャリブレーションプロット、バンクロール推移、特徴量分布の確認 |
| 相関分析 | 柱3, 柱5 | 特徴量間の多重共線性除去（柱3）、馬券種間の相関行列でポートフォリオ設計（柱5） |
| クロス集計 | 柱3, 柱6 | 特徴量設計の仮説生成。ただし「仮説の検証」に使うと過学習（柱4の教訓） |
| 統計検定 | 柱1, 柱4 | 回収率の有意性判定（柱1）、過学習の検出・多重検定補正（柱4） |
| 回帰分析 | 柱3 | ベースラインモデル。LightGBMの効果を測る比較対象 |

これらは「Level 0 で学んで卒業」ではなく、モデリングの前・中・後のすべてのフェーズで継続的に使う。詳細は [ML学習ロードマップ Level 0](insights/ml_learning_roadmap.md) を参照。

---

## 6. ナレッジベース案内：何を知りたいときにどこを見るか

| 知りたいこと | 見る場所 |
|--------------|----------|
| 思想・戦略・松風の教訓の要約 | [松風ブログ核心知見](insights/matsukaze_core_insights.md) |
| 何を検証すべきか・Phase別計画 | [仮説検証計画マスター](insights/hypothesis_verification_master.md) |
| 特徴量の候補・実装難度・出典 | [features.md](features.md) |
| 市場の歪み・三連単・FLB | [馬券市場の構造的非効率性](insights/market_structural_inefficiencies.md) |
| 人間とAIの役割分担・特徴量設計 | [特徴量設計とハイパラ: 人間 vs AI](insights/human_vs_ai_in_model_design.md) |
| データ分析の基礎・EDA・統計検定 | [ML学習ロードマップ Level 0](insights/ml_learning_roadmap.md)（記述統計・可視化・クロス集計・相関分析・統計検定） |
| 学習の順序・Level別トピック | [ML学習ロードマップ](insights/ml_learning_roadmap.md) |
| 用語の定義（Target Encoding等） | [ML用語集](insights/ml_glossary.md) |
| 運用・モジュール・Themis・障害教訓 | [運用アーキテクチャ設計指針](insights/operations_architecture_principles.md) |
| データ品質・ETL・パイプライン基盤 | [データエンジニアリング実践ロードマップ](insights/data_engineering_roadmap.md) |
| 資金管理・EV閾値・ポートフォリオ | [バンクロール管理の原則](insights/bankroll_management_principles.md) |
| 目的変数の設計・着順以外 | [着順以外の目的変数](insights/alternative_target_variables.md), [着順以外の評価基準](insights/beyond_finishing_position.md) |
| 能力の多次元性・穴馬の構造 | [能力はスカラーではなくベクトル](insights/ability_is_not_scalar.md) |
| ブログ考察の一覧・タグ | [README 考察ドキュメント一覧](README.md#考察ドキュメント一覧) |
| 全体のテーマと次の問い | **本ドキュメント セクション4** |

---

## 7. メンテナンスと更新

- **新規insight追加時**: 本ドキュメントのセクション4の該当テーマに1行追加し、「次の問い」を更新する。
- **新規ブログ考察時**: READMEの一覧とタグを更新。必要に応じて松風核心知見・仮説検証マスターに反映。
- **仮説検証の結果**: 仮説検証マスターに結果を記録し、本ドキュメントの「次の問い」や優先付けに反映する。
- **定期的な見直し**: 四半期ごとにセクション4・5の「次の問い」と優先度をレビューし、完了した問いを整理・新問いを追加する。

---

## タグ

`#考察` `#モデル` `#特徴量` `#馬券戦略` `#運用` `#確率論` `#ナレッジベース`
