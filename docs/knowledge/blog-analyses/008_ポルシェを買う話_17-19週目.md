# 競馬AIでポルシェを買う話 17〜19週目（馬券ポートフォリオ理論）

- **出典**: Matsukaze.AI「競馬AIでポルシェを買う話」
  - 17週目: http://matsukaze.ai/?p=763 (2019-01-21)
  - 18週目: http://matsukaze.ai/?p=789 (2019-01-21)
  - 19週目: http://matsukaze.ai/?p=794 (2019-01-29)
- **日付**: 2025-02-11
- **前編**: [007 ポルシェを買う話 6-11週目](007_ポルシェを買う話_6-11週目.md)

## 収支サマリー

| 週 | バンクロール | 週次回収率 | 累計複利回収率 | 購入金額 | 備考 |
|---|---|---|---|---|---|
| 11週目 | 301,340円 | 122% | 60% | 247,800円 | 前回最終 |
| (12-16週目) | - | - | - | - | 記事省略 |
| 17週目 | 899,400円 | 155% | 179% | 957,300円 | 新値更新 |
| 18週目 | 969,410円 | 105% | 193% | 1,203,800円 | 枠連・ワイドの相関論 |
| 19週目 | 1,607,770円 | 154% | 321% | 1,167,900円 | バンク100万突破 |

8週目の最安値8万円 → 19週目の160万円 = **約2ヶ月で20倍**

## 要点

### 17週目: パレートの法則（80:20）

- 「競馬で勝った日って、全体の2割のレースで全体の8割の払戻を稼いでいる」
- 日次に適用しても、年間の2割の日が8割の稼ぎを出す
- **8割のレースで当てようとすると、おかしくなる**
- 「的中もケチャップみたいなもの。出ない時は出ないけど、出る時はドバドバ出る」（ファンニステルロイの名言）
- 8万→89万（10倍）の回復は、少数の好調期に集中している

### 18週目: 馬券種ポートフォリオ理論 ★★★（最重要）

#### なぜワイドと枠連なのか

> ワイドと枠連はいずれも的中率が高く、シミュレーションでの収支の分散が小さく、パフォーマンスが良く、それでいて相関が低い

選定理由:
1. **的中率が高い** → 大数の法則に乗せやすい
2. **収支の分散が小さい** → 安定性
3. **パフォーマンス（EV）が良い** → 期待値プラス
4. **相互の相関が低い** → リスクヘッジ

#### 馬券種間の的中相関の問題

- 単勝と複勝は**独立ではない**: 複勝が外れたら単勝は必ず外れる
- ブラジルとアルゼンチンの国債の同時デフォルト確率 ≠ 各国のデフォルト確率の積
- **馬連と枠連は相関が鬼高い** → 同時に持つ意味が薄い
- ワイドと枠連は相関が低い → 同時保有でリスク分散が効く

#### 複数馬券種の最適化は「だるい」

> ワイドと馬連と3連複と…の複数の馬券種をひとまとめにした群の的中の相関を計算して、リスクを計算して、購入金額を最適化して、それをまた各馬券に割り振るっていうのが結構だるい

- 「ゆるふわな資金配分」で済むのがワイド+枠連の利点
- 馬連追加には本格的なポートフォリオ最適化が必要
- **バンクロール100万超で3連複を解放予定**（→より複雑な最適化が必要に）

### 19週目: 複利と破産確率の非直感的関係

> 複利の悪いところは、バンクロールが増えても破産確率が（それほど）下がらない。
> 50万円あっても500万円あっても、破産確率はあんまし変わらない。

- 複利運用では、バンクロールに比例して購入金額も増える
- よって**相対的なドローダウンリスクは変わらない**
- 50万で10万賭けるのと、500万で100万賭けるのはリスク的に同じ
- 指数関数的成長 = 指数関数的暴落の可能性も内包

## AI開発への示唆

### 1. 馬券種選択のフレームワーク ★★★

Matsukaze氏の選択基準を体系化:

| 基準 | ワイド | 枠連 | 複勝 | 単勝 | 馬連 | 3連複 |
|---|---|---|---|---|---|---|
| 的中率 | 高 | 中 | 最高 | 低 | 低 | 最低 |
| EV | 良 | 良 | 中 | 中 | 中 | ? |
| 分散 | 小 | 小 | 最小 | 大 | 大 | 最大 |
| ワイドとの相関 | - | **低** | 中 | 中 | 高 | 高 |

**推奨ポートフォリオ**: ワイド（主力）+ 枠連（分散投資）+ 将来的に3連複

### 2. 馬券間の相関計算の実装

```
相関行列:
         ワイド  枠連  馬連  単勝  複勝  3連複
ワイド    1.00   低    高    中    中    高
枠連      低    1.00   鬼高  中    中    高
馬連      高    鬼高  1.00  高    中    高
...
```

- 各馬券種の的中/不的中を二値変数として相関を計算
- 過去データで実測可能
- **相関の低い組み合わせを選んでポートフォリオを構成**

### 3. パレートの法則を前提とした設計

- 収益の80%は全レースの20%から生まれる
- つまり**ほとんどのレースは「こなす」だけ**、一部のレースで大きく稼ぐ
- 設計上の含意:
  - 全レースに均等に賭けるのが正しい（どのレースが「当たり」か事前にはわからない）
  - 「今日は調子がいい」で賭け金を増やすな（005ホットハンド誤謬）
  - レースごとの的中/不的中で一喜一憂しない → 週次・月次で評価

### 4. スケーリング時の心理的課題

- 5万円の賭けに慣れる前に10万円の賭けが来る
- 複利で回す以上、常に「怖い」金額を賭け続けることになる
- **自動化の最大のメリット = 人間の恐怖心を排除**
- 「気絶したい」= 人間が見ないほうが良いパフォーマンスが出る

## 独自考察

### 馬券ポートフォリオ理論の金融工学的解釈

Matsukaze氏の馬券戦略は、マーコウィッツのポートフォリオ理論の馬券版:

```
目的関数: max E[収支]
制約条件: Var[収支] < σ_max（分散の上限）

資産（馬券種）:
  - ワイド: 中リターン・低リスク・低相関
  - 枠連: 中リターン・低リスク・低相関
  - 単勝: 高リターン・高リスク
  - 3連複: 最高リターン・最高リスク

最適配分:
  → 効率的フロンティア上の点を選ぶ
  → ワイド+枠連はシャープレシオが高い組み合わせ
```

### 「ゆるふわ」が最適解である理由

- 精密な最適化は計算が複雑で実装バグのリスクが高い（6週目のワイドオッズバグ参照）
- 相関が低い馬券種同士なら、厳密な最適化なしでもリスク分散が効く
- **「だるい最適化」を避けて「ゆるふわ」で済ませる = 実装の単純さ = バグのリスク低減**
- 80%の効果を20%の労力で得る（パレートの法則の開発版）

### 破産確率が一定である数理的理由

複利運用で購入金額がバンクロールの一定割合(f)の場合:
- バンクロール B → 購入金額 f*B
- 相対的なリスク（バンク比での変動幅）は常に同じ
- 連敗n回後のバンク = B × (1 - f*loss_rate)^n
- **nは絶対額に依存しない** → 破産確率はバンクの大きさと無関係
- これはケリー基準の基本的な性質

### 006→007→008の戦略進化

| 期間 | フェーズ | 主な学び |
|---|---|---|
| 1-5週目(006) | 運用開始 | EV>1.0を全部買え、回収率を下げろ |
| 6-11週目(007) | ドローダウン | スマートマネー補正、複利の両刃性 |
| 17-19週目(008) | スケールアップ | 馬券種の相関、ポートフォリオ構成 |

## 関連データ

| データ項目 | 用途 | 備考 |
|---|---|---|
| ワイド/枠連の同時的中率 | 馬券種間相関の実測 | 過去データで計算可能 |
| 馬券種別の回収率分散 | リスク評価 | 馬券種ごとに分布が異なる |
| レース別利益分布 | パレートの法則の検証 | 上位20%レースの利益シェア |

## アクションアイテム

- [ ] 馬券種間の的中相関行列を過去データで計算
- [ ] ワイド+枠連ポートフォリオのシミュレーション構築
- [ ] パレートの法則の実証: レース別利益分布の分析
- [ ] 破産確率計算の実装（ケリー基準ベース）
- [ ] 3連複追加時のポートフォリオ最適化フレームワーク設計

## タグ

`#馬券戦略` `#バンクロール` `#運用` `#チューニング` `#ポートフォリオ`
