# 競馬AIでポルシェを買う話 20-21週目 / 500万突破 / 2019年総まとめ

- **出典**: Matsukaze.AI「競馬AIでポルシェを買う話」
  - 20週目: http://matsukaze.ai/?p=803 (2019-02-04)
  - 21週目: http://matsukaze.ai/?p=828 (2019-02-21)
  - 500万突破: http://matsukaze.ai/?p=863 (2019-11-04)
  - 2019年総まとめ: http://matsukaze.ai/?p=873 (2020-02-26)
- **日付**: 2025-02-11
- **前編**: [008 ポルシェを買う話 17-19週目](008_ポルシェを買う話_17-19週目.md)

## 収支ハイライト

### バンクロール推移

| 時点 | バンクロール | 備考 |
|---|---|---|
| 2018-09-15 | 500,000円 | 運用開始 |
| 2019-01 | 1,607,770円 | 第1のピーク（19週目） |
| 2019-02 | 741,860円 | ドローダウン（21週目） |
| 2019-06-03 | **55,340円** | 史上最安値（-97%） |
| 2019-11-03 | 5,000,000円 | 500万突破 |
| 2019-12-27 | **17,390,000円** | 2019年末確定値 |

### 2019年確定成績

- **総購入金額**: 1億2,354万円
- **総払戻金額**: 1億4,060万円
- **収支**: **+約1,700万円**
- **回収率**: **114%**
- **稼働週数**: 51週（29週勝利 / 22週負け = 勝率56.9%）

## 要点

### 20週目: 複利初期のミスの致命性

> 複利の最初の方で、1個当たりを逃してしまうと後半にとてつもなく影響が大きくなる

- 入金忘れで日曜午前を丸ごと購入できず
- 購入失敗・入金忘れ等の人的ミスによる累計損失は推定100万円超
- **パフォーマンス毀損のほとんどはモデルではなく運用ミス**

#### 生存者バイアスへの注意（再確認）

> 8種類の馬券種それぞれで回収率を集計すると、1個くらい回収率が100を超えるものが出てくる可能性は結構高い

- 「馬単なら回収率100%超え！」= サイコロを6000個振って偏った目を見つけるのと同じ
- 005の平均回帰批判の具体的な適用例

### 21週目: レース間の独立性仮定の検証問題 ★★

> 松風の成績がレースごとに独立であるという仮定をしている。
> もしこの仮定が間違っているとしたら結構厄介で、破産リスクの計算が間違っているということになる

- 全体の的中率10%で「10連敗する確率 = 0.9^10 = 34.9%」
- しかし「2月だけ的中率5%」なら、2月の10連敗確率はずっと高い
- **独立かどうかを確認する方法は一般に難しい**
- 「ドヤ天」（資産ピーク後のドヤで天井を打つ）= 単なる平均回帰の法則

### 500万突破: 3万年のシミュレーション

- 5.5万円 → 500万円を**5ヶ月**で達成（90倍）
- 「3万年以上競馬をシミュレーションしている」
- 「年間10倍ペース」を保守的な目標と位置づけ
- 実際は13.5ヶ月で10倍（目標より1.5ヶ月遅い → 「気持ちが悪い」）

### 2019年総まとめ: ドローダウン分析 ★★★

#### 160万 → 5.5万のドローダウン（-97%）の原因分析

考えられる原因:
1. **単なる不運**
2. **バグ**
3. **チューニングの失敗** ← Matsukaze氏の推定

根拠:
> スランプの期間も的中率がそれほど変わらないのに対して、回収率が20%落ちてる

- 的中率が一定 → モデルの予測精度は変わっていない
- 回収率が低下 → **購入するEV閾値が低すぎた**（質の低い馬券まで買っていた）
- つまり007で述べた「攻めすぎチューニング」が原因

#### 交通事故仮説

> この期間に交通事故にあって気絶でもしてれば、今松風ファンドの総額は更に32倍あるはず

- ドローダウンがなければ 1,739万 × 32 ≈ **5.5億円**
- ドローダウンの機会損失は**桁違いに大きい**
- チューニング1つのミスが最終結果を32分の1にする

#### 独立性仮定の重要性（再掲）

> もし「不的中のあとは不的中の確率が上がる」という「流れ」があるサイコロだったら、10連敗する確率はもっと大きい

> 松風も「各試行は独立である」と仮定してシミュレーションしている

- 「ある月だけ、ある競馬場だけ的中確率が低い」条件がある場合:
  - シミュレーションの破産確率は過小評価されている
  - 実際のリスクはシミュレーションより大きい
- **しかし、1年の1/3の時間と資産の97%を溶かしても最終的に+1,700万 → 「とても大きな知見」**

## AI開発への示唆

### 1. 回収率114%の意味

- 年間1.24億円購入 × 回収率114% = 利益1,700万円
- **回収率のわずか14%超過が莫大な利益を生む** = 大量購入の威力
- 006の「回収率は低くていい、購入金額を増やせ」の実証

### 2. ドローダウン分析の実装

的中率と回収率を分離して監視するフレームワーク:

```
モニタリング指標:
  1. 的中率（モデル精度の指標）
  2. 的中時の平均回収率（チューニングの指標）
  3. 購入金額（資金管理の指標）

アラート条件:
  - 的中率は維持 + 回収率が低下 → チューニング見直し
  - 的中率が低下 + 回収率も低下 → モデル劣化の可能性
  - 的中率が低下 + 回収率は維持 → 不運の可能性（様子見）
```

### 3. 独立性の検定

- 試行間の独立性を検定する方法:
  - **ラン検定**: 的中/不的中の連続（ラン）の数が期待値と一致するか
  - **自己相関**: 的中フラグの時系列の自己相関を計算
  - **条件付き的中率**: 前回的中/不的中ごとの今回的中率を比較
  - **月別/競馬場別/クラス別の的中率**: 均一かどうかの検定（カイ二乗検定）
- もし非独立性が検出された場合:
  - 条件別に異なるモデルを使う
  - レジームスイッチングモデルの導入
  - 破産確率計算にマルコフ連鎖を使用

### 4. 3万年シミュレーションの含意

- Matsukaze氏は3万年分（= 約1億レース）をシミュレーション
- **モンテカルロシミュレーションの規模が桁違いに大きい**
- これにより:
  - 破産確率の精密な推定
  - ドローダウンの分布の把握
  - チューニングパラメータの最適値の探索
  - 年間リターンの分布の把握

### 5. 運用ミスが最大のリスク

006-009を通して、収益を毀損した最大の原因はモデルではなく:
1. 自動購入の障害（006）
2. 入金忘れ（009/20週目）
3. チューニングの攻めすぎ（007, 009）

→ **完全自動化 + 保守的パラメータ = 最適解**

## 独自考察

### 回収率114%の安定性を統計検定する

- 年間51週 × 週あたり約70レース ≈ 3,570レース
- 回収率114%が統計的に有意かを検定:
  - H0: 真の回収率 = 100%（利益なし）
  - H1: 真の回収率 > 100%
  - 購入金額加重の分散を推定し、t検定またはブートストラップで検証
- 56.9%の週次勝率で二項検定: p = P(X ≥ 29 | n=51, p=0.5) → 十分有意

### ドローダウン(-97%)からの復活が示す堅牢性

```
タイムライン:
  160万(2019-01) → 5.5万(2019-06) → 1,739万(2019-12)

仮にドローダウンがなかった場合:
  160万 × (1,739万/5.5万) ≈ 5億円

実際の結果:
  1,739万円

ドローダウンのコスト:
  約5億 - 1,739万 ≈ 4.8億円（機会損失）
```

- しかし「5.5万から1,739万への復活」こそがモデルの真の実力の証明
- ドローダウンはチューニングミス + 不運 → モデル自体は健全
- **チューニングさえ正しければ、モデルは年間10倍以上の成長が可能**

### 「年10倍ペース」の分解

- 年10倍 = 週次で約1.048倍（1.048^51 ≈ 10.8）
- 週次回収率: 約104.8%（バンクロールを1周転する前提）
- 実績の週次回収率中央値はおそらくこれに近い
- **週4.8%の超過リターンを52週続ける = 競馬AIの到達点**

## 関連データ

| データ項目 | 用途 | 備考 |
|---|---|---|
| 月別/週別的中率 | 独立性の検定 | 季節性・開催場の影響 |
| 的中率 vs 回収率の時系列 | ドローダウン診断 | 乖離パターンで原因特定 |
| 大規模モンテカルロ | 破産確率・ドローダウン分布 | 3万年規模のシミュレーション |

## アクションアイテム

- [ ] 的中率・回収率の分離モニタリングダッシュボードの設計
- [ ] 試行間の独立性検定（ラン検定・自己相関分析）の実装
- [ ] 大規模モンテカルロシミュレーションの構築（破産確率・ドローダウン分布）
- [ ] 運用ミスの自動検出・アラート機能（入金漏れ、購入失敗率の異常など）
- [ ] チューニングパラメータの自動最適化（保守的/攻めの切り替え基準）

## タグ

`#馬券戦略` `#バンクロール` `#運用` `#チューニング` `#確率論` `#独立性`
