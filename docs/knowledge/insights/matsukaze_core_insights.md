# 松風ブログ 核心知見まとめ（001-012横断整理）

Matsukaze.AIブログ全12記事から抽出した、我々の競馬AI開発において最も有益な知見を重要度順に整理する。

---

## 第1部: 思想・戦略（何を目指すか）

### 1. 収支最大化 ≠ 回収率最大化 ★★★

> 回収率200%を誇ってる人は、期待値が1.01~1.99の馬券の殆どを看過してしまっている（006）

**核心**: 利益 = 購入金額 ×（回収率 - 1）。回収率を下げてでも購入金額を増やす方が利益は大きく、かつ安定する。

| 戦略 | 回収率 | 購入金額 | 利益 | 安定性 |
|---|---|---|---|---|
| 高確信のみ購入 | 200% | 10万 | 10万 | 低（分散大） |
| **EV>1.0を全購入** | **110%** | **100万** | **10万** | **高（大数の法則）** |
| Matsukaze 2019年 | 114% | 1.24億 | 1,700万 | 実証済み |
| Matsukaze 2020年 | 117.5% | 25億 | 4.34億 | 実証済み |

**実装方針**: EV > 1.0の馬券を全て購入する。購入点数を増やし、バンクロール回転率を上げる。

### 2. 確率論的競馬観 ★★★

> 着順は確率変数であり、確率予測が本質（003）

**核心**: 「この馬が勝つ」ではなく「この馬の勝率は23%」と予測する。評価指標は的中率ではなくキャリブレーション（較正精度）。

```
× 決定論的AI: 着順予測 → 的中率で評価
○ 確率論的AI: 確率分布出力 → ブライアスコア/対数損失で評価
```

- 意思決定のクオリティ（期待値）で判断し、結果（的中/不的中）で判断しない
- 人間の認知バイアス（お気に入りロングショットバイアス等）がオッズを歪める → AIの利益の源泉

### 3. オッズの歪みこそが利益の源泉 ★★★

> AI予測確率と市場オッズの乖離を検出するのが鍵（001, 002）

**核心**: 予測精度を上げることと、利益を上げることは別問題。利益はオッズと予測確率の乖離（= 市場の非効率性）から生まれる。

```
利益の構造:
  AI予測勝率: 30%
  市場オッズ: 5.0倍（= 市場の暗黙的勝率20%）
  EV = 0.30 × 5.0 = 1.50 → 購入

  乖離の原因:
  - 応援馬券（馬主クラブ、ファン心理）→ 人気馬のオッズが過剰に低い
  - お気に入りロングショットバイアス → 穴馬のオッズが過剰に低い
  - 情報の非対称性 → 一部の馬が過小評価
```

### 4. 税務設計はAI設計の一部 ★★★

> この通達ありきで松風を設計し、この要件を満たせるから、運用を開始しています（010）

**核心**: 一時所得なら利益1,700万に対し税金3,000万（破産）。雑所得なら税金600万。税区分の違いだけで2,400万円の差。

**雑所得の要件（設計に織り込む）**:
1. 自動購入ソフトウエアであること
2. 計算式に基づく購入パターン
3. 年間80%以上のレースで購入（安全マージン込み）
4. 年間通算で回収率100%超
5. 全購入記録を客観的・改ざん不可能な形で保存

---

## 第2部: モデル設計（どう作るか）

### 5. アルゴリズムより特徴量とターゲット ★★★

> アルゴリズムは何でもいい。重要なのはguzai（特徴量）とtarget（予測対象）の設計（004）

**核心**: scikit-learnの3行で十分。差別化は特徴量の質と予測対象の設計から生まれる。

```
重要度:
  特徴量の設計 >>>>> ターゲットの設計 >>> アルゴリズムの選択

ターゲット候補:
  × 着順（ランキング問題 → 的中率最大化に向かう）
  △ 走破タイム（回帰問題 → 間接的に勝率に変換可能）
  ○ 勝率/連対率/複勝率（確率推定 → 直接EV計算に使える）
```

### 6. 過学習の徹底的な回避 ★★★

> 血統予想は血液型占いと同じレベルの疑似科学（005）
> サイコロを100個振れば、どれかの目は平均よりも少し多く出る（009, 012）

**核心**: 小サンプル × 多条件分け = ノイズへのフィット。「この種牡馬 × この距離 × このコース」は平均回帰で消える。

**「やってはいけないこと」リスト**:

| やりがちなこと | なぜダメか | 正しいアプローチ |
|---|---|---|
| 少数レースで判断 | 収束に必要な回数不足 | 数千レースのバックテスト |
| 産駒×距離×コース分析 | 平均回帰 + 小サンプル | モデルに交互作用を学習させる |
| 好成績の馬券種だけ買う | 生存者バイアス | ポートフォリオ効果を考慮 |
| 「流れ」で賭け金を変更 | ホットハンド誤謬 | 固定ロジックで機械的に購入 |
| 結果で戦略を変更 | 飛行教官の誤謬 | 十分なサンプルの事前設計 |

### 7. スマートマネー効果 ★★

> 的中馬券の確定オッズは最終オッズより下がる傾向がある。ブラウン運動ではない（007）

**核心**: 締切直前の馬券購入は的中率が高い。最終オッズでEV > 1.0でも、確定オッズでは下がっている可能性。

**実装**: 過去データから最終→確定オッズの変動分布を推定し、EV計算にバッファを織り込む。

---

## 第3部: 購入戦略（どう買うか）

### 8. Themisの設計思想 ★★★

> Themisが知るのは、確率とオッズ、そして松風の預金残高のみ（011）

**核心**: 購入決定モジュールは予測モジュールと完全分離。入力は確率・オッズ・バンクロール残高の3つだけ。馬名も騎手名も知らない。

```
Themis(確率, オッズ, バンクロール) → [(馬券, 購入金額), ...]

定式化:
  EV[i]  = P[i] × O[i]
  f[i]   = Kelly(P[i], O[i]) × safety_factor
  bet[i] = バンクロール × f[i]
  出力   = {(i, bet[i]) | EV[i] > threshold}
```

**利点**: 認知バイアス排除、テスト容易、モデル非依存、汎用性

### 9. 馬券ポートフォリオ理論 ★★★

> ワイドと枠連は的中率が高く、分散が小さく、パフォーマンスが良く、相関が低い（008）

**核心**: 馬券種の選択はマーコウィッツのポートフォリオ理論と同じ。相関の低い馬券種を組み合わせてリスク分散。

```
推奨ポートフォリオ:
  主力: ワイド（高的中率、低分散、EV良好）
  分散: 枠連（ワイドと相関が低い）
  拡張: 3連複 → 三連単（バンクロール成長に応じて解放）

注意:
  × 馬連+枠連（相関が鬼高い）
  × 単勝+複勝（複勝外れ→単勝も必ず外れ）
```

### 10. ワイドEV計算の方法 ★★

> ワイド(A,B)の期待値 = Σ P(3着=C) × ワイドオッズ(A,B when C)（007）

**核心**: ワイドのEVは3着馬全候補の条件付き期待値の合算。

```
ワイド(A,B)のEV = Σ_{C∈全馬-{A,B}} P(上位3頭=A,B,C) × ワイドオッズ(A,B | 3着C)
```

### 11. バンクロール管理と複利 ★★★

> バンクロールが増えても破産確率は下がらない（008）
> チューニング1つのミスが最終結果を32分の1にする（009）

**核心**: 複利は利益も損失も指数関数的に加速する。追い下げ（バンク連動で購入金額を下げる）が破産防止の最終防衛ライン。

```
複利の威力（年間回収率114%の場合）:
  2019年: 50万 → 1,739万（35倍）
  2020年: 1,000万 → 4.3億（43倍）

複利の恐怖（-97%ドローダウン）:
  160万 → 5.5万（1/29）
  ドローダウンがなければ5.5億 → 実際は1,739万（機会損失4.8億）
```

**保守的チューニングの採用**: 攻めすぎない。EV閾値にバッファを持たせる。

---

## 第4部: 運用（どう動かすか）

### 12. 運用ミスが最大のリスク ★★★

006-012を通して、収益を毀損した最大の原因はモデルではなく運用:

| ミス | 推定損失 | 出典 |
|---|---|---|
| 自動購入の障害 | 数十万〜数百万 | 006 |
| 入金忘れ | 100万超（累計） | 009 |
| チューニングの攻めすぎ | 4.8億（機会損失） | 007, 009 |
| オブジェクトコピーバグ | 200万 | 011 |
| 年始アップデートのバグ | 200万 | 011 |

**結論**: 完全自動化 + 保守的パラメータ + バンクロール同期の一貫性 = 最適解

### 13. モジュール分離アーキテクチャ ★★

松風は8モジュール構成。少なくとも以下の分離が必須:

```
L1: データ収集・整形（Zeus相当）
L2: モデリング（Poseidon相当）
L3: 予測（推論）
L4: 購入決定（Themis相当）← 最重要
L5: 購入実行・記録
```

### 14. 的中率と回収率の分離監視 ★★

> スランプの期間も的中率がそれほど変わらないのに対して、回収率が20%落ちてる（009）

```
アラート条件:
  的中率維持 + 回収率低下 → チューニング見直し
  的中率低下 + 回収率低下 → モデル劣化の可能性
  的中率低下 + 回収率維持 → 不運の可能性（様子見）
```

---

## 第5部: 競争環境（2025年の我々の立ち位置）

### 15. 後発参入の現実 ★★

> 期待値の高い馬券のオッズをしっかり下げ、後続の複利での資産形成を阻害する（012）

**競馬AI市場の競争構造**:

| フェーズ | 時期 | 特徴 |
|---|---|---|
| ブルーオーシャン | 〜2019 | 競合少数、公開データで十分 |
| 競争激化 | 2020〜 | 独自データ + 規模が差別化要因 |
| レッドオーシャン | 2025〜 | エッジの奪い合い |

**我々の戦略**:
- 公開データだけのエッジは小さい前提で設計
- 独自の視点・データ（レース映像解析等）の開発
- まずは小規模で実証 → 段階的にスケール
- 「データはパワー」を忘れない

### 16. 独自データが最強の参入障壁 ★★★

> 郊外に家が土地付きで立つくらいの金額で、過去20年の目視データを購入。投資回収1ヶ月（012）

- JRA-VANは全員が使える → 同質化
- 独自データ（レース映像解析、パドック解析、馬場の内外差等）が差別化の鍵
- 2025年はAI画像解析技術が進歩 → 自前で構築できる可能性

---

## 第6部: 年間収支パターン

### 17. パレートの法則と「耐える期間」

> 収益の80%は全レースの20%から生まれる（008）
> 流れを掴んだらほんの数週間で2倍3倍、その時が来るまでバンクを減らさず耐える（012）

2019年・2020年ともに同じパターン:
- **上半期**: 停滞〜ドローダウン（耐える期間）
- **下半期**: 爆発的に稼ぐ

**含意**: 短期的な負けで戦略を変えない。バンクロールを減らさず耐えることが最重要。

---

## 優先実装リスト（重要度×実装容易性）

### Phase 1: 基盤（すぐ着手）

| # | 項目 | 根拠 | 難度 |
|---|---|---|---|
| 1 | 確率分布出力モデルの構築 | 知見2,5 | 中 |
| 2 | EV計算（確率×オッズ）の実装 | 知見1,3 | 低 |
| 3 | 購入ログの自動記録（タイムスタンプ付き） | 知見4 | 低 |
| 4 | バックテスト + 信頼区間の表示 | 知見6 | 中 |

### Phase 2: 購入エンジン（モデル後）

| # | 項目 | 根拠 | 難度 |
|---|---|---|---|
| 5 | Themis相当モジュール設計 | 知見8 | 中 |
| 6 | バンクロール管理（追い下げ） | 知見11 | 中 |
| 7 | ワイドEV計算（全組合せ） | 知見10 | 高 |
| 8 | 馬券種ポートフォリオ設計 | 知見9 | 中 |

### Phase 3: 運用・監視

| # | 項目 | 根拠 | 難度 |
|---|---|---|---|
| 9 | 的中率/回収率の分離監視 | 知見14 | 低 |
| 10 | 独立性検定の実装 | 009 | 高 |
| 11 | モンテカルロシミュレーション | 009 | 高 |
| 12 | 税務要件の自動チェック | 知見4 | 低 |

---

## タグ

`#馬券戦略` `#モデル` `#運用` `#バンクロール` `#オッズ` `#特徴量` `#確率論` `#税金`
