# ローテーション（レース間隔）の特徴量化

レース間隔は馬のコンディションに直結する重要な要素。しかし「中2週がベスト」のような単純な話ではなく、馬の個性・距離・季節・厩舎方針が絡む多次元の問題。AIが捉えるべき構造を整理する。

> 起点: ローテーション・レース間隔が馬の成績にどう影響するか。参考: 行動競馬学「競馬ローテーションの真実とは？」

---

## 1. ローテーションの基本構造

### レース間隔の分類

```
■ 超短期（中0-1週、連闘〜中1週）
  → ほぼ存在しない。中央競馬では制度的に稀。
  → 地方競馬では連闘がある。

■ 短期（中2-3週）
  → いわゆる「詰めたローテ」
  → 好走後の勢いを活かす意図
  → 疲労リスクあり。体力が回復しきらない可能性

■ 標準（中4-8週、約1-2ヶ月）
  → 最も一般的なローテーション
  → 統計的に勝率・連対率が最も高い傾向
  → 適度な休養と調整期間

■ やや長い（中9-16週、2-4ヶ月）
  → 「間隔を空けた」ローテ
  → 故障からの復帰、あるいは目標レースに向けた調整
  → 体調次第では好走可能

■ 長期休養明け（中17週以上、4ヶ月超）
  → いわゆる「休み明け」
  → 仕上がりに不安、だが「使い減り」のない状態
  → 厩舎・調教師によって休み明けの仕上げ力が大きく異なる

■ 超長期休養明け（半年〜1年以上）
  → 故障からの復帰が多い
  → 能力減退リスクが高い
  → ただし若い馬なら成長で相殺する場合も
```

### 一般的な統計傾向

```
レース間隔別の勝率（一般的な傾向）:

  中1-2週:  勝率 5-7%  連対率 11-14%  → やや低い
  中3-4週:  勝率 7-9%  連対率 14-17%  → 最も高い ★
  中5-8週:  勝率 7-8%  連対率 13-16%  → 高い
  中9-12週: 勝率 6-7%  連対率 12-14%  → やや下がる
  中13-25週: 勝率 5-7% 連対率 10-13%  → 下がる
  中26週以上: 勝率 3-5% 連対率 7-10%  → 明確に低い

※これは全体平均。クラス・年齢・厩舎で大きく変わる。

回収率の傾向（こちらが重要）:
  短い間隔: 回収率はやや低い（人気馬の連戦が多く、過剰評価されがち）
  標準間隔: 回収率は中立
  長い間隔: 回収率は一概に言えない
    → 「休み明けを嫌って過小評価される馬」→ 高回収率
    → 「休み明けで本当に走れない馬」→ 低回収率
    → 混在しているため、単純な間隔だけではEV判断できない
```

---

## 2. 単純な間隔だけでは不十分: 多次元の問題

### 「中4週」でも意味が全く違うケース

```
ケースA: 重賞3着 → 中4週 → 重賞出走
  → 好走後の勢いを維持したローテ
  → コンディション良好の可能性が高い

ケースB: 大敗15着 → 中4週 → 条件戦出走
  → 大敗後に使ってきた ← なぜ？
  → 「立て直しが必要なのに使う」→ 条件にこだわり？
  → あるいは「大敗の原因が能力ではなかった」→ 巻き返し狙い

ケースC: 新馬勝ち → 中4週 → 重賞出走
  → デビュー戦から即重賞 ← 期待馬
  → 経験不足だが能力は高い

→ 「中4週」という数値は同じだが、文脈で意味が完全に変わる。
→ レース間隔の「数値」だけでなく、前走の文脈を組み合わせる必要がある。
```

### ローテーションの「質」を構成する要素

```
┌─────────────────────────────────────┐
│        ローテーションの多次元構造      │
├─────────────────────────────────────┤
│                                     │
│  ① 間隔の長さ（中N週）              │
│  ② 前走の結果（着順・着差）          │
│  ③ 前走の消耗度（距離・展開・タイム）│
│  ④ クラスの変動（昇級/同級/降級）    │
│  ⑤ 距離の変動（延長/短縮/同距離）    │
│  ⑥ コースの変動（右回り↔左回り等）   │
│  ⑦ 馬場の変動（芝↔ダート）          │
│  ⑧ 季節（夏場の消耗、冬場の体調管理）│
│  ⑨ 年齢（若馬の成長 vs 高齢馬の衰え）│
│  ⑩ 厩舎の傾向（間隔の使い方が厩舎で異なる）│
│                                     │
└─────────────────────────────────────┘

LightGBMに①〜⑩を特徴量として入れれば、
交互作用（「3歳で中2週で昇級初戦」等）は自動学習される。
重要なのは「何を特徴量にするか」の設計。
```

---

## 3. 「叩き2戦目」の構造

### 最も有名なローテーション格言

```
「休み明け → 叩き2戦目」の構造:

  休み明け（初戦）:
    → 体が仕上がりきっていない
    → レース勘が鈍っている
    → 「8分仕上げ」で出走するケースが多い
    → 勝率が低い傾向

  叩き2戦目:
    → 初戦で体を動かしたことでフィットネスが向上
    → レース勘が戻る
    → 調教師が本番として仕上げてくる
    → 勝率・連対率が向上する傾向

  ★ 統計的にも確認されている一般的な傾向。
  ★ ただし「休み明けでも仕上げが上手い厩舎」は例外。
```

### AIが捉えるべきポイント

```
重要: 「叩き2戦目」は特徴量ではなく「パターン」

  単純な特徴量化:
    - 前走からの間隔: 中4週
    - 前々走からの間隔: 中20週
    → 「前々走の間隔が長く、前走の間隔が短い」= 叩き2戦目

  より精密な特徴量化:
    - 直近N走の間隔パターン: [中20週, 中4週] = 休養→叩き
    - 前走が休み明け初戦かどうか（フラグ）
    - 前走の着順（休み明け初戦の好走/凡走）
    - 前走の上がり3F順位（能力の片鱗を見せたか）

  → LightGBMは「前走間隔が長い」×「今回間隔が短い」の交互作用を
    学習できるので、明示的に「叩き2戦目フラグ」を作る必要は
    必ずしもないが、作った方が学習が速い可能性がある。
```

---

## 4. 厩舎ごとのローテーション戦略

### 「間隔」の意味は厩舎で変わる

```
■ 「詰めて使う」厩舎:
  → 好調なうちに連戦する方針
  → 中2-3週でも成績が落ちにくい
  → この厩舎の中2週は「好調の証」

■ 「じっくり仕上げる」厩舎:
  → 常に中4-8週で出走させる
  → 中2週で使うのは「なにか事情がある」
  → この厩舎の中2週は「やや不安」

■ 「休み明け仕上げが上手い」厩舎:
  → 長期休養後でも仕上がった状態で出走させる
  → 「休み明け」のハンデが小さい
  → 一般的な「休み明け割引」を適用すると過小評価になる

■ 「叩き良化型」厩舎:
  → 意図的に休み明け初戦を「8分仕上げ」で出す
  → 2戦目で本気仕上げ
  → 初戦は「捨てレース」に近い

→ 厩舎（調教師）ごとのローテーション傾向は重要な情報。
→ ただし調教師IDをそのまま特徴量に入れると過学習リスク（005の教訓）。
→ 調教師をカテゴリで分類するか、集約統計を使う。
```

### 特徴量化のアプローチ

```
方法1: 調教師のローテーション統計を特徴量に
  - 当該調教師の「休み明け勝率」
  - 当該調教師の「中2-3週出走時の勝率」
  - 当該調教師の「平均出走間隔」

  利点: 厩舎の方針を定量化できる
  欠点: 調教師×条件のサンプルが少ない → 過学習注意

方法2: 調教師を類型化して使う
  - 「短間隔型」「標準型」「休養重視型」の3分類
  - 分類基準: 平均出走間隔、休み明け勝率の偏差
  - 過学習リスクが低い

方法3: 間隔 × 調教師平均間隔との差分
  - 「この調教師にしては間隔が短い」= 急いで使った理由がある
  - 「この調教師にしては間隔が長い」= 慎重に仕上げた or 問題があった
  - 絶対値よりも調教師基準での相対値が有用
```

---

## 5. 前走の「消耗度」とローテーション

### 同じ「中4週」でも疲労が違う

```
■ 消耗度が高い前走:
  - 長距離戦（2400m以上）
  - ハイペースでの消耗戦
  - 着差の小さい接戦（全力を出し切った）
  - 不良馬場（体力消耗が大きい）
  - 大外枠からの先行（無駄な体力消費）

  → 同じ中4週でも回復が十分でない可能性
  → 短い間隔での再出走は危険信号

■ 消耗度が低い前走:
  - 短距離戦（1200-1400m）
  - スローペースで楽に好位追走
  - 大差をつけての勝利（余力残し）
  - 良馬場
  - 好枠からスムーズな競馬

  → 体力的なダメージが少ない
  → 短い間隔でも問題なく走れる

特徴量化:
  - 前走の距離
  - 前走のペース（前半3Fタイム）
  - 前走の着差（0.0秒差 = 激戦、3.0秒差 = 楽勝 or 大敗）
  - 前走の馬場状態
  → これらは既に前走成績として入力可能。
    間隔との交互作用はLightGBMが学習する。
```

---

## 6. 季節とローテーション

### 夏と冬で「最適間隔」が変わる

```
■ 夏場（6-9月）:
  - 暑さによる体力消耗が大きい
  - 北海道シリーズは涼しいが輸送の負担あり
  - 夏バテしやすい馬としにくい馬がいる
  → 短い間隔はリスクが高い
  → 「夏場の中2週」は「冬場の中2週」より消耗度が高い

■ 冬場（12-2月）:
  - 気温が低く体力消耗は少ない
  - ただし馬場が荒れやすい（冬の洋芝）
  - 年末年始は中山・阪神の高密度開催
  → 短い間隔でも比較的走れる

■ 春秋のG1シーズン:
  - 目標レースに向けた逆算ローテ
  - 「本番」と「前哨戦」の使い分け
  - 前哨戦で好走→本番で凡走（燃え尽き）パターン
  - 前哨戦で凡走→本番で好走（温存・上積み）パターン

特徴量化:
  - 開催月（季節変数）
  - 気温（天候データがあれば）
  - 間隔 × 季節の交互作用
  → 「夏場×短間隔」のペナルティをモデルに学習させる
```

---

## 7. 年齢とローテーション

### 若い馬と高齢馬で意味が変わる

```
■ 2-3歳馬:
  - 成長途上。レースを使うこと自体が成長に繋がる
  - 短い間隔での連戦でも成績が落ちにくい
  - 「使って良くなる」タイプが多い
  - 長期休養後は「成長」で上積みがある可能性
  → 間隔の影響は小さめ

■ 4-5歳馬:
  - 心身ともにピーク
  - ローテーションの影響が最も「標準的」に出る
  - 統計の平均値が最も当てはまる年齢層

■ 6歳以上:
  - 回復力が落ちてくる
  - 短い間隔での成績低下が顕著
  - 長期休養後の「衰え」リスクが高い
  - 「間隔を空けた方が良い」が、「空けすぎると戻らない」
  → 間隔の影響が大きい。最適間隔が若い馬より長い。

■ 7歳以上:
  - 「ベテラン」。能力の維持が課題
  - 「得意条件でだけ使う」選択的ローテが有効
  - 「使いすぎ」の疲弊リスクが高い

特徴量化:
  - 年齢（歳）
  - 年齢 × 間隔の交互作用
  → LightGBMが「6歳以上で中2週は成績が落ちる」を学習
```

---

## 8. ローテーションから読み取れる「意図」

### 厩舎の出走意図を推理する

```
ローテーションの選択には「陣営の意図」が込められている:

■ 「間隔を詰めてきた」= 好調だから使いたい
  前走好走 + 中2-3週 → 「状態が良いうちに」
  → 好材料。ただし過信は禁物。

■ 「間隔を空けた」= じっくり仕上げた
  前走凡走 + 中8週以上 → 「立て直してきた」
  → 仕上がり次第。調教データと組み合わせて判断。

■ 「急に間隔を詰めた」= 何か事情がある
  普段は中4-8週の厩舎が中2週で使ってきた
  → 特定のレースに出したい？ 登録の都合？ 放牧に出せない事情？
  → 必ずしもポジティブではない。

■ 「目標レースから逆算」= 計画的ローテ
  G1の4-8週前に前哨戦を使う
  → 前哨戦の結果にかかわらず「本番」に全力
  → 前哨戦の着順は額面通りに受け取らない（後述の「着順以外の評価」に接続）

■ 「放牧帰り」= リフレッシュ後の初戦
  長期間放牧に出して心身をリフレッシュ
  → 牧場で乗り込んでから帰厩→調教→出走
  → 「放牧先の調教量」が仕上がりに影響するが、データ化が困難

→ これらの「意図」を直接特徴量にするのは難しいが、
  間隔 × 前走成績 × 厩舎傾向の組合せで間接的に捉えられる。
```

---

## 9. 具体的な特徴量リスト

### 基本特徴量

```
■ レース間隔系（直接計算可能）
  - 前走からの中間日数（連続値）
  - 前走からの中間週数（離散値）
  - 間隔カテゴリ（超短/短/標準/長/超長の5分類）
  - 今年の出走回数（使い込み度）
  - 直近3ヶ月の出走回数（最近の使い込み度）

■ 叩き関連
  - 前走が休み明け初戦かどうか（フラグ）
  - 前々走からの間隔（休養の長さ）
  - 休養明けN戦目（1戦目/2戦目/3戦目以降）
  - 前走休み明け × 前走着順（休み明けで好走したか）

■ 前走の文脈
  - 前走着順（そのまま）
  - 前走着差（秒差）
  - 前走距離 - 今回距離（距離変更量）
  - 前走クラス - 今回クラス（クラス変動）
  - 前走上がり3F順位（能力の発揮度）

■ 消耗度の代理変数
  - 前走距離（長いほど消耗）
  - 前走馬場状態（重/不良は消耗大）
  - 前走着差（接戦=消耗大 or 大差=余力 or 大敗=消耗小）

■ 調教師のローテーション傾向
  - 調教師の平均出走間隔（過去1年）
  - 調教師の休み明け勝率（過去2年）
  - 今回の間隔 - 調教師平均間隔（相対的な短さ/長さ）

■ 年齢 × 間隔
  - LightGBMに両方入れれば交互作用は自動学習
  - 明示的に「年齢×間隔カテゴリ」を作ってもよい
```

---

## 10. 「臨戦過程」という上位概念

### ローテーションは「臨戦過程」の一部にすぎない

```
「臨戦過程」= レースに至るまでの過程全体

  ┌─────────────────────────────────────────┐
  │              臨戦過程の構成要素            │
  ├─────────────────────────────────────────┤
  │                                         │
  │  前走の結果（着順・着差・展開）           │
  │      ↓                                  │
  │  休養/放牧（日数・場所・調教量）         │
  │      ↓                                  │
  │  帰厩（帰厩日・調整期間）               │
  │      ↓                                  │
  │  調教（本数・時計・併せ馬の結果）        │
  │      ↓                                  │
  │  枠順（内枠/外枠の有利不利）            │
  │      ↓                                  │
  │  馬体重（増減のパターン）                │
  │      ↓                                  │
  │  当日の馬場・天候                        │
  │      ↓                                  │
  │  ★レース本番                            │
  │                                         │
  └─────────────────────────────────────────┘

  ローテーション（間隔）は臨戦過程の「骨格」にすぎない。
  本当に重要なのは「間隔の中で何をしてきたか」。
  → 調教データ、馬体重変化と組み合わせて初めて全体像が見える。
```

### JRA-VANから取得できるもの/できないもの

```
取得できるもの:
  ✅ 前走日と今回出走日 → レース間隔
  ✅ 前走の着順・着差・タイム
  ✅ 馬体重（当日パドック計測）
  ✅ 調教タイム（CKデータ）
  ✅ 出走回数・成績

取得が困難なもの:
  ❌ 放牧先での調教内容
  ❌ 帰厩日（一部推定可能）
  ❌ 厩舎でのコンディション
  ❌ 故障・体調不良の有無
  ❌ 陣営の出走意図

→ 「調教データ」が臨戦過程を補完する最も価値の高い情報源。
→ JRA-VANのCKデータ（調教データ）との組合せが重要。
```

---

## 11. オッズとの関係: 市場はローテーションをどう評価するか

### 市場のバイアス

```
■ 「休み明けを嫌いすぎる」バイアス:
  一般ファンは休み明け馬を敬遠する傾向がある。
  → 仕上がりが良い休み明け馬のオッズが割高になる
  → 調教データで仕上がりを確認できれば、EV > 1.0 の機会

■ 「好走後の連戦を過大評価する」バイアス:
  前走好走 + 短い間隔 → 「好調だ！」と過剰に評価
  → 実際は疲労で成績が落ちるケースも多い
  → 過剰人気でオッズが低い → EV < 1.0

■ 「叩き2戦目」の既知バイアス:
  「叩き2戦目で良くなる」は多くのファンが知っている
  → すでにオッズに織り込まれている可能性
  → 「知られたパターン」からは超過利益が得にくい
  → ただし「どの馬の叩き2戦目が本当に良くなるか」の精度で差が出る

→ AIの優位性:
  調教データ × ローテーション × 厩舎傾向 の組合せで、
  市場が見落としている「本当に仕上がっている休み明け馬」を検出できる。
  単純な間隔だけでなく、臨戦過程全体を特徴量化することで差別化。
```

---

## まとめ

```
1. レース間隔は「数値」だけでは不十分
   → 前走の文脈、厩舎の方針、年齢、季節との交互作用が本質

2. LightGBMに多次元の特徴量を入れれば交互作用は自動学習される
   → 人間の仕事は「何を特徴量にするか」の設計

3. 調教師のローテーション傾向は重要だが過学習注意
   → 集約統計（平均間隔、休み明け勝率）を使う

4. 「叩き2戦目」は市場も知っている
   → 単純パターンでは超過利益は出にくい
   → 調教データとの組合せで精度を上げる

5. ローテーションは「臨戦過程」の骨格
   → 調教データ・馬体重変化と組み合わせて全体像を把握
```

---

## アクションアイテム

- [ ] レース間隔系の特徴量をfeatures.mdに追加
- [ ] 過去データで間隔別の勝率・回収率を集計（ベースライン確認）
- [ ] 調教師別の「休み明け勝率」「平均出走間隔」を集計
- [ ] 「叩き2戦目」フラグの有効性を検証
- [ ] 間隔 × 前走着順 × 年齢の交互作用の探索的分析
- [ ] 調教データ（CKデータ）との組合せ分析の設計

## 関連ドキュメント

| 関連insight | 接続点 |
|---|---|
| [特徴量設計とハイパラ](human_vs_ai_in_model_design.md) | 特徴量の「発想」は人間の仕事 |
| [馬主情報の特徴量化](owner_as_feature.md) | 過学習リスクのある特徴量の扱い方（調教師IDと同様の問題） |
| [仮説検証マスター](hypothesis_verification_master.md) | ローテーション関連の仮説を追加 |

## タグ

`#ローテ` `#特徴量` `#調教` `#モデル`
