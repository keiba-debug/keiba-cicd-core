# スタートから1コーナーまでの距離と枠順バイアス

> 起点: 「スタートから初のコーナーまでの距離が短い場合は先行争いで内が有利か？」

---

## 1. 結論: Yes。物理的に内枠が有利。ただし「有利の大きさ」はコース×距離×頭数×脚質構成の関数

```
スタートから1コーナーまでの距離が短いほど:
  ① 外枠の馬が「出たなり」でポジションを取れない
  ② 外枠から前に行くには「押す」必要がある → ポジショニングコスト増大
  ③ 1コーナーがボトルネック（漏斗）になり、外から内に入れない
  ④ 内枠の馬は自然に好位を確保できる → 出たなりのメリット最大化

これは物理法則に基づく構造的な有利であり、
騎手の技術やメンバー構成で完全には打ち消せない。

ただし:
  - 頭数が少なければボトルネック効果は弱い
  - 内枠の馬が全て差し・追込脚質なら、内枠有利を活かせない
  - ダートの場合、内枠の砂被りデメリットが相殺する場合がある
```

---

## 2. 物理的なメカニズム: なぜ短い距離で内枠有利になるか

### 2-1. 漏斗（ファネル）効果

```
スタート地点ではN頭が横一線に並ぶ。
ゲート幅: 1頭あたり約1.5m × 18頭 = 約27m幅

1コーナーでは内ラチ沿いに1-3頭幅（約4.5m）に収束する必要がある。
（実際には外を回る馬もいるが、好位を取りたい馬は内に寄せたい）

スタート（27m幅）→ 1コーナー（実質4.5-9m幅）
  = 幅が1/3〜1/6に収束する

これが「漏斗効果」:
  距離が長い場合: ゆっくり収束できる → 全馬がスムーズに位置取り
  距離が短い場合: 急に収束する → 外の馬が入れない or 押し込まれる

       スタート              1コーナー
  ┌──────────────────┐      ┌───┐
  │18 17 16 15 14 13│      │   │
  │12 11 10  9  8  7│  →   │   │← ここに全馬が入る
  │ 6  5  4  3  2  1│      │   │
  └──────────────────┘      └───┘
      27m幅                  9m幅

距離が短いほど、この収束が急になり、
外枠の馬は物理的に不利になる。
```

### 2-2. 外枠から前を取るコスト

```
■ 直線の等速走行（出たなり）:
  内枠1番と外枠18番の差はゼロ。
  全馬が同じ速度で同じ距離を走る。

■ コーナーでの差:
  1コーナー進入時、外を回ると1コーナーだけで約2-4馬身（4-8m）のロス。

  計算（半径Rのコーナー、内ラチからN頭分外を回る場合）:
  コーナー弧の長さの差 = 2π × (R + N×1.5m) × (角度/360) - 2π × R × (角度/360)
                       = 2π × N × 1.5m × (角度/360)

  90度のコーナーで3頭分外を回ると:
  = 2π × 3 × 1.5 × (90/360) = 約7.1m = 約3.5馬身

■ 1コーナーまでに内に入りたい場合のコスト:
  外枠18番が内ラチ沿いに寄せるには:
  横方向移動: 約25m（18番→1番のゲート間距離）

  これを斜め走行で実現するための追加距離:
  √(直進距離² + 25²) - 直進距離

  1コーナーまで150m: √(150² + 25²) - 150 = 2.1m のロス
  1コーナーまで300m: √(300² + 25²) - 300 = 1.0m のロス
  1コーナーまで500m: √(500² + 25²) - 500 = 0.6m のロス

  → 距離が短いほど、内に寄せるための角度が急 → ロスが大きい。
  → さらに、他馬をかわしながら内に入る必要があるため、
    実際のロスはこの計算より大きい。

■ 速度を上げて前に出るコスト:
  外枠から先頭を取るには、内枠の馬より速く走る必要がある。
  追加0.5秒の加速 → [ポジショニングコスト](positioning_cost_and_natural_running.md) で
  後半0.5-1.5秒分のスタミナ消費に相当。

  1コーナーまでが短い場合:
  → 短い区間でこの追加加速をしなければならない
  → 瞬間的な負荷が大きい → 消耗が激しい

  1コーナーまでが長い場合:
  → 緩やかに加速すれば良い
  → 負荷が分散される → 消耗が小さい
```

### 2-3. 「出たなり」の枠番依存性

```
1コーナーまでの距離と「出たなり」の関係:

距離が長い（400m以上）:
  → 全馬が自分のペースで走りながら自然にポジションが決まる
  → 枠番の影響は小さい
  → 外枠でも「出たなり」で好位が取れる
  → 枠順バイアスが小さい

距離が短い（200m以下）:
  → ポジションを取る時間がない
  → 内枠は「出たなり」で前のポジション
  → 外枠は「出たなり」だと外の後方 → 不利確定
  → 外枠から前を取るには「押す」必要 → ポジショニングコスト大
  → 枠順バイアスが大きい

つまり:
  1コーナーまでの距離が短い
  = 外枠の「出たなりポジション」が構造的に悪い
  = 外枠がポジション争いに参加せざるを得ない
  = 外枠のポジショニングコストが高い
  = 内枠有利
```

---

## 3. 日本の主要コース: 1コーナーまでの距離（概算）

```
★ 以下は概算値。正確な値はJRAの公式コース図から測定が必要。
  スタート地点はレース距離によって変わるため、同じ競馬場でも距離別に異なる。

■ 1コーナーまで極めて短い（〜200m）→ 内枠バイアス大
  中山 芝2000m（内回り）: 約130m ★最も有名な「内枠有利」コース
  中山 芝1200m: 約200m
  福島 芝1200m: 約200m
  小倉 芝1200m: 約200m
  阪神 芝1400m（内回り）: 約200m
  中京 芝1200m: 約200m

■ 1コーナーまで短い（200-350m）→ 内枠バイアスあり
  中山 芝1600m: 約240m
  阪神 芝1600m（内回り）: 約300m
  福島 芝1800m: 約300m
  小倉 芝1800m: 約300m
  京都 芝1400m（内回り）: 約300m

■ 1コーナーまで中程度（350-500m）→ 枠順バイアス小
  東京 芝1400m: 約350m
  阪神 芝2000m（内回り）: 約350m
  京都 芝1600m（外回り）: 約400m
  中京 芝2000m: 約400m

■ 1コーナーまで長い（500m以上）→ 枠順バイアスほぼなし
  東京 芝1600m: 約550m ★長い直線の後にコーナー
  東京 芝1800m: 約350m
  新潟 芝1600m（外回り）: 約450m
  新潟 芝1000m（直線）: コーナーなし

★ 注意:
  これらは暫定的な概算値であり、実データで検証が必要。
  JRAの公式コース図、または過去レースのパトロール映像から
  より正確な値を測定すべき。

  → 特徴量としては「コース×距離」の組合せごとに
    固定値のルックアップテーブルで実装する。
    レースごとに計算する必要はない（コースは変わらないので）。
```

---

## 4. 「内枠有利」を超える分析: 何が有利の大きさを決めるか

### 4-1. 頭数（フルゲートか少頭数か）

```
漏斗効果は頭数に比例する:

  18頭フルゲート:
    27m幅 → 9m幅に収束
    外枠(18番)は内ラチから約25m離れている
    → ボトルネック効果が最大 → 内枠有利が最大

  10頭:
    15m幅 → 9m幅に収束
    外枠(10番)は内ラチから約13.5m離れている
    → ボトルネック効果が弱い → 内枠有利が弱い

  8頭以下:
    12m幅 → 9m幅
    → ほぼ収束不要 → 枠順バイアスが極めて小さい

★ 「1コーナーまでの距離 × 頭数」の交互作用が重要。
  距離短い × 多頭数 = 内枠有利が最大化
  距離短い × 少頭数 = 内枠有利はあるが控えめ
  距離長い × 多頭数 = 枠順バイアス小さい
  距離長い × 少頭数 = 枠順バイアスほぼなし
```

### 4-2. 脚質構成（先行馬が何頭いるか）

```
先行馬が多い場合:
  → ポジション争いが激化
  → 短い距離で前を取り合う
  → 外枠の先行馬が最も割を食う
  → 内枠有利がさらに拡大

先行馬が少ない場合（差し・追込ばかり）:
  → ポジション争いが起きない
  → 全馬がゆっくり入る
  → 漏斗効果が弱まる
  → 内枠有利が縮小

逃げ馬が1頭だけの場合:
  → その馬が楽に先頭（枠順関係なし）
  → 2番手以降の争いも緩やか
  → 内枠有利は小さい

★ 「1コーナーまでの距離 × 先行馬頭数」の交互作用も重要。
```

### 4-3. 芝 vs ダート

```
芝:
  → 内枠有利がストレートに効く
  → 内ラチ沿いが荒れている開催後半を除けば、
    内を回るほど距離が短い = 有利

ダート:
  → 内枠有利と砂被りデメリットの相殺
  → 内枠は前に行けるが、先行できないと前の馬の砂を被る
  → 特に雨のダート（不良馬場）では砂被りの影響が大きい
  → 外枠で外を回った方が良い場合がある

  ダートでの枠順バイアス:
    先行馬 × 内枠: 有利（前に出て砂被りなし）
    差し馬 × 内枠: 不利（包まれて砂被り）
    先行馬 × 外枠: やや不利（ポジション取りにコスト）
    差し馬 × 外枠: やや有利（砂被りを避けられる）

  → ダートでは「枠番×脚質」の交互作用が芝以上に重要。
```

### 4-4. 馬場状態と開催日程

```
開催前半（1-2日目）:
  → 芝が均一 → 内も外も走りやすい → 内枠有利は距離差のみ
  → 純粋に「1コーナーまでの距離」効果が測定しやすい

開催後半（7-8日目）:
  → 内ラチ沿いの芝が荒れる → 内を通る馬が不利になる場合あり
  → 内枠有利と芝の荒れデメリットが相殺
  → 「馬場の内外差」という別の変数が混入

  → 分析する際は開催日を統制変数にすべき。
    あるいは「馬場差」を推定してから枠番バイアスを見る。

雨馬場:
  → 芝は内が荒れやすい → 外に馬群が膨らむ傾向
  → ダートは砂被りがひどくなる → 外有利が強まる
  → 1コーナーまでの距離の効果が変化する可能性
```

---

## 5. データで検証可能な仮説

### 仮説群

```
H-A: 1コーナーまでの距離が短いコースほど、
     内枠（1-6番）の勝率が外枠（13-18番）より高い

H-B: この内枠有利は、頭数が多いほど強い
     （16頭以上 vs 12頭以下で効果差を比較）

H-C: この内枠有利は、先行脚質の馬に顕著に現れる
     （逃げ・先行 vs 差し・追込で効果差を比較）

H-D: 外枠で好走した先行馬は、次走で疲労（ポジショニングコスト）
     の影響を受けやすい
     （1コーナーまで短い × 外枠 × 好走 → 次走凡走率が高い？）

H-E: 1コーナーまでの距離が短いコースでは、
     「枠番→1角通過順位」の相関が強い（枠＝ポジション）
     距離が長いコースでは相関が弱い（枠とポジションが独立）

H-F: ダートでは芝と逆方向のバイアスがある
     （内枠×差し脚質は砂被りで不利）
```

### 検証方法

```
■ 基本分析（H-A）:
  1. 全レースをコース×距離でグループ化
  2. 各グループで「1コーナーまでの距離」を設定
  3. 枠番を内（1-6）/中（7-12）/外（13-18）に3分類
  4. 各グループの枠番別勝率・複勝率・回収率を計算
  5. 「1コーナーまでの距離」と「内枠優位度」の相関を計算

■ 交互作用分析（H-B, H-C）:
  6. 頭数を16頭以上/12-15頭/11頭以下に分類
  7. 脚質を逃げ・先行/差し・追込に分類
  8. 「距離×頭数×脚質×枠番」の4元交互作用を見る
     → サンプルサイズが足りなくなる可能性
     → まずは2元（距離×枠番）から始め、段階的に3元、4元へ

■ ポジショニングコスト検証（H-D, H-E）:
  9. 各レースの「枠番と1角通過順位の相関係数」を計算
  10. 距離グループ別に相関係数の分布を比較
  11. 相関が高いコース（距離短）= 枠がポジションを決める
      相関が低いコース（距離長）= 枠とポジションが独立

■ 回収率分析:
  12. 最終的に「このバイアスはオッズに反映されているか？」を確認
  13. 内枠有利が既にオッズに織り込み済みなら回収率に差はない
  14. 織り込みが不十分なら → 馬券戦略として使える
```

---

## 6. 特徴量設計

### 新たに提案する特徴量

```
■ F7: 1コーナーまでの距離（コース定数）
  定義: そのコース×距離の組合せで、
        スタート地点から1コーナー進入までの直線距離(m)
  実装: ルックアップテーブル（コース×距離 → 距離値）
  難度: 低（一度テーブルを作れば完了）
  ★ ただし単独では使えない。他の特徴量との交互作用で意味を持つ。

■ F8: 枠番不利度
  定義: 「1コーナーまでの距離」と「枠番」から計算される
        ポジション取りの構造的不利の大きさ
  計算案:
    unfavorable = gate_number / (distance_to_corner / 100)
    # 枠番が大きく、距離が短いほど値が大きい（不利）
  難度: 低

■ F9: ボトルネック強度
  定義: 頭数/1コーナーまでの距離。
        漏斗効果の強さを数値化
  計算: num_entries / distance_to_corner
  難度: 低
  用途: 値が大きいほど「ポジション争い」が激しくなる

■ F10: 先行争い激化指数
  定義: (先行脚質馬の数 × 枠番の分散度) / 1コーナーまでの距離
  計算:
    n_front = count(逃げ) + count(先行)
    gate_spread = std(先行馬の枠番)
    intensity = n_front * gate_spread / distance_to_corner
  難度: 中
  用途: 先行馬が多く枠順が散らばっているほど、
        1コーナーまでの距離が短いほど、争いが激化

■ F11: 脚質×枠番×距離の三重交互作用
  定義: 当該馬の脚質が、この枠番から、この距離で有利か不利か
  実装: カテゴリ化して過去データの平均を参照
    例: (逃げ, 内枠, 短距離toCorner) → 有利度+2
        (逃げ, 外枠, 短距離toCorner) → 有利度-3
        (差し, 内枠, 短距離toCorner) → 有利度+1（前の馬の後ろ）
        (差し, 外枠, 短距離toCorner) → 有利度-1
  難度: 中
  ★ LightGBMは交互作用を自動学習するので、
    F7+枠番+脚質を個別に入れるだけでも同等の効果がある可能性。
    明示的に交互作用を作るかはモデルの学習状況を見て判断。
```

### 既存特徴量との統合

```
前回のポジショニングコスト系特徴量（F1-F6）と今回のF7-F11は
自然に統合できる:

  F1(ポジショニングコスト)の予測精度が上がる:
    F1 = expected_position - actual_position
    ↑ expected_positionの推定にF7(1コーナーまでの距離)を使える
    → 「このコースでこの枠なら、自然に何番手になるか」の推定精度UP

  F6(出たなりスコア)の解釈が深まる:
    「出たなりスコアが低い（ポジション争いをした）」の原因が
    F7-F9で説明できる → モデルの解釈性向上

  統合的な「ポジション有利度」:
    total_advantage = f(F1, F2, F7, F8, F9, F10, F11)
    → 個別に入れてLightGBMに任せるか、
      人間が事前に統合するかは検証次第。
```

---

## 7. コース形態のさらなる考慮

### 1コーナーの角度

```
1コーナーまでの距離だけでなく、コーナーの曲がり方も重要:

急カーブ（小回り: 福島、小倉、中山内回り）:
  → 外を回るロスが大きい
  → コーナーでの遠心力で外に膨らむ
  → 内枠有利がさらに強化

緩やかなカーブ（大回り: 東京、新潟外回り、阪神外回り）:
  → 外を回ってもロスが小さい
  → 内外の差が小さい

→ 「1コーナーまでの距離 × コーナーの曲率」
  の交互作用が真の枠順バイアスを決める。

★ 実装としては、コース×距離のルックアップテーブルに
  「内枠有利度」を事前計算して格納するのが実用的。
  物理的な距離と曲率を個別に入れるより、
  過去データから直接「枠番別勝率差」を計算した方が正確。
```

### スタート地点の坂

```
中山:
  スタート地点が坂の途中にあるコースがある。
  坂を登りながらのスタート → ダッシュ力のある馬が有利
  → 坂 × 外枠 = さらに不利（登りながら外から前に行くコスト）

阪神:
  ゴール前の急坂がスタート付近にも影響するコースあり。

→ これも「コース定数」としてルックアップテーブルに含める。
```

### ワンターンvsツーターン

```
ワンターン（1回しか曲がらない）:
  例: 東京1600m、阪神1600m外回り
  → コーナーは1回だけ → 外を回るロスが1回分
  → 内枠有利が小さい

ツーターン（2回以上曲がる）:
  例: 中山2000m、阪神2000m内回り
  → コーナーが多い → 外を回るロスが累積
  → 内枠有利が大きい
  → ただし長距離では「前半のポジション取り」より
    「中盤以降の位置取り」が重要になる

→ 「1コーナーまでの距離」はスタート直後の問題。
  2コーナー以降は「騎手の技術」で内外を調整可能なので、
  1コーナーまでの距離が最も枠順バイアスに影響する。
```

---

## 8. 先行争い vs 折り合いのジレンマ（外枠の先行馬の選択）

```
外枠で先行脚質の馬（1コーナーまで短い場合）:

選択肢A: 押して前に行く
  メリット: 好位を確保、本来の脚質で走れる
  デメリット: ポジショニングコスト大、後半に影響
  結果: 好走するが、勝ちきれない（2-3着）パターン

選択肢B: 無理せず中団に控える
  メリット: エネルギー温存、末脚を使える
  デメリット: 本来の脚質と違う → 折り合い不安、馬が戸惑う
  結果: うまく折り合えば突き抜ける、折り合い欠けば凡走

選択肢C: 大外を回る
  メリット: 他馬との接触を避けられる、馬が走りやすい
  デメリット: 距離ロス（コーナーで外を回る分）
  結果: 末脚が生きれば好走、距離ロスで届かないことも

★ 騎手の判断が分かれるポイント:
  - リーディング上位の騎手は選択肢B（控えて末脚）を選ぶ傾向
  - 若手騎手は選択肢A（押して前へ）を選びがち
  - 外国人騎手は選択肢C（大外ぶん回し）を選ぶ傾向

→ 「騎手 × 枠番 × コース」の交互作用も存在する可能性。
  ただしサンプルサイズの問題で、騎手個別の分析は難しい。
  リーディング上位/中位/若手 程度の分類が限界か。
```

---

## 9. 実装の優先順位

### Step 1: コース定数テーブルの構築（最優先）

```
全競馬場×全距離の組合せで:
  - 1コーナーまでの推定距離
  - コーナー数（ワンターン/ツーターン）
  - コーナーの曲率（小回り/大回り）

をルックアップテーブルとして作成。

入手方法:
  1. JRAの公式コース図から測定（最も正確）
  2. 過去データの「枠番と1角通過順位の相関」から間接推定
     → 相関が強いコース = 1コーナーまでの距離が短い
  3. 競馬サイトのコース解説記事から概算値を取得

★ 方法2が最も効率的。データだけで完結し、
  かつ「実際のバイアスの大きさ」を直接測定できる。
```

### Step 2: 枠番バイアスの基礎分析

```
全レースを対象に:
  1. コース×距離ごとに枠番別の勝率・複勝率を計算
  2. 「内枠優位度」= (内枠勝率 - 外枠勝率) を計算
  3. 内枠優位度とStep1の距離推定値の相関を確認
  4. 頭数別、脚質別にサブ分析

目的: 仮説H-Aの検証と、特徴量の有効性の事前確認
```

### Step 3: 特徴量の追加とモデル検証

```
F7（1コーナーまでの距離）をモデルに追加:
  → 既存モデルとの精度比較
  → SHAP値で枠番×距離の交互作用を確認

F8-F11を追加:
  → 段階的に追加し、各特徴量の貢献度を確認
  → 過学習リスクに注意（交互作用特徴量は過学習しやすい）
```

---

## 10. オッズへの反映度（馬券戦略としての価値）

```
重要な問い: この内枠有利は既にオッズに織り込まれているか？

■ 織り込まれている場合:
  一般の競馬ファンも「中山2000mは内枠有利」を知っている。
  → 内枠の馬は人気になりやすい
  → オッズが低くなる
  → 回収率に差がない = 馬券戦略としての価値はない

■ 織り込みが不十分な場合:
  (a) 定性的には知られているが、定量的に過小評価:
      「内枠有利」は知っているが、頭数や脚質構成で
      どれだけ有利かは一般的に定量化されていない。
      → 条件が重なった時（短距離toCorner × 多頭数 × 先行馬多）に
        内枠有利がオッズ以上に強い可能性。

  (b) 特定のコース×距離で過小評価:
      中山2000mの内枠有利は有名すぎて織り込み済みかもしれないが、
      他のコース（例: 福島1200m、小倉1200m）では
      まだオッズに完全反映されていない可能性。

  (c) 逆に外枠の不利が過剰に織り込まれている場合:
      外枠の馬が実力の割に軽視されすぎている
      → 外枠馬の回収率が高い可能性も（過剰割引のリバウンド）

★ これは仮説であり、実データでの検証が必要。
  特に回収率ベースの分析（単勝回収率、複勝回収率）が重要。

→ [馬券市場の構造的非効率性](market_structural_inefficiencies.md) に
  「枠順バイアスの織り込み度」を追加する検証候補。
```

---

## 11. 他のinsightsとの接続

| この考察の論点 | 関連するinsight |
|---|---|
| ポジショニングコストの概念 | [ポジショニングコストと出たなりの優位性](positioning_cost_and_natural_running.md) |
| 展開予測と特徴量の関係 | [スムーズな走りと展開予測の必要性](smooth_trip_without_simulation.md) |
| 枠番×脚質のペース影響 | [展開シミュレーションと条件付き着順予測](race_scenario_simulation.md) |
| 構造的バイアスとオッズ | [馬券市場の構造的非効率性](market_structural_inefficiencies.md) |
| コース形態と環境要因 | [環境物理学](environmental_physics.md) |
| 出たなりの特徴量化 | [features.md](../features.md) ポジショニング系 |

---

## アクションアイテム

- [ ] 全競馬場×全距離の「1コーナーまでの距離」ルックアップテーブル構築
- [ ] 枠番別勝率・複勝率のコース×距離別集計（基礎分析）
- [ ] 「枠番と1角通過順位の相関係数」のコース×距離別集計（H-E検証）
- [ ] 頭数×枠番×コース距離の三重クロス分析（H-B検証）
- [ ] 脚質×枠番×コース距離の三重クロス分析（H-C検証）
- [ ] 枠番別の単勝回収率・複勝回収率の分析（オッズ織り込み度の検証）

## タグ

`#コース` `#展開` `#特徴量` `#馬場` `#馬券戦略` `#オッズ`
