# 馬主情報の特徴量化: 馬主名・馬主成績は使えるか

馬主名や馬主の成績を予測モデルの特徴量として使うことの意味、効果、リスクを考察する。001（ショート戦略）で触れた馬主クラブのオッズ歪みとは異なる角度から「馬主情報は馬の能力を予測する手がかりになるか」を検討する。

> 起点: 「馬主名や馬主の成績を特徴量として使うことについて考察したい」

---

## 1. 馬主情報が持つ2つの意味

馬主情報を特徴量として使うとき、実は2つの全く異なる情報を取りにいっている。これを混同すると設計を間違える。

```
意味A: 馬の能力の代理変数（Proxy for horse quality）
  「この馬主は良い馬を持っている可能性が高い」
  → 予測対象: 馬の実力
  → 効果: 1着確率の推定精度が上がる

意味B: オッズの歪みの指標（Odds distortion signal）
  「この馬主の馬はファンに過剰に買われている可能性がある」
  → 予測対象: オッズと実力の乖離
  → 効果: EV計算の精度が上がる
```

この2つは目的が違うので、使い方も評価方法も違う。

---

## 2. 意味A: 馬の能力の代理変数としての馬主

### なぜ馬主が馬の能力と相関するのか

```
馬主が強い馬を持つメカニズム:

1. 購入力
   大手馬主/クラブ → セリで高額馬を落札できる
   → 高額馬は血統が良い → 平均的に能力が高い
   例: サンデーレーシング、キャロットファーム

2. 生産力（オーナーブリーダー）
   自前の牧場で計画的に配合
   → 良血の繁殖牝馬 × トップ種牡馬
   例: 社台ファーム系、ノーザンファーム系

3. 調教師との関係
   有力馬主 → トップ調教師に馬を預けられる
   → 調教師の腕 × 管理馬の質が相乗
   例: 特定の馬主と調教師の「ライン」

4. 管理方針
   資金力のある馬主 → 外厩（ノーザンファーム天栄等）の活用
   → 万全の状態で出走できる
   → 資金力のない馬主 → トレセン内の限られた設備で調整

5. 淘汰の基準
   大手馬主 → 見込みのない馬を早期に引退/地方移籍
   → 残った馬は相対的にレベルが高い
   個人馬主 → 愛着で走らせ続ける場合も
   → 能力の低い馬がJRAに残り続ける
```

### これは「馬主が強い」のではなく「馬主が良い馬を買える」

```
重要な区別:
  × 「サンデーレーシングの馬は走る」
  ○ 「サンデーレーシングは走る馬を買える環境にある」

つまり馬主名は:
  - 血統の代理変数（良血馬を買える）
  - 調教師の代理変数（有力調教師に預けられる）
  - 管理環境の代理変数（外厩等の活用）
  - 淘汰圧の代理変数（弱い馬が残らない）

→ これらの情報が他の特徴量で十分にカバーされていれば、
   馬主名は冗長（不要）になる可能性がある。
```

### 他の特徴量でカバーできるか？

```
馬主情報が代理している項目と、直接的な特徴量:

| 馬主が代理する情報 | 直接的な特徴量 | カバー度 |
|---|---|---|
| 血統の質 | 父、母父、近親の成績 | ★★★ 高い |
| 調教師の腕 | 調教師成績（勝率、回収率） | ★★★ 高い |
| 管理環境 | 外厩使用フラグ、放牧先 | ★★ 中（データ取得に依存） |
| 淘汰圧 | 馬の戦績自体に反映 | ★★ 中 |
| セリ価格 | JRA-VANにはない | ★ 低（取得困難） |
| 馬主の育成哲学 | 数値化困難 | ★ 低 |

→ 血統と調教師で大部分はカバーできるが、
   「セリ価格」「管理環境」「淘汰方針」は直接取れない。
   馬主名はこれらの不足分を補完する可能性がある。
```

---

## 3. 意味B: オッズ歪みの指標としての馬主

### 001で考察済みの馬主クラブ効果

```
馬主クラブ馬にはファン（出資会員）がいる:
  → 会員が応援馬券を購入
  → 実力以上にオッズが下がる（過剰人気）
  → EV < 1.0 の馬券が増える

001の分析:
  DMMバヌーシー: 会員約10,000人
  全員100円でも100万円のインパクト
  → 小規模レース（売上1億円未満）では無視できない歪み

仮説H-09: 馬主クラブ馬のオッズは過剰に低い
  → Phase 1で検証予定
```

### 意味Aと意味Bの使い分け

```
■ 予測モデルの入力として（意味A）:
  目的: P(A wins) の推定精度を上げる
  使い方: 馬主IDを特徴量に入れる
  効果: 血統・調教師で拾えない「残りの情報」を捕捉
  リスク: 過学習（後述）

■ EV計算の補正として（意味B）:
  目的: オッズの歪み（=AIの利益源泉）を検出する
  使い方: 馬主クラブフラグをオッズ補正に使う
  効果: 過剰人気馬の検出→買わない判断が正確に
  リスク: 少ない（オッズ側の話なのでモデルと独立）

★意味Aと意味Bを同じモデルで同時に使うと混乱する。
  分離して考えるべき。
```

---

## 4. 過学習リスク: 005の教訓が直撃する

### 馬主の数とサンプルサイズ問題

```
JRA登録馬主数: 約2,000〜3,000人
年間出走レース数: 約3,200レース × 平均14頭 ≈ 45,000出走

馬主あたりの年間出走数（概算）:
  大手クラブ（サンデーR、キャロット等）: 500〜1,000出走/年
  中堅クラブ: 100〜300出走/年
  中堅個人馬主: 50〜200出走/年
  小規模馬主: 10〜50出走/年
  零細馬主: 1〜10出走/年

→ 大半の馬主は年間出走数が少なすぎて、
   「この馬主の馬は強い」と言えるほどのサンプルがない。
```

### 005の教訓: 少数条件分けは平均回帰する

```
005で学んだこと:
  「この種牡馬×この距離×このコースの回収率が高い」
  → サンプル50のデータでは偶然。次の50レースでは平均回帰する。

馬主にも同じことが起きる:
  「馬主Xの馬の回収率が150%」（過去30出走）
  → サンプル30では偶然の可能性が高い
  → 次の30出走では平均に戻る

特に危険なパターン:
  - 零細馬主の「たまたま1頭だけ走った馬」の成績
  - 新規参入馬主の初年度の好成績
  - 特定のクラスだけで好成績の馬主
```

### 馬主IDをそのまま特徴量に入れる危険性

```
LightGBMに馬主ID（カテゴリ変数）をそのまま入れると:

  1. 出走数の多い大手馬主 → 十分なサンプル → 学習が安定
  2. 出走数の少ない零細馬主 → サンプル不足 → ノイズを学習

  → モデルが「馬主X（出走3回、全部1着）は勝率100%」と学習
  → テストデータでは全く当たらない
  → 典型的な過学習

対策:
  A. 馬主IDの代わりに「馬主の集計統計量」を使う
  B. 出走数が少ない馬主を「その他」にまとめる
  C. 馬主をカテゴリ（大手クラブ/中堅クラブ/個人大手/個人小規模）に分類
  D. 馬主の特徴をエンコード（後述）
```

---

## 5. 実用的な特徴量設計

### 5-1. 馬主IDそのものは使わない → 集計統計量を使う

```
馬主IDの代わりに、馬主の「成績統計」を特徴量にする:

■ 勝率系
  - 馬主の過去1年の勝率
  - 馬主の過去1年の複勝率（3着内率）
  - 馬主の過去1年の出走数（規模の指標）

■ 回収率系（オッズ歪みの指標を兼ねる）
  - 馬主の過去1年の単勝回収率
  - 馬主の過去1年の複勝回収率
  → 回収率が低い馬主 = 過剰人気（応援馬券効果）の可能性

■ クラス系
  - 馬主のG1出走率（全出走中のG1比率）
  - 馬主の重賞勝利数
  → 上のクラスに馬を送り込める = 質の高い馬を持っている

■ 効率系
  - 馬主の1頭あたり平均獲得賞金
  - 馬主の出走頭数に対する勝利数比
  → 少数精鋭 vs 多数出走の戦略の違い

利点:
  - 連続値なのでLightGBMが扱いやすい
  - サンプルサイズの問題が緩和される（極端な値は正則化で抑えられる）
  - 意味のある情報（馬主の「格」）を直接表現できる
```

### 5-2. 馬主タイプの分類

```
馬主をカテゴリではなくタイプに分類する:

タイプ1: 大手クラブ法人
  例: サンデーレーシング、キャロットファーム、シルクレーシング、
      社台レースホース、G1レーシング、DMMバヌーシー
  特徴: 出走数多、勝率高、応援馬券効果大
  特徴量: is_major_club = 1

タイプ2: 中小クラブ法人
  例: ターファイトクラブ、ウイン、ラ・ペーニャ等
  特徴: 出走数中、勝率は平均程度
  特徴量: is_minor_club = 1

タイプ3: オーナーブリーダー（生産馬主）
  例: 社台ファーム（馬主としても）、ゴドルフィン、ダーレー
  特徴: 自家生産馬、血統の質が高い
  特徴量: is_owner_breeder = 1

タイプ4: 個人大手馬主
  例: 高額納税者番付上位の個人馬主
  特徴: セリで高額馬を購入、トップ調教師と関係
  特徴量: 馬主の年間出走数が閾値以上

タイプ5: 個人小規模馬主
  特徴: 出走数少、1-2頭所有
  特徴量: デフォルト（上記以外）

→ 5分類程度なら各タイプの出走数が十分で過学習リスクが低い
```

### 5-3. 馬主×調教師の組合せ

```
馬主と調教師の「ライン」は競馬界で重要:
  - ノーザンファーム生産 → 特定の調教師に集中的に預託
  - 有力馬主 → 有力調教師との関係が深い
  - この組合せが「外厩の質」「管理方針の一貫性」を代理する

特徴量案:
  - 馬主×調教師ペアの過去勝率
  - 馬主×調教師ペアの過去出走数（関係の深さ）

ただし:
  - ペアの数が馬主数×調教師数で爆発する
  - サンプルサイズ問題が悪化
  → 「出走数N以上のペアのみ」でフィルタリング必須
  → または「馬主の成績」「調教師の成績」を別々の特徴量にして、
     交互作用はLightGBMに任せる方が安全
```

### 5-4. 時間窓の設計（データリーク防止）

```
馬主の成績を特徴量にする場合、時間窓に注意:

  × NG: 馬主の「全期間」の成績
    → 未来の情報が含まれる（データリーク）

  ○ OK: 馬主の「過去1年」の成績
    → 予測時点より前のデータのみ使用

  設計:
    target_date = レース日
    feature_window = target_date - 365日 〜 target_date - 1日
    owner_win_rate = 馬主のfeature_window内の勝率

  Walk-Forward Validationでの注意:
    各fold内で、テスト期間のデータが特徴量に混入しないこと
    → 特徴量計算のパイプラインが正しい時間方向になっていること

  更新頻度:
    毎週更新で十分（馬主成績は急変しない）
    レースごとのリアルタイム更新は不要
```

---

## 6. 馬主情報が「既存の特徴量に対してどれだけ追加情報を持つか」

### 重要な問い: 血統と調教師の情報があれば馬主は不要か？

```
思考実験:

  モデルA: 血統（父、母父）+ 調教師 + その他基本特徴量
  モデルB: モデルA + 馬主成績（勝率、出走数等）

  もしモデルBの精度がモデルAとほぼ同じなら:
  → 馬主情報は血統・調教師と冗長 → 入れなくてよい

  もしモデルBの精度が有意に向上するなら:
  → 馬主情報は血統・調教師では捉えられない情報を持つ

  有意に向上する可能性がある理由:
  1. セリ価格（血統の質を超えた「馬体の質」の代理）
  2. 管理環境（外厩の質、放牧先の質）
  3. 淘汰方針（弱い馬を引退させるか）
  4. 出走間隔の設計力（適切なローテーション）

  → いずれも直接的な特徴量が取りにくい情報
  → 馬主が「間接的な指標」として機能する可能性がある
```

### 検証方法

```
H-26: 馬主成績の追加は予測精度を有意に向上させるか

  検証手順:
  1. ベースモデル: 血統 + 調教師 + 基本特徴量（馬主情報なし）
  2. テストモデル: ベースモデル + 馬主成績特徴量
  3. Walk-Forward Validationで精度比較
  4. 評価指標: ブライアスコア + EVベース回収率

  期待される結果:
  - ブライアスコア: わずかに改善（0.5-2%程度）
  - EVベース回収率: 不明（改善するかどうかが検証の目的）

  もし改善しない場合:
  → 馬主情報は不要。モデルをシンプルに保つ。
  → 特徴量の次元が減ることで過学習リスクも下がる。

  もし改善する場合:
  → どの馬主特徴量が効いているかを確認
  → 馬主タイプ分類（5-2）で十分か、成績統計量（5-1）が必要かを判断
```

---

## 7. 意味Bの具体的な使い方: オッズ補正

### 馬主情報をモデルではなくEV計算で使う

```
予測モデルは馬の「真の能力」を推定する。
馬主クラブの応援馬券効果は「真の能力」ではなく「オッズの歪み」。
→ この2つを混ぜると混乱する。

分離アーキテクチャ:

  Poseidon（予測層）:
    入力: 血統、調教師、成績、調教、馬場 ...
    出力: P(A wins) = 0.25（馬主情報は使わない or 意味Aだけ使う）

  オッズ分析層（新規）:
    入力: オッズ、馬主クラブフラグ、出資会員数
    出力: オッズの歪み推定値

  Themis（購入決定層）:
    入力: 予測確率 × 確定オッズ（歪み込み）
    出力: 購入判断

  → 馬主クラブの応援馬券効果は、オッズがすでに反映している。
  → AIが正確な確率を出せれば、EV計算で自然に歪みを突ける。
  → つまり、意味Bのために馬主情報を「わざわざ」特徴量に入れる必要はない。
     正確なP(A wins)があれば、過剰人気は「EV < 1.0」として自動検出される。
```

### ただし馬主情報が「事前の警戒指標」として使える場面

```
馬主クラブフラグが有用な場面:

  1. オッズが確定する前の段階（前日オッズ等）:
     → 「この馬はクラブ馬だから、本番のオッズはさらに下がるだろう」
     → オッズの下落予測に馬主情報が使える

  2. リスク管理:
     → 「大手クラブ馬に大きく張ると、締切直前の応援馬券で
         オッズが下がりEVが悪化する」
     → 購入タイミングの判断材料

  3. H-09（馬主クラブのオッズ歪み検証）の前段階:
     → まず馬主クラブのリストを作ること自体が有用
     → 歪みの大きさを定量化できれば、EV補正に使える
```

---

## 8. 具体的な馬主分類リスト（2025年時点）

### 大手クラブ法人（応援馬券効果大、要注意）

```
■ ノーザンファーム系
  - サンデーレーシング: 会員数多、G1常連
  - キャロットファーム: 一口馬主の最大手クラス
  - シルクレーシング: 中~上位クラス

■ 社台系
  - 社台レースホース: 社台ファーム直営
  - G1レーシング: 社台グループ

■ 新興大手
  - DMMバヌーシー: 会員約10,000人（001時点）
  - 東京サラブレッドクラブ
  - ノルマンディーオーナーズクラブ

■ 海外系
  - ゴドルフィン（モハメド殿下）
  - ダーレー・ジャパン

注意: クラブ法人のリストはJRA-VANの馬主テーブルから
      法人名で抽出可能。ただし会員数等はJRA-VANにはない。
```

### JRA-VANからの馬主データ取得

```
使用テーブル: UM（馬マスタ）の馬主情報、または馬主テーブル

取得できる情報:
  - 馬主名
  - 馬主コード
  - 馬主の所在地（法人か個人かの推定に使える）
  - 服色（馬主固有のため馬主特定に使える）

直接取得できない情報:
  - クラブ法人かどうか（馬主名から推定は可能）
  - 会員数
  - セリでの平均購入価格
  - 外厩の使用状況

→ 馬主タイプの分類は半自動:
   法人名リスト（手動作成）× 馬主テーブルのマッチング
```

---

## 9. 推奨アプローチのまとめ

```
Phase 1（ベースラインモデル）:
  → 馬主情報は使わない
  → 血統 + 調教師 + 基本特徴量で十分
  → まず「馬主なしでどこまで行けるか」の基準を作る

Phase 2（特徴量の追加実験）:
  → 馬主タイプ分類（5分類程度）を追加して精度比較（H-26）
  → 馬主成績統計量（勝率、出走数）を追加して精度比較
  → 改善があれば採用、なければ不要と判断

Phase 3（オッズ分析）:
  → H-09（馬主クラブのオッズ歪み）を検証
  → 歪みが確認されれば、EV計算の補正に活用
  → ただしThemisの原則に従い、モデルとは分離して使う

注意:
  - 馬主IDのカテゴリ変数をそのまま入れない（過学習の温床）
  - 集計統計量を使う場合は時間窓を厳守（データリーク防止）
  - 馬主の成績と馬の「真の能力」を混同しない
  - 005の教訓を常に意識: 少数サンプルの好成績は偶然
```

---

## アクションアイテム

- [ ] JRA-VANの馬主テーブルから馬主リストを抽出し、大手クラブ法人を手動分類
- [ ] 馬主タイプ別の基本統計量（出走数、勝率、回収率）の算出
- [ ] H-26（馬主特徴量の追加効果）を仮説検証マスターに追加
- [ ] 馬主成績の時間窓付き特徴量計算パイプラインの設計
- [ ] H-09（馬主クラブのオッズ歪み）の検証データセット準備

## タグ

`#特徴量` `#馬主クラブ` `#オッズ` `#モデル` `#過学習`
