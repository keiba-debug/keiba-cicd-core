# 「能力の方向性は一定ではない」— 能力はスカラーではなくベクトルである

> 起点: 「"能力の方向性は一定ではない"という点は避けて通れないテーマ。ここからどのような考察ができるかアイデアを膨らませたい」

---

## 1. 問題提起: 競馬AIの根底にある暗黙の前提

```
ほぼ全ての競馬予測モデル（我々のものも含め）は、
暗黙のうちに以下の前提を置いている:

  「各馬には"能力"という1つの数値がある。
   レースの結果は、この数値にノイズを加えたものである」

これは:
  - スピード指数: 1つの数値で馬の強さを表す
  - レーティング（Elo等）: 1つの数値で馬の強さを表す
  - LightGBMの出力: 1つの勝率を予測する
  - Harvilleの前提: 各馬に固定の「強さ」パラメータがある

すべて「能力 = スカラー（1次元の数値）」という仮定に基づく。

しかし現実は:
  「能力はベクトル（多次元）であり、その方向がレース条件によって
   活きたり活きなかったりする」

この差が、予測モデルの限界の根源にある。
```

---

## 2. 能力がスカラーではない具体例

### 2-1. 同じ馬が条件で全く違う結果を出す

```
馬X:
  芝1200m良馬場: [1着, 2着, 1着, 3着, 1着] → 勝率60%
  芝2400m良馬場: [8着, 12着, 10着]          → 勝率0%
  芝1200m重馬場: [7着, 9着]                  → 勝率0%

スカラーモデルの評価:
  「馬Xの能力 = まあまあ（全走の平均着順: 5.3着）」
  → 全条件で同じ予測を出す → 1200m良馬場で過小評価、
    2400mと重馬場で過大評価

ベクトルモデルの評価:
  馬Xの能力 = {
    スプリントスピード: ★★★★★
    スタミナ:         ★
    重馬場適性:       ★
    瞬発力:          ★★★★
    気性の安定度:     ★★★
  }
  → 1200m良馬場 = スピードが活きる → 好走予測
  → 2400m = スタミナ不足 → 凡走予測
  → 重馬場 = 適性なし → 凡走予測

→ 同じ馬でも、条件に応じて全く異なる予測になる。
  これが「能力の方向性は一定ではない」の意味。
```

### 2-2. 「強い馬」同士の相対関係が条件で逆転する

```
馬A: スピード型（1200m向き）
馬B: スタミナ型（2400m向き）

1200mのレース: A > B（Aが圧勝）
2400mのレース: B > A（Bが圧勝）

スカラーモデル:
  「A の能力 = 90、B の能力 = 90」→ 五分五分
  → どの距離でも五分五分と予測 → 両方のレースで不正確

ベクトルモデル:
  Aの能力 = (スピード: 95, スタミナ: 70)
  Bの能力 = (スピード: 70, スタミナ: 95)
  1200mの条件 = スピード重視（重み: スピード0.8, スタミナ0.2）
  2400mの条件 = スタミナ重視（重み: スピード0.3, スタミナ0.7）

  1200m: A = 95×0.8 + 70×0.2 = 90, B = 70×0.8 + 95×0.2 = 75 → A圧勝
  2400m: A = 95×0.3 + 70×0.7 = 77.5, B = 70×0.3 + 95×0.7 = 87.5 → B圧勝

→ 条件に応じて重みが変わり、相対関係が逆転する。
  これは実際の競馬でも日常的に起こること。
```

### 2-3. 今日の考察がすべてこの問題に帰着する

```
本日の考察を「能力の多次元性」の視点で再解釈すると:

■ 差し馬のサブタイプ
  「差し」という1次元の分類では捉えられない。
  「ペース適性」という2次元目が存在する。
  → スロー捲り型とハイ追込型は能力の方向が異なる。

■ ポジショニングコスト
  「出たなりで走れる能力」は、スピードやスタミナとは独立した次元。
  ゲート技術、折り合いの巧さ、馬の気性が関わる。
  → 「強いが出たなりで走れない馬」は能力が高くても
    条件次第で凡走する。

■ 盛り返しパターン
  「戦意」「精神力」は、身体能力とは別の次元。
  身体能力が高くても戦意が低い馬は盛り返せない。
  → 能力の方向性の中に「メンタル」が含まれる。

■ 着順バイアス
  着順は「総合力の1次元投影」にすぎない。
  着差の方が情報量が多いのは、1次元投影の解像度が高いから。
  しかし着差でも「なぜ負けたか」の方向性は見えない。

→ これらは全て「能力はスカラーではなくベクトル」の帰結。
```

---

## 3. 能力ベクトルの次元候補

### 身体能力の次元

```
① スピード（トップスピード）
   短距離でのタイム。純粋な速さ。
   測定: 1200m以下のレースの走破タイムから推定。

② スタミナ（持久力）
   長距離を走り切る力。
   測定: 距離が伸びた時の成績変化、ペースが速い時の耐性。

③ 瞬発力（加速力）
   直線での爆発的な加速。上がり3Fの速さ。
   測定: 上がり3F順位の履歴。

④ 持続力（ロングスパート力）
   長い脚を使える力。3-4Fにわたって高速を維持。
   測定: 3角からの仕掛けでゴールまで持つかどうか。
   ★ ③と④は異なる次元。瞬発力は「短距離加速」、持続力は「長距離加速」。

⑤ パワー（坂・重馬場への耐性）
   坂のあるコースや重馬場でのパフォーマンス維持力。
   測定: 中山・阪神（坂あり）vs 新潟・京都（坂なし）の成績差。
         良馬場 vs 重馬場の成績差。

⑥ 体力回復力
   連戦での成績維持力。叩き2戦目の効果。
   測定: 中1-2週での成績、休養明けの成績パターン。
```

### 適性の次元

```
⑦ 距離適性
   ベストパフォーマンスを出せる距離帯。
   ★ これ自体がスカラーではなくベクトル（プロファイル）。
     「1200m: 0.9, 1600m: 1.0, 2000m: 0.8, 2400m: 0.5」のような分布。
   測定: 距離別成績から適性カーブを推定。

⑧ 馬場適性
   良/稍重/重/不良での適性プロファイル。
   測定: 馬場状態別成績。

⑨ コース形態適性
   直線長い vs 小回り、右回り vs 左回り、坂あり vs 平坦。
   測定: コース別成績。

⑩ ペース適性
   スロー/ミドル/ハイのどのペースが合うか。
   → [差し馬サブタイプ](../race/closer_subtypes_slow_vs_highpace.md で考察済み。
   測定: RPCI別成績。
```

### 精神・行動の次元

```
⑪ 気性（テンパーメント）
   折り合いのつきやすさ、掛かりにくさ。
   測定: 前半の通過順位の安定度、掛かり頻度。

⑫ ゲート技術
   出遅れ率、スタートの巧拙。
   → [ポジショニングコスト](../race/positioning_cost_and_natural_running.md で考察済み。

⑬ 戦意・根性
   不利を受けても盛り返す力、接戦での粘り。
   → [盛り返しパターン](../race/rally_after_dropping_position.md で考察済み。

⑭ 集団適性
   多頭数での揉まれ強さ vs 少頭数での方が力を出せるか。
   測定: 頭数別成績。

⑮ 初コース適応力
   初めてのコースでも力を出せるか。
   測定: 初コース vs 2回目以降の成績差。
```

---

## 4. 「能力ベクトル」の視点で何が変わるか

### 4-1. 予測モデルの根本的な再考

```
■ 現在のアプローチ:
  入力: 馬の特徴量 + レースの条件
  出力: 勝率（スカラー）

  LightGBMは特徴量の交互作用を学習するので、
  「距離が長い時はスタミナ型が有利」のようなパターンは拾える。
  → ある意味、暗黙的に能力ベクトルを扱っている。

■ しかし限界がある:
  (a) 経験が浅い馬の能力ベクトルが推定できない
      → 1200mしか走ったことがない馬の2400m適性は不明
      → 特徴量に「2400mの成績」がないので予測不能

  (b) 条件の組合せ爆発
      → 距離×馬場×コース×ペース×頭数×...の全組合せで
        学習するにはデータが足りない

  (c) 能力の「転移」ができない
      → 「1200mで速い = トップスピードが高い」
      → 「トップスピードが高い → 1400mでも通用するはず」
      → この推論がLightGBMにはできない（特徴量の外挿が苦手）

■ 能力ベクトルアプローチなら:
  Step 1: 馬の能力ベクトルを推定
    → 過去成績から(スピード, スタミナ, 瞬発力, ...)を推定
  Step 2: レース条件の「要求ベクトル」を定義
    → このレースが要求する能力の重み
  Step 3: 能力ベクトルと要求ベクトルの内積 = 適合度
    → 適合度が高い馬が好走する

  利点:
    - 1200mの成績から「スピードが高い」と推定
    → 1400m（スピード要求が高い）でも好走を予測できる
    - 能力の「転移」が自然にできる
```

### 4-2. 過去成績の「読み方」が変わる

```
スカラーモデルの読み方:
  「前走3着 → 能力は中の上」
  「前々走8着 → 能力は低い」
  → 平均すると「中くらい」

ベクトルモデルの読み方:
  「前走3着（芝1200m良馬場）→ スプリントスピード: 高」
  「前々走8着（芝2400m重馬場）→ スタミナ: 低、重馬場適性: 低」
  → この馬は「スピード特化型で重馬場が苦手」
  → 今回が芝1400m良馬場なら好走予測

★ 凡走の「理由」を条件のミスマッチに帰属できる。
  スカラーモデル: 凡走 = 能力が低い
  ベクトルモデル: 凡走 = 能力の方向と条件が合わなかった
  → 後者の方が正確であり、次走の予測精度が高い。
```

### 4-3. 「穴馬」の本質が見える

```
穴馬（人気薄で好走する馬）の多くは:
  「平均的な能力はそこそこだが、
   特定の条件で能力が最大化される馬」

例:
  平均着順: 7着（人気薄）
  しかし:
    芝1200m良馬場: 平均3着
    芝2000m重馬場: 平均12着

  → 全体の平均では「弱い馬」
  → 芝1200m良馬場に限れば「強い馬」
  → この条件のレースに出てくると「穴馬として激走」

★ スカラーモデルは「弱い馬」と評価 → オッズ通り or 過小評価
  ベクトルモデルは「この条件なら強い」と評価 → 期待値がある

→ 能力ベクトルの概念を導入すると、
  「なぜ穴馬が来るのか」の構造的な説明ができる。
  そしてそれは予測可能（条件が合っているかどうかで判断）。
```

### 4-4. 馬の成長・衰退の理解が変わる

```
スカラーモデルでの成長:
  「能力が80から90に上がった」

ベクトルモデルでの成長:
  3歳春: (スピード: 85, スタミナ: 60, 瞬発力: 80)
  3歳秋: (スピード: 88, スタミナ: 75, 瞬発力: 83)
  4歳:   (スピード: 90, スタミナ: 85, 瞬発力: 80)

  → スタミナが大きく成長 = 距離延長に対応できるようになった
  → 瞬発力は横ばい = 短距離のキレは変わらない
  → 「どの方向に成長したか」がわかる

これにより:
  - 「3歳秋にスタミナが伸びた → 菊花賞で激走」の予測
  - 「4歳でスピードが落ちた → スプリント戦では以前ほど走れない」の予測
  - 「加齢でスタミナは維持、瞬発力が低下 → 持続力戦向きに」の予測

★ 高齢馬の「能力低下」もベクトル的に理解すべき:
  全ての次元が均一に低下するわけではない。
  スピードは落ちるがスタミナは維持、のような非対称的な衰退がある。
  → 「ベテラン馬の適性変化」を予測に反映できる。
```

---

## 5. 実装のアイデア

### 5-1. アプローチA: LightGBMの特徴量設計で暗黙的に扱う（現実的）

```
能力ベクトルを明示的にモデル化しなくても、
特徴量の設計で「能力の多次元性」を反映できる。

具体的には:
  ■ 条件別の過去成績を特徴量に入れる:
    - 今回と同距離帯での過去好走率
    - 今回と同馬場状態での過去好走率
    - 今回と同コースでの過去好走率
    - 今回と同ペースカテゴリでの過去好走率

  ■ 条件の「一致度」を特徴量に入れる:
    - 前走と今回の距離差
    - 前走と今回の馬場状態の変化
    - 前走と今回のコースの類似度

  ■ 「条件が合った時だけ好走する」パターンの検出:
    - 条件別成績の分散（高い = 条件特化型）
    - ベスト着順とワースト着順の差（大きい = 条件依存）

メリット: 既存のLightGBMパイプラインをそのまま使える
デメリット: 特徴量の設計が人間の仮説に依存する
```

### 5-2. アプローチB: 能力プロファイルの明示的推定（中長期）

```
各馬の「能力ベクトル」を明示的に推定するモデル:

Step 1: 能力次元の定義
  dimensions = [スピード, スタミナ, 瞬発力, 持続力, パワー,
                距離適性, 馬場適性, コース適性, ペース適性, 気性]

Step 2: 過去レースから能力を推定
  各レースの結果は「能力ベクトル × 条件ベクトル + ノイズ」と仮定。

  performance_i = ability_vector · condition_vector_i + noise

  能力ベクトルを推定するには:
  複数のレース結果から逆推定（行列分解的なアプローチ）。

  例:
  レース1（1200m良馬場、着差0.2秒）→ スピード: 高、スタミナ: ?
  レース2（2400m良馬場、着差1.5秒）→ スピード: ?、スタミナ: 低
  レース3（1600m重馬場、着差0.8秒）→ パワー: 中

  → 3レースの情報を統合して能力ベクトルを推定

Step 3: 新レースでの予測
  推定した能力ベクトル × 新レースの条件ベクトル = 予測パフォーマンス

メリット: 理論的に最も正確。転移学習が可能。
デメリット: 実装が複雑。能力次元の定義が恣意的。データ不足。
```

### 5-3. アプローチC: Multi-task Learning（最も自然な統合）

```
LightGBMで複数の目的変数を同時に学習:

目的変数1: 勝率（メインタスク）
目的変数2: 距離適性スコア（サブタスク）
目的変数3: 馬場適性スコア（サブタスク）
目的変数4: ペース適性スコア（サブタスク）

→ メインタスクの学習過程で、サブタスクの情報も活用
→ 「この馬は距離適性が合っている」→ 勝率が高い
  という構造を明示的に学習できる

これはSingle-taskのLightGBMよりも情報効率が高い。
ただし実装はやや複雑（マルチタスク学習のフレームワークが必要）。

★ 実装のステップ:
  まず: アプローチAで条件別特徴量を追加
  次に: アプローチCのマルチタスク化を検討
  将来: アプローチBの能力プロファイル推定
```

---

## 6. 「条件の要求ベクトル」をどう定義するか

### レースが馬に要求するもの

```
各レースは、特定の能力を「要求」する。
この要求ベクトルをモデル化すれば、
能力ベクトルとの適合度を計算できる。

■ 距離による要求の変化:
  1200m: (スピード: 0.9, スタミナ: 0.1, 瞬発力: 0.7, 持続力: 0.3)
  1600m: (スピード: 0.6, スタミナ: 0.3, 瞬発力: 0.5, 持続力: 0.5)
  2400m: (スピード: 0.3, スタミナ: 0.8, 瞬発力: 0.3, 持続力: 0.7)
  3200m: (スピード: 0.2, スタミナ: 0.9, 瞬発力: 0.2, 持続力: 0.8)

■ 馬場状態による要求の変化:
  良馬場: (パワー: 0.3, スピード重視)
  重馬場: (パワー: 0.8, スタミナ重視)

■ コース形態による要求の変化:
  直線長い（東京）: (瞬発力: 0.8, ポジション取り: 0.3)
  小回り（中山内）: (瞬発力: 0.3, ポジション取り: 0.8, パワー: 0.7)

■ ペースによる要求の変化:
  スロー: (瞬発力: 0.9, 持続力: 0.4)
  ハイ:   (瞬発力: 0.4, スタミナ: 0.8, 持続力: 0.7)

★ 全ての要求ベクトルの重みは事前に決めるのではなく、
  過去データから学習するのが理想。
```

### 「条件が変わった時」の予測が最も価値が高い

```
能力ベクトルの最大の価値は:
  「この馬が、未経験の条件でどう走るか」の予測。

例:
  馬X: 芝1200mしか走ったことがない。好成績。
  → スカラーモデル: 「1200mでは強い」（1600mの予測は不明or弱い）
  → ベクトルモデル: 「スピード: 95, 瞬発力: 85」と推定
     → 1400m（スピード要求高め）→ 好走予測
     → 2000m（スタミナ要求高め）→ スタミナが不明だが低い可能性

  馬Y: 芝2000m-2400mを走って好成績。
  → ベクトルモデル: 「スタミナ: 90, 持続力: 85」と推定
     → 1600m短縮（スピード要求UP）→ スピード次第
     → 3000m延長（スタミナ極限）→ 好走予測

★ これは「血統」が従来この役割を果たしてきたもの。
  「ディープインパクト産駒は瞬発力がある」
  = 能力ベクトルの事前分布（ベイジアン的）として血統を使っている。

  データが蓄積されれば血統よりも直接的な推定が可能。
  しかしキャリアが浅い馬（新馬、1-2戦）では
  血統が能力ベクトルの事前情報として依然として重要。
```

---

## 7. 「能力の方向性」から生まれる馬券戦略

### 7-1. 条件マッチング戦略

```
「能力ベクトルと条件ベクトルの適合度が高いのに、
 オッズが全成績の平均に引きずられて過小評価されている馬」を狙う。

具体例:
  馬X: 全成績は平凡（勝率10%、複勝率25%）
  しかし: 芝1200m良馬場の成績は勝率35%、複勝率65%
  今回: 芝1200m良馬場
  オッズ: 全成績を反映して8番人気（30倍）

  → AI: 条件特化の成績を反映 → 実質3-4番人気相当
  → 30倍のオッズに対して勝率35% → EV = 10.5 → 大幅にプラス

★ 市場（オッズ）は「全成績の平均」に基づいて馬を評価する傾向がある。
  条件特化型の馬は、好条件の時に過小評価され、
  悪条件の時に過大評価される。
  → これはAIが突ける構造的な歪み。
```

### 7-2. 条件ミスマッチ回避戦略

```
逆に: 人気馬だが条件が合わない馬を「消す」。

具体例:
  馬Y: 直近3走で連勝中（2番人気、3.5倍）
  しかし: 3連勝はすべて良馬場。今回は重馬場。
  Y の重馬場成績: [7着, 10着]（0勝）

  → AI: 重馬場では能力が発揮できない → 人気ほどの確率はない
  → 人気馬の過大評価を検出 → 相手として馬券を組まない

★ これは [ショート戦略](../../blog-analyses/001_競馬におけるショート戦略.md) の
  本質的な理論的根拠。「人気馬を消す」の根拠が
  「能力の方向性が条件と合わない」。
```

### 7-3. 条件変化の転換点を狙う

```
「前走まで条件が合わなかったが、今回初めて合う条件で走る馬」

具体例:
  馬Z: デビュー以来、芝2000-2400mで [8着, 6着, 10着, 7着]
  しかし: 距離短縮で初の芝1200mに出走
  Zの血統: スプリント血統（父・母父ともに短距離種牡馬）
  Zの上がり3F: 全レースで最速クラス（距離が長くて届かなかった）

  → AI: 「この馬は本来スプリンター。距離適性: 1200m」と推定
  → 初の1200mでも好走を予測
  → オッズ: 過去成績（全て凡走）を反映して大穴
  → 激走の可能性

★ これは現実に頻繁に起こる:
  - 初ダートで激走（芝での凡走は適性違い）
  - 距離大幅短縮で激走（スタミナ不足ではなくスピード不足だった）
  - 初重馬場で激走（パワーが武器だが良馬場では発揮できなかった）

  能力ベクトルの概念があれば、これらを「初挑戦の条件変化」ではなく
  「適性の合致」として予測できる。
```

---

## 8. 能力ベクトルの次元をどこまで増やすか（過学習との戦い）

```
理論的には能力の次元は無限に定義できる:
  スピード, スタミナ, 瞬発力, 持続力, パワー,
  距離適性, 馬場適性, コース適性, ペース適性,
  気性, ゲート技術, 戦意, 集団適性, 季節適性, ...

しかし次元を増やすほど:
  ① 各次元の推定に必要なデータ量が増える
  ② 次元間の相関による多重共線性
  ③ 過学習リスクの増大
  ④ モデルの解釈性の低下

現実的なバランス:

■ 第1階層（最も重要、データで推定可能）:
  距離適性、馬場適性、コース適性
  → これだけで「能力の方向性」の主要な部分をカバー
  → 条件別成績の集計で実装可能

■ 第2階層（重要、間接的に推定可能）:
  ペース適性、瞬発力vs持続力、パワー
  → 上がり3F、通過順位パターン、坂成績で推定
  → 特徴量で表現可能

■ 第3階層（有用、推定が難しい）:
  気性、戦意、ゲート技術、集団適性
  → 間接指標（出遅れ率、盛り返し率、頭数別成績）で近似
  → データ量の問題で精度に限界

■ 第4階層（存在するが現段階では無視）:
  季節適性、天候適性、騎手との相性
  → サンプルサイズが足りない
  → 過学習リスクが高い
  → 将来的にデータが蓄積されれば検討

★ まずは第1-2階層を確実に実装し、
  モデルの精度向上が確認できたら第3階層に進む。
  [過学習の教訓](../../blog-analyses/005_ランダムネスと平均回帰.md) を常に意識。
```

---

## 9. この考察の位置づけ: ナレッジベース全体の「統合理論」

```
このinsightは個別の考察を結びつける上位概念として機能する:

[能力はベクトル（本考察）]
  │
  ├─ スピード vs スタミナ → [距離適性、コース適性]
  ├─ 瞬発力 vs 持続力 → [差し馬サブタイプ]
  ├─ パワー → [馬場適性、坂適性、環境物理学]
  ├─ ペース適性 → [展開シミュレーション、ペースクラッシャー]
  ├─ ポジション取り能力 → [ポジショニングコスト、1コーナー距離]
  ├─ 気性・戦意 → [盛り返しパターン、出たなり]
  ├─ 能力の1次元投影 → [着順バイアス、スカラー評価の限界]
  ├─ 能力の時間変化 → [ローテーション分析]
  ├─ 目的変数の設計 → [着順以外の目的変数]
  └─ 市場の歪み → [馬券市場の構造的非効率性]

→ 「能力はスカラーではなくベクトル」が
  ナレッジベースの多くの考察を統一する原理になる。
```

---

## 10. 他のinsightsとの接続

| この考察の論点 | 関連するinsight |
|---|---|
| 瞬発力 vs 持続力の区別 | [差し馬のサブタイプ](../race/closer_subtypes_slow_vs_highpace.md |
| ポジション取り能力 | [ポジショニングコストと出たなりの優位性](../race/positioning_cost_and_natural_running.md |
| 戦意・精神力の次元 | [盛り返しパターンと充実度](../race/rally_after_dropping_position.md |
| 着順の1次元投影の限界 | [着順バイアス](finishing_position_vs_margin_bias.md) |
| パフォーマンスの多次元評価 | [着順以外の評価基準](beyond_finishing_position.md) |
| 目的変数の再設計 | [着順以外の目的変数](alternative_target_variables.md) |
| 環境条件との相互作用 | [環境物理学](../race/environmental_physics.md |
| 展開条件との相互作用 | [展開シミュレーション](../race/race_scenario_simulation.md |
| 市場がスカラー評価する歪み | [馬券市場の構造的非効率性](../market/market_structural_inefficiencies.md |
| 過学習リスク | [005 ランダムネスと平均回帰](../../blog-analyses/005_ランダムネスと平均回帰.md) |
| Harvilleの固定能力仮定 | [HarvilleのIIA批判](../market/harville_iia_critique.md |

---

## アクションアイテム

- [ ] 条件別過去成績の特徴量群の設計（距離帯別好走率、馬場別好走率、コース別好走率）
- [ ] 「条件マッチ度」の指標設計（今回の条件と過去の好走条件の一致度）
- [ ] 条件特化型 vs 汎用型の分類と回収率分析
- [ ] 「前走と今回の条件変化」特徴量の設計
- [ ] 「人気馬の条件ミスマッチ」検出時の回収率分析
- [ ] 能力ベクトルの次元数と予測精度の関係を検証（過学習チェック）

## タグ

`#モデル` `#特徴量` `#馬券戦略` `#確率論` `#過学習` `#オッズ`
