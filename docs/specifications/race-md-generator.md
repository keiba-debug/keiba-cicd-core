# レース別MDファイル生成機能仕様書

## 1. 概要
各レースの情報を統合したMarkdownファイルを自動生成する機能

## 2. 出力先
```
Z:/KEIBA-CICD/data/organized/
├── 2025/
│   └── 08/
│       └── 16/
│           ├── 札幌/
│           │   ├── 11R_札幌記念_G2.md
│           │   └── 10R_大通公園特別.md
│           ├── 新潟/
│           └── 中京/
```

## 3. MDファイル構造

```markdown
# [競馬場] [R番号] [レース名] ([グレード])
*生成日時: YYYY-MM-DD HH:MM:SS*

## 📅 レース情報
- **日付**: 2025-08-16
- **競馬場**: 札幌
- **レース番号**: 11R
- **レース名**: 札幌記念
- **グレード**: G2
- **距離**: 芝2000m
- **発走時刻**: 15:35
- **天候**: 晴
- **馬場状態**: 良

## 🏇 馬場情報
<!-- 馬場情報ファイルから自動読み込み -->
- **芝状態**: 良好、内回り有利
- **ダート状態**: やや重、外枠有利
- **風向き・風速**: 北西 2m
- **含水率**: 12%

## 📊 レース傾向
<!-- レース傾向ファイルから自動読み込み -->
- **過去3年の傾向**: 先行有利（勝率45%）
- **血統傾向**: ディープインパクト系優勢
- **騎手傾向**: ルメール騎手3連勝中

## 🐎 出馬表

| 枠 | 馬番 | 馬名 | 性齢 | 斤量 | 騎手 | 調教師 | オッズ | 人気 |
|----|------|------|------|------|------|--------|--------|------|
| 1 | 1 | サンプル馬A | 牡5 | 57.0 | ルメール | 藤沢 | 3.2 | 1 |
| 1 | 2 | サンプル馬B | 牝4 | 55.0 | 川田 | 友道 | 5.4 | 2 |

## 📈 調教情報
### 1番 サンプル馬A
- **調教日**: 8/14 栗東坂路
- **タイム**: 52.8-38.2-24.6-12.3
- **評価**: A
- **コメント**: 動き良好、仕上がり上々

## 💬 厩舎コメント
### 1番 サンプル馬A（藤沢調教師）
「順調に仕上がった。前走の疲れも取れて状態は良い」

## 🎯 期待値分析
| 馬番 | 馬名 | 推定勝率 | オッズ | 期待値 | 推奨度 |
|------|------|----------|--------|--------|--------|
| 1 | サンプル馬A | 25% | 3.2 | 0.80 | C |
| 2 | サンプル馬B | 18% | 5.4 | 0.97 | B |

## 📝 外部コメント
<!-- 外部ファイルから読み込み -->
### 福田メモ
- 1番: 前走は展開不利。今回は好走期待
- 2番: 距離短縮がプラス材料

### AIアシスタント分析
- 血統的に良馬場向き
- 展開は逃げ馬不在でスローペース予想

## 🏁 レース結果（レース後更新）
- **1着**: 
- **2着**: 
- **3着**: 
- **払戻**: 

## 📊 回顧（レース後更新）
- **展開**: 
- **ペース**: 
- **特記事項**: 
```

## 4. データソース

### 必須データ
1. **レース日程データ** (`nittei_YYYYMMDD.json`)
2. **出馬表データ** (`shutsuba_YYYYMMDDHHMM.json`)
3. **調教データ** (`cyokyo_YYYYMMDDHHMM.json`)
4. **厩舎コメント** (`danwa_YYYYMMDDHHMM.json`)

### 追加データ
1. **馬場情報ファイル** (`track_condition_YYYYMMDD.json`)
2. **レース傾向ファイル** (`race_trend_YYYYMMDD.json`)
3. **外部コメント** (`external_comments_YYYYMMDD.json`)
4. **過去成績** (`horse_history/[馬名].json`)

## 5. 実装方針

### Phase 1: 基本機能（今日実装）
- レース情報・出馬表のMD生成
- organized フォルダへの出力

### Phase 2: 拡張機能（明日以降）
- 馬場情報・レース傾向の統合
- 外部コメント読み込み
- 過去成績の追加

## 6. コマンド例

```python
# レースMD生成
python generate_race_md.py --date 2025-08-16 --race-id 202501080811

# 一括生成
python generate_race_md.py --date 2025-08-16 --all

# 外部コメント付き
python generate_race_md.py --date 2025-08-16 --race-id 202501080811 --with-comments
```