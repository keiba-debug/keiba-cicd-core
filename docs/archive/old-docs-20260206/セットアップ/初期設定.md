# ç«¶é¦¬ãƒ–ãƒƒã‚¯ ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚·ã‚¹ãƒ†ãƒ  - åˆæœŸè¨­å®šã‚¬ã‚¤ãƒ‰

## ğŸ”§ æ¦‚è¦

ç’°å¢ƒæ§‹ç¯‰å®Œäº†å¾Œã®è©³ç´°ãªåˆæœŸè¨­å®šæ‰‹é †ã‚’èª¬æ˜ã—ã¾ã™ã€‚Cookieèªè¨¼ã®è©³ç´°è¨­å®šã€ç’°å¢ƒå¤‰æ•°ã®æœ€é©åŒ–ã€ã‚·ã‚¹ãƒ†ãƒ ã®å‹•ä½œç¢ºèªã¾ã§ç¶²ç¾…ã—ã¾ã™ã€‚

**æœ€çµ‚æ›´æ–°**: 2025å¹´8æœˆ9æ—¥  
**å‰ææ¡ä»¶**: [ç’°å¢ƒæ§‹ç¯‰.md](ç’°å¢ƒæ§‹ç¯‰.md)ã®å®Œäº†  
**æ‰€è¦æ™‚é–“**: 30-60åˆ†

---

## ğŸª Cookieèªè¨¼è¨­å®šï¼ˆè©³ç´°ç‰ˆï¼‰

### Phase 1: ç«¶é¦¬ãƒ–ãƒƒã‚¯ã‚µã‚¤ãƒˆã§ã®èªè¨¼æƒ…å ±å–å¾—

#### 1. ãƒ–ãƒ©ã‚¦ã‚¶ã§ã®ãƒ­ã‚°ã‚¤ãƒ³
```
URL: https://p.keibabook.co.jp/
```

**æ‰‹é †**:
1. ç«¶é¦¬ãƒ–ãƒƒã‚¯ã®å…¬å¼ã‚µã‚¤ãƒˆã«ã‚¢ã‚¯ã‚»ã‚¹
2. å³ä¸Šã®ã€Œãƒ­ã‚°ã‚¤ãƒ³ã€ã‚’ã‚¯ãƒªãƒƒã‚¯
3. ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæƒ…å ±ã§ãƒ­ã‚°ã‚¤ãƒ³
4. ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸã‚’ç¢ºèª

#### 2. é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«ã§ã®Cookieå–å¾—

**Chrome ã§ã®æ‰‹é †**:
1. **F12ã‚­ãƒ¼**ã‚’æŠ¼ã—ã¦é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«èµ·å‹•
2. **Application**ã‚¿ãƒ–ã‚’ã‚¯ãƒªãƒƒã‚¯
3. å·¦å´ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®**Storage**ã‚’å±•é–‹
4. **Cookies**ã‚’å±•é–‹
5. **https://p.keibabook.co.jp**ã‚’ã‚¯ãƒªãƒƒã‚¯

**å–å¾—ã™ã‚‹Cookieä¸€è¦§**:

| Cookieå | èª¬æ˜ | ä¾‹ |
|----------|------|-----|
| `keibabook_session` | ã‚»ãƒƒã‚·ãƒ§ãƒ³ID | `eyJ0eXAiOiJKV1QiLCJhbGci...` |
| `tk` | èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ | `abcd1234efgh5678...` |
| `XSRF-TOKEN` | CSRFä¿è­·ãƒˆãƒ¼ã‚¯ãƒ³ | `1234567890abcdef...` |

#### 3. Cookieã®æœ‰åŠ¹æ€§ç¢ºèª

**æ‰‹é †**:
1. å„Cookieã®å€¤ã‚’ãƒ¡ãƒ¢å¸³ã«ã‚³ãƒ”ãƒ¼
2. å€¤ãŒç©ºã§ãªã„ã“ã¨ã‚’ç¢ºèª
3. æœ‰åŠ¹æœŸé™ãŒååˆ†é•·ã„ã“ã¨ã‚’ç¢ºèª

**æ³¨æ„ç‚¹**:
- Cookieã¯ä¸€å®šæœŸé–“ã§ç„¡åŠ¹ã«ãªã‚Šã¾ã™
- å€¤ã«ã‚¹ãƒšãƒ¼ã‚¹ã‚„æ”¹è¡ŒãŒå«ã¾ã‚Œã¦ã„ãªã„ã“ã¨ã‚’ç¢ºèª
- ç‰¹æ®Šæ–‡å­—ï¼ˆ`"`, `'`, `\`ãªã©ï¼‰ã«æ³¨æ„

---

## âš™ï¸ ç’°å¢ƒå¤‰æ•°è©³ç´°è¨­å®š

### Phase 2: .env ãƒ•ã‚¡ã‚¤ãƒ«ã®è©³ç´°è¨­å®š

#### 1. .envãƒ•ã‚¡ã‚¤ãƒ«ã®å…¨é …ç›®è¨­å®š
```bash
# .envãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç·¨é›†
nano .env
# ã¾ãŸã¯ Windows ã®å ´åˆ
notepad .env
```

**å®Œå…¨ãª.envãƒ•ã‚¡ã‚¤ãƒ«ä¾‹**:
```bash
# === ãƒ‡ãƒ¼ã‚¿ä¿å­˜è¨­å®š ===
KEIBA_DATA_ROOT_DIR=./data
KEIBA_DATA_DIR=./data  
KEIBA_DEBUG_DIR=./data/debug
KEIBA_LOG_DIR=./logs

# === èªè¨¼è¨­å®š ===
KEIBABOOK_SESSION=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9...
KEIBABOOK_TK=abcd1234efgh5678ijkl...  
KEIBABOOK_XSRF_TOKEN=1234567890abcdef...

# === ãƒ­ã‚°è¨­å®š ===
LOG_LEVEL=INFO
DEBUG=false

# === å‡¦ç†ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è¨­å®š ===
DEFAULT_TIMEOUT=30
DEFAULT_SLEEP_TIME=1.0
MAX_RETRY_COUNT=3
DEFAULT_DELAY=1

# === ä¸¦åˆ—å‡¦ç†è¨­å®š ===
MAX_WORKERS=5
CONNECTION_POOL_SIZE=10

# === å“è³ªç›£è¦–è¨­å®š ===
QUALITY_THRESHOLD=95.0
ALERT_ENABLED=true

# === ãã®ä»–è¨­å®š ===
USER_AGENT="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36"
```

#### 2. Windows PowerShell ã§ã®ç’°å¢ƒå¤‰æ•°è¨­å®š
```powershell
# PowerShellã§ã®ä¸€æ™‚çš„ãªç’°å¢ƒå¤‰æ•°è¨­å®š
$env:DATA_ROOT= "C:\keiba_data"
$env:LOG_LEVEL = "INFO"

# æ°¸ç¶šçš„ãªè¨­å®šï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ç’°å¢ƒå¤‰æ•°ï¼‰
[Environment]::SetEnvironmentVariable("KEIBA_DATA_ROOT_DIR", "C:\keiba_data", "User")
[Environment]::SetEnvironmentVariable("LOG_LEVEL", "INFO", "User")

# è¨­å®šç¢ºèª
echo $env:KEIBA_DATA_ROOT_DIR
```

#### 3. Linux/macOS ã§ã®ç’°å¢ƒå¤‰æ•°è¨­å®š
```bash
# ~/.bashrc ã¾ãŸã¯ ~/.zshrc ã¸ã®è¿½åŠ 
echo 'export KEIBA_DATA_ROOT_DIR="/home/user/keiba_data"' >> ~/.bashrc
echo 'export LOG_LEVEL="INFO"' >> ~/.bashrc

# å³åº§ã«åæ˜ 
source ~/.bashrc

# è¨­å®šç¢ºèª
echo $KEIBA_DATA_ROOT_DIR
```

---

## ğŸ“ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ æœ€é©åŒ–

### Phase 3: è©³ç´°ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªè¨­å®š

#### 1. ã‚«ã‚¹ã‚¿ãƒ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ä½œæˆ
```bash
# åŸºæœ¬æ§‹é€ ï¼ˆçµ±ä¸€ä¿å­˜ï¼‰
mkdir -p "$KEIBA_DATA_ROOT_DIR"
mkdir -p "$KEIBA_DATA_ROOT_DIR/race_ids"  
mkdir -p "$KEIBA_LOG_DIR"
mkdir -p "$KEIBA_DEBUG_DIR"

# ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªï¼ˆæ¨å¥¨ï¼‰
mkdir -p "$KEIBA_DATA_ROOT_DIR/backup"
mkdir -p "$KEIBA_DATA_ROOT_DIR/archive"

# ä¸€æ™‚ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
mkdir -p "$KEIBA_DATA_ROOT_DIR/tmp"

# Windows PowerShellç‰ˆ
New-Item -ItemType Directory -Path "$env:KEIBA_DATA_ROOT_DIR" -Force
New-Item -ItemType Directory -Path "$env:KEIBA_DATA_ROOT_DIR\race_ids" -Force
New-Item -ItemType Directory -Path "$env:KEIBA_LOG_DIR" -Force
```

#### 2. ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ¨©é™è¨­å®šï¼ˆLinux/macOSï¼‰
```bash
# æ‰€æœ‰è€…ã¨ã‚°ãƒ«ãƒ¼ãƒ—è¨­å®š
sudo chown -R $USER:$USER "$KEIBA_DATA_ROOT_DIR"
sudo chown -R $USER:$USER "$KEIBA_LOG_DIR"

# ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™è¨­å®š
chmod 755 "$KEIBA_DATA_ROOT_DIR"
chmod 755 "$KEIBA_DATA_ROOT_DIR/race_ids"
chmod 755 "$KEIBA_LOG_DIR"
chmod 755 "$KEIBA_DEBUG_DIR"

# æ›¸ãè¾¼ã¿æ¨©é™ç¢ºèª
touch "$KEIBA_DATA_ROOT_DIR/test_write" && rm "$KEIBA_DATA_ROOT_DIR/test_write" && echo "âœ… æ›¸ãè¾¼ã¿OK"
```

#### 3. ãƒ‡ã‚£ã‚¹ã‚¯å®¹é‡è¨­å®šç¢ºèª
```bash
# ãƒ‡ã‚£ã‚¹ã‚¯ä½¿ç”¨é‡ç¢ºèª
df -h "$KEIBA_DATA_ROOT_DIR"

# åˆ©ç”¨å¯èƒ½å®¹é‡ç¢ºèªï¼ˆæ¨å¥¨: 2GBä»¥ä¸Šï¼‰
python -c "
import os
import shutil
data_dir = os.getenv('KEIBA_DATA_ROOT_DIR', './data')
total, used, free = shutil.disk_usage(data_dir)
print(f'ç·å®¹é‡: {total // (1024**3)} GB')
print(f'ä½¿ç”¨æ¸ˆã¿: {used // (1024**3)} GB') 
print(f'åˆ©ç”¨å¯èƒ½: {free // (1024**3)} GB')
if free // (1024**3) < 2:
    print('âš ï¸ è­¦å‘Š: åˆ©ç”¨å¯èƒ½å®¹é‡ãŒ2GBæœªæº€ã§ã™')
else:
    print('âœ… å®¹é‡OK')
"
```

---

## ğŸ” ã‚·ã‚¹ãƒ†ãƒ å‹•ä½œç¢ºèª

### Phase 4: è©³ç´°å‹•ä½œãƒ†ã‚¹ãƒˆ

#### 1. Cookieèªè¨¼ãƒ†ã‚¹ãƒˆ
```bash
# Cookieèªè¨¼ã®è©³ç´°ãƒ†ã‚¹ãƒˆ
python -c "
import sys
sys.path.insert(0, 'src')
from dotenv import load_dotenv
from keibabook.batch.core.common import create_authenticated_session
import os

load_dotenv()

# Cookieç¢ºèª
cookies = {
    'KEIBABOOK_SESSION': os.getenv('KEIBABOOK_SESSION', ''),
    'KEIBABOOK_TK': os.getenv('KEIBABOOK_TK', ''),  
    'KEIBABOOK_XSRF_TOKEN': os.getenv('KEIBABOOK_XSRF_TOKEN', '')
}

print('=== Cookieè¨­å®šç¢ºèª ===')
for name, value in cookies.items():
    if value:
        print(f'âœ… {name}: è¨­å®šæ¸ˆã¿ ({len(value)}æ–‡å­—)')
    else:
        print(f'âŒ {name}: æœªè¨­å®š')

# ã‚»ãƒƒã‚·ãƒ§ãƒ³ä½œæˆãƒ†ã‚¹ãƒˆ
try:
    session = create_authenticated_session()
    print('âœ… èªè¨¼ã‚»ãƒƒã‚·ãƒ§ãƒ³ä½œæˆ: OK')
    
    # ãƒ†ã‚¹ãƒˆãƒªã‚¯ã‚¨ã‚¹ãƒˆ
    response = session.get('https://p.keibabook.co.jp/', timeout=10)
    print(f'âœ… ãƒ†ã‚¹ãƒˆãƒªã‚¯ã‚¨ã‚¹ãƒˆ: HTTP {response.status_code}')
except Exception as e:
    print(f'âŒ èªè¨¼ãƒ†ã‚¹ãƒˆå¤±æ•—: {e}')
"
```

#### 2. ã‚·ã‚¹ãƒ†ãƒ ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆç¢ºèª
```bash
# ä¸»è¦ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®è©³ç´°ç¢ºèª
python -c "
import sys
sys.path.insert(0, 'src')

components = [
    ('keibabook.utils.config', 'Config'),
    ('keibabook.batch.core.common', 'BatchStats'),
    ('keibabook.batch.data_fetcher', 'DataFetcher'),
    ('keibabook.batch.optimized_data_fetcher', 'OptimizedDataFetcher'),
    ('keibabook.scrapers.requests_scraper', 'RequestsScraper'),
    ('keibabook.parsers.seiseki_parser', 'SeisekiParser'),
]

print('=== ã‚·ã‚¹ãƒ†ãƒ ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆç¢ºèª ===')
for module_name, class_name in components:
    try:
        module = __import__(module_name, fromlist=[class_name])
        cls = getattr(module, class_name)
        print(f'âœ… {module_name}.{class_name}: OK')
    except Exception as e:
        print(f'âŒ {module_name}.{class_name}: {e}')
"
```

#### 3. ãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜ãƒ†ã‚¹ãƒˆ
```bash
# ãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜ãƒ»èª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆ
python -c "
import sys
sys.path.insert(0, 'src')
from dotenv import load_dotenv
from keibabook.batch.core.common import get_json_file_path, get_race_ids_file_path
import json
import os

load_dotenv()

# ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿
test_data = {
    'test': 'ãƒ‡ãƒ¼ã‚¿ä¿å­˜ãƒ†ã‚¹ãƒˆ',
    'timestamp': '2025-08-09',
    'status': 'OK'
}

print('=== ãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜ãƒ†ã‚¹ãƒˆ ===')

# JSONä¿å­˜ãƒ†ã‚¹ãƒˆ
try:
    json_path = get_json_file_path('test', '20250809')
    with open(json_path, 'w', encoding='utf-8') as f:
        json.dump(test_data, f, ensure_ascii=False, indent=2)
    print(f'âœ… JSONä¿å­˜: {json_path}')
    
    # èª­ã¿è¾¼ã¿ç¢ºèª
    with open(json_path, 'r', encoding='utf-8') as f:
        loaded_data = json.load(f)
    print(f'âœ… JSONèª­ã¿è¾¼ã¿: {loaded_data[\"test\"]}')
    
    # ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
    os.unlink(json_path)
    print('âœ… ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«å‰Šé™¤å®Œäº†')
    
except Exception as e:
    print(f'âŒ ãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜ãƒ†ã‚¹ãƒˆå¤±æ•—: {e}')
"
```

---

## ğŸš€ å®Ÿãƒ‡ãƒ¼ã‚¿ã§ã®å‹•ä½œç¢ºèª

### Phase 5: å®Ÿç’°å¢ƒãƒ†ã‚¹ãƒˆ

#### 1. æœ€å°é™ã®ãƒ¬ãƒ¼ã‚¹æ—¥ç¨‹å–å¾—ãƒ†ã‚¹ãƒˆ
```bash
# é–‹å‚¬ãŒã‚ã‚‹æ—¥ã§ã®ãƒ†ã‚¹ãƒˆï¼ˆä¾‹: 2024å¹´12æœˆ28æ—¥ï¼‰
python -m src.batch_cli schedule --start-date 2024/12/28 --debug

# çµæœç¢ºèª
echo "=== å–å¾—çµæœç¢ºèª ==="
ls -la "$KEIBA_DATA_ROOT_DIR/race_ids/"

# JSONå†…å®¹ç¢ºèª
if [ -f "$KEIBA_DATA_ROOT_DIR/race_ids/20241228_info.json" ]; then
    echo "âœ… ãƒ¬ãƒ¼ã‚¹IDå–å¾—æˆåŠŸ"
    python -c "
import json
with open('$KEIBA_DATA_ROOT_DIR/race_ids/20241228_info.json', 'r', encoding='utf-8') as f:
    data = json.load(f)
print(f'å–å¾—é–‹å‚¬æ•°: {len(data.get(\"kaisai_data\", {}))}')
total_races = sum(len(races) for races in data.get('kaisai_data', {}).values())
print(f'ç·ãƒ¬ãƒ¼ã‚¹æ•°: {total_races}')
"
else
    echo "âŒ ãƒ¬ãƒ¼ã‚¹IDå–å¾—å¤±æ•—ã¾ãŸã¯é–‹å‚¬ãªã—"
fi
```

#### 2. å˜ä¸€ãƒ¬ãƒ¼ã‚¹ãƒ‡ãƒ¼ã‚¿å–å¾—ãƒ†ã‚¹ãƒˆ
```bash
# ç‰¹å®šãƒ¬ãƒ¼ã‚¹ã®æˆç¸¾ãƒ‡ãƒ¼ã‚¿å–å¾—ãƒ†ã‚¹ãƒˆ
python -m src.batch_cli data --start-date 2024/12/28 --data-types seiseki --debug

# çµæœç¢ºèª
echo "=== æˆç¸¾ãƒ‡ãƒ¼ã‚¿ç¢ºèª ==="
ls -la "$KEIBA_DATA_ROOT_DIR/"seiseki_*.json | head -3

# æœ€åˆã®ãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹ç¢ºèª
FIRST_FILE=$(ls "$KEIBA_DATA_ROOT_DIR/"seiseki_*.json 2>/dev/null | head -1)
if [ -f "$FIRST_FILE" ]; then
    echo "âœ… æˆç¸¾ãƒ‡ãƒ¼ã‚¿å–å¾—æˆåŠŸ: $(basename $FIRST_FILE)"
    python -c "
import json
with open('$FIRST_FILE', 'r', encoding='utf-8') as f:
    data = json.load(f)
print(f'ãƒ¬ãƒ¼ã‚¹å: {data.get(\"race_info\", {}).get(\"race_name\", \"ä¸æ˜\")}')
print(f'å‡ºèµ°é ­æ•°: {len(data.get(\"results\", []))}é ­')
"
else
    echo "âŒ æˆç¸¾ãƒ‡ãƒ¼ã‚¿å–å¾—å¤±æ•—"
fi
```

#### 3. é«˜é€Ÿç‰ˆå‹•ä½œç¢ºèªï¼ˆå¯èƒ½ãªå ´åˆï¼‰
```bash
# é«˜é€Ÿç‰ˆã®ãƒ†ã‚¹ãƒˆï¼ˆä¿®æ­£æ¸ˆã¿ã®å ´åˆï¼‰
python -m src.fast_batch_cli schedule --start-date 2024/12/28 --delay 1 --debug 2>/dev/null
if [ $? -eq 0 ]; then
    echo "âœ… é«˜é€Ÿç‰ˆå‹•ä½œç¢ºèªæˆåŠŸ"
else
    echo "âš ï¸ é«˜é€Ÿç‰ˆã¯ç¾åœ¨ä¿®æ­£ä¸­ã§ã™ï¼ˆå¾“æ¥ç‰ˆã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„ï¼‰"
fi
```

---

## ğŸ“Š ã‚·ã‚¹ãƒ†ãƒ è¨­å®šã®æœ€é©åŒ–

### Phase 6: æ€§èƒ½æœ€é©åŒ–è¨­å®š

#### 1. ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡æœ€é©åŒ–è¨­å®š
```bash
# ãƒ¡ãƒ¢ãƒªè¨­å®šç¢ºèªãƒ»æœ€é©åŒ–
python -c "
import psutil
import os
from dotenv import load_dotenv

load_dotenv()

# ã‚·ã‚¹ãƒ†ãƒ ãƒ¡ãƒ¢ãƒªç¢ºèª
mem = psutil.virtual_memory()
print(f'=== ã‚·ã‚¹ãƒ†ãƒ ãƒ¡ãƒ¢ãƒªæƒ…å ± ===')
print(f'ç·ãƒ¡ãƒ¢ãƒª: {mem.total // (1024**3)} GB')
print(f'åˆ©ç”¨å¯èƒ½: {mem.available // (1024**3)} GB')
print(f'ä½¿ç”¨ç‡: {mem.percent}%')

# æ¨å¥¨è¨­å®š
if mem.total >= 8 * (1024**3):  # 8GBä»¥ä¸Š
    rec_workers = 12
    rec_delay = 0.3
elif mem.total >= 4 * (1024**3):  # 4GBä»¥ä¸Š
    rec_workers = 8
    rec_delay = 0.5
else:
    rec_workers = 3
    rec_delay = 1.0

print(f'\\n=== æ¨å¥¨è¨­å®š ===')
print(f'MAX_WORKERS: {rec_workers}')
print(f'DEFAULT_DELAY: {rec_delay}')

# .envãƒ•ã‚¡ã‚¤ãƒ«æ›´æ–°ææ¡ˆ
print(f'\\n# .envãƒ•ã‚¡ã‚¤ãƒ«ã«è¿½åŠ ã™ã‚‹ã“ã¨ã‚’æ¨å¥¨:')
print(f'MAX_WORKERS={rec_workers}')  
print(f'DEFAULT_DELAY={rec_delay}')
"
```

#### 2. ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯è¨­å®šæœ€é©åŒ–
```bash
# ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šãƒ†ã‚¹ãƒˆãƒ»æœ€é©åŒ–
python -c "
import requests
import time

print('=== ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ€§èƒ½ãƒ†ã‚¹ãƒˆ ===')

# æ¥ç¶šé€Ÿåº¦ãƒ†ã‚¹ãƒˆ
start_time = time.time()
try:
    response = requests.get('https://p.keibabook.co.jp/', timeout=10)
    elapsed = time.time() - start_time
    print(f'æ¥ç¶šæ™‚é–“: {elapsed:.2f}ç§’')
    
    if elapsed < 1.0:
        print('âœ… é«˜é€Ÿæ¥ç¶š - delay 0.3ç§’æ¨å¥¨') 
    elif elapsed < 3.0:
        print('âœ… æ¨™æº–æ¥ç¶š - delay 0.5-1.0ç§’æ¨å¥¨')
    else:
        print('âš ï¸ ä½é€Ÿæ¥ç¶š - delay 2.0ç§’ä»¥ä¸Šæ¨å¥¨')
        
except Exception as e:
    print(f'âŒ æ¥ç¶šãƒ†ã‚¹ãƒˆå¤±æ•—: {e}')
"
```

---

## ğŸ”’ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®š

### Phase 7: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–

#### 1. ãƒ•ã‚¡ã‚¤ãƒ«æ¨©é™ã®è©³ç´°è¨­å®šï¼ˆLinux/macOSï¼‰
```bash
# .envãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–
chmod 600 .env  # æ‰€æœ‰è€…ã®ã¿èª­ã¿æ›¸ãå¯èƒ½
ls -la .env

# ãƒ‡ãƒ¼ã‚¿ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®é©åˆ‡ãªæ¨©é™è¨­å®š
find "$KEIBA_DATA_ROOT_DIR" -type d -exec chmod 755 {} \;
find "$KEIBA_DATA_ROOT_DIR" -type f -exec chmod 644 {} \;

echo "âœ… ãƒ•ã‚¡ã‚¤ãƒ«æ¨©é™è¨­å®šå®Œäº†"
```

#### 2. Cookieã®å®šæœŸæ›´æ–°è¨­å®š
```bash
# Cookieæœ‰åŠ¹æœŸé™ãƒã‚§ãƒƒã‚«ãƒ¼ã®ä½œæˆ
cat > check_cookies.py << 'EOF'
#!/usr/bin/env python3
import sys
sys.path.insert(0, 'src')
from dotenv import load_dotenv
from keibabook.batch.core.common import create_authenticated_session
import requests
import os

load_dotenv()

def check_cookies():
    """Cookieæœ‰åŠ¹æ€§ç¢ºèª"""
    try:
        session = create_authenticated_session()
        response = session.get('https://p.keibabook.co.jp/', timeout=10)
        
        if response.status_code == 200:
            print("âœ… Cookieæœ‰åŠ¹")
            return True
        else:
            print(f"âš ï¸ Cookieç„¡åŠ¹ã®å¯èƒ½æ€§: HTTP {response.status_code}")
            return False
            
    except Exception as e:
        print(f"âŒ Cookieç¢ºèªå¤±æ•—: {e}")
        return False

if __name__ == "__main__":
    check_cookies()
EOF

chmod +x check_cookies.py
python check_cookies.py
```

---

## âœ… åˆæœŸè¨­å®šå®Œäº†ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### ğŸª èªè¨¼è¨­å®š
- [ ] ç«¶é¦¬ãƒ–ãƒƒã‚¯ã‚µã‚¤ãƒˆã§ãƒ­ã‚°ã‚¤ãƒ³ç¢ºèª
- [ ] 3ã¤ã®Cookieå–å¾—å®Œäº†
- [ ] .envãƒ•ã‚¡ã‚¤ãƒ«ã¸ã®è¨­å®šå®Œäº†
- [ ] Cookieèªè¨¼ãƒ†ã‚¹ãƒˆæˆåŠŸ

### âš™ï¸ ç’°å¢ƒå¤‰æ•°è¨­å®š  
- [ ] .envãƒ•ã‚¡ã‚¤ãƒ«å…¨é …ç›®è¨­å®šå®Œäº†
- [ ] ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãƒ‘ã‚¹è¨­å®šç¢ºèª
- [ ] ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«è¨­å®šç¢ºèª
- [ ] å‡¦ç†ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿è¨­å®šç¢ºèª

### ğŸ“ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªè¨­å®š
- [ ] åŸºæœ¬ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä½œæˆå®Œäº†
- [ ] æ¨©é™è¨­å®šå®Œäº†ï¼ˆLinux/macOSï¼‰
- [ ] ãƒ‡ã‚£ã‚¹ã‚¯å®¹é‡ç¢ºèªå®Œäº†
- [ ] æ›¸ãè¾¼ã¿ãƒ†ã‚¹ãƒˆæˆåŠŸ

### ğŸ” å‹•ä½œç¢ºèª
- [ ] ã‚·ã‚¹ãƒ†ãƒ ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆç¢ºèªå®Œäº†
- [ ] ãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜ãƒ†ã‚¹ãƒˆæˆåŠŸ
- [ ] å®Ÿãƒ‡ãƒ¼ã‚¿å–å¾—ãƒ†ã‚¹ãƒˆæˆåŠŸ  
- [ ] ãƒ­ã‚°å‡ºåŠ›ç¢ºèªå®Œäº†

### ğŸ“Š æ€§èƒ½æœ€é©åŒ–
- [ ] ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ç¢ºèªå®Œäº†
- [ ] æ¨å¥¨è¨­å®šå€¤ç¢ºèªå®Œäº†
- [ ] ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ€§èƒ½ç¢ºèªå®Œäº†

### ğŸ”’ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£
- [ ] ãƒ•ã‚¡ã‚¤ãƒ«æ¨©é™è¨­å®šå®Œäº†
- [ ] Cookieå®šæœŸç¢ºèªè¨­å®šå®Œäº†

---

## ğŸš€ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

åˆæœŸè¨­å®šå®Œäº†å¾Œã®æ¨å¥¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ï¼š

1. **åŸºæœ¬æ“ä½œç¿’å¾—**: [ä½¿ã„æ–¹/åŸºæœ¬æ“ä½œ.md](../ä½¿ã„æ–¹/åŸºæœ¬æ“ä½œ.md)ã§å¾“æ¥ç‰ˆCLIæ“ä½œ
2. **é«˜é€Ÿç‰ˆæ´»ç”¨**: [ä½¿ã„æ–¹/é«˜é€Ÿç‰ˆã®ä½¿ã„æ–¹.md](../ä½¿ã„æ–¹/é«˜é€Ÿç‰ˆã®ä½¿ã„æ–¹.md)ã§æœ€é©åŒ–ç‰ˆç¿’å¾—
3. **å®šæœŸé‹ç”¨**: [ä½¿ã„æ–¹/ãƒãƒƒãƒå‡¦ç†.md](../ä½¿ã„æ–¹/ãƒãƒƒãƒå‡¦ç†.md)ã§è‡ªå‹•åŒ–è¨­å®š
4. **ç›£è¦–è¨­å®š**: [é‹ç”¨/ç›£è¦–ã¨ãƒ­ã‚°.md](../é‹ç”¨/ç›£è¦–ã¨ãƒ­ã‚°.md)ã§ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°

---

**ğŸ‰ åˆæœŸè¨­å®šãŒå®Œäº†ã—ã¾ã—ãŸï¼ã“ã‚Œã§ç«¶é¦¬ãƒ–ãƒƒã‚¯ã‹ã‚‰ã®ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚’æœ¬æ ¼çš„ã«é–‹å§‹ã§ãã¾ã™ã€‚æ®µéšçš„ã«æ©Ÿèƒ½ã‚’ç¿’å¾—ã—ã¦ã€åŠ¹ç‡çš„ãªãƒ‡ãƒ¼ã‚¿åé›†ã‚’å®Ÿç¾ã—ã¾ã—ã‚‡ã†ã€‚**