# Cursor依頼: TARGETコメント連携 Phase 2

## 🎯 目的

Phase 1（読み取り専用）が完了したので、Phase 2として以下を実装したい：
1. **全頭コメント一括表示機能** - UI改善
2. **コメント編集・書き込み機能** - TARGETへの書き戻し

## 📋 Phase 2-A: 全頭コメント一括表示

### 現状の課題
- 現在は一頭ずつホバーしてコメントを確認する必要がある
- レース全体のコメントを俯瞰できない

### 実装案（推奨: B案）

**B案: モーダル一覧表示**
- 出馬表の上部に「コメント一覧」ボタンを追加
- クリックでモーダルを開く
- モーダル内に全馬のコメントを一覧表示

```
+-----------------------------------+
| コメント一覧           [×]        |
+-----------------------------------+
| 馬番 | 馬名           | コメント  |
|------|----------------|----------|
| 1    | セクシーマージュ | 千二対応 |
| 2    | スマッシュアウト | 輸送対策 |
| ...  | ...            | ...      |
+-----------------------------------+
```

### UI仕様
- 予想コメント（YOS_COM）と結果コメント（KEK_COM）を色分け表示
- コメントがある馬のみ表示 or 全馬表示の切り替え
- モーダルは出馬表と同時に見られるサイズ

---

## 📋 Phase 2-B: コメント編集・書き込み機能

### 機能要件
1. **インライン編集**
   - コメントアイコンをクリックで編集モードに
   - テキストエリアで編集 → 保存ボタン

2. **モーダル内編集**
   - 一括表示モーダル内で直接編集
   - 変更があった行をハイライト

3. **新規コメント追加**
   - コメントがない馬にも追加可能

### 技術要件
- **Server Actions** または **API Routes** で書き込み処理
- TARGETと同じフォーマット（Shift-JIS, CSV形式）で保存
- ファイルロック対策: 書き込み前にファイル存在確認
- エラーハンドリング: 書き込み失敗時のフィードバック

### 書き込み先
```
E:\TFJV\MY_DATA\YOS_COM\{年}\{レースID}.csv  # 予想コメント
E:\TFJV\MY_DATA\KEK_COM\{年}\{レースID}.csv  # 結果コメント
E:\TFJV\MY_DATA\UMA_COM\{馬ID}.csv           # 馬コメント
```

---

## 📂 参考: Phase 1で作成したファイル

- `src/lib/data/target-comment-reader.ts` - 読み取りAPI（これを拡張）
- `src/components/race-v2/HorseEntryTable.tsx` - 出馬表コンポーネント

---

## 🚀 進め方

1. **Phase 2-A（一括表示）を先に実装**
   - 読み取り専用の延長なのでリスクが低い
   - UI改善で即座に使いやすくなる

2. **Phase 2-B（書き込み）は後回し**
   - 一括表示で運用してみてから判断
   - TARGETとの同時使用の問題がないか確認後に実装

---

## ❓ 確認事項

- Phase 2-Aから着手してOK？
- モーダルのUIデザインは任せる？それとも具体的な要望ある？
