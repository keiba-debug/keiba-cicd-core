# é‹ç”¨ã‚µãƒãƒ¼ãƒˆ - ç«¶é¦¬äºˆæƒ³æº–å‚™

## 0. KeibaCICD.WebViewer èµ·å‹•

### èµ·å‹•æ–¹æ³•

```powershell
# ç’°å¢ƒå¤‰æ•°è¨­å®šï¼ˆå¿…è¦ãªç’°å¢ƒå¤‰æ•°ã¯2ã¤ã ã‘ï¼‰
$env:KEIBA_DATA_ROOT_DIR = "E:\share\KEIBA-CICD\data2"  # ç«¶é¦¬ãƒ‡ãƒ¼ã‚¿å…¨èˆ¬
$env:JV_DATA_ROOT_DIR = "E:\TFJV"                       # JRA-VANç”Ÿãƒ‡ãƒ¼ã‚¿

cd .\keiba-cicd-core\KeibaCICD.WebViewer
npm run dev
npm run dev:webpack
```

**æ³¨**: `DATA_ROOT` ã¨ `LOG_DIR` ç’°å¢ƒå¤‰æ•°ã¯å‰Šé™¤ã•ã‚Œã¾ã—ãŸã€‚ãƒ­ã‚°ã¯ `KEIBA_DATA_ROOT_DIR/logs` ã«è‡ªå‹•ä¿å­˜ã•ã‚Œã¾ã™ã€‚

ãƒ–ãƒ©ã‚¦ã‚¶ã§ http://localhost:3000 ã‚’é–‹ãã¾ã™ã€‚

### ä¸»è¦ãƒšãƒ¼ã‚¸

| ãƒšãƒ¼ã‚¸ | URL | èª¬æ˜ |
|:---|:---|:---|
| ãƒˆãƒƒãƒ— | http://localhost:3000 | æ—¥ä»˜é¸æŠãƒ»ãƒ¬ãƒ¼ã‚¹ä¸€è¦§ |
| ç®¡ç†ç”»é¢ | http://localhost:3000/admin | keibabookãƒ‡ãƒ¼ã‚¿å–å¾—ãƒ»ãƒãƒƒãƒå®Ÿè¡Œ |
| é¦¬æ¤œç´¢ | http://localhost:3000/horses | é¦¬åæ¤œç´¢ãƒ»ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«è¡¨ç¤º |
| ãƒãƒ«ãƒãƒ“ãƒ¥ãƒ¼ | http://localhost:3000/multi-view | JRAæ˜ åƒä¸¦åˆ—è¡¨ç¤ºï¼ˆ2ç”»é¢/4ç”»é¢ï¼‰ |

### ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹

ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: `Z:/KEIBA-CICD/data2/`

å¤‰æ›´ã™ã‚‹å ´åˆã¯ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®š:
```powershell
$env:DATA_ROOT = "C:/path/to/your/data"
npm run dev
```

- **BABA**ï¼ˆã‚¯ãƒƒã‚·ãƒ§ãƒ³å€¤ãƒ»å«æ°´ç‡ï¼‰: å ´æ‰€ã¯å¸¸ã« **JV_DATA_ROOT_DIR ã®ã‚µãƒ–ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª _BABA ä»¥ä¸‹**ã€‚`JV_DATA_ROOT_DIR` ã‚’å¤‰ãˆã‚‹ã¨ BABA ã®å‚ç…§å…ˆã‚‚å¤‰ã‚ã‚‹ã€‚

### é¦¬å ´ã‚³ãƒ³ãƒ‡ã‚£ã‚·ãƒ§ãƒ³ï¼ˆã‚¯ãƒƒã‚·ãƒ§ãƒ³å€¤ãƒ»å«æ°´ç‡ï¼‰ãŒè¡¨ç¤ºã•ã‚Œãªã„å ´åˆ

ãƒ¬ãƒ¼ã‚¹çµæœåˆ†æç”»é¢ï¼ˆ/races-v2/æ—¥ä»˜/ç«¶é¦¬å ´/ãƒ¬ãƒ¼ã‚¹IDï¼‰ã§ã€Œé¦¬å ´: ã‚¯ãƒƒã‚·ãƒ§ãƒ³ â—‹â—‹ / Gå‰ â—‹â—‹% â€¦ã€ãŒå‡ºãªã„ã¨ãã¯ã€æ¬¡ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚

1. **JV_DATA_ROOT_DIR**  
   BABA ã® CSV ã¯ `JV_DATA_ROOT_DIR/_BABA` ã‚’å‚ç…§ã—ã¾ã™ã€‚æœªè¨­å®šæ™‚ã¯ `Y:/_BABA` ã«ãªã‚Šã¾ã™ã€‚  
   å®Ÿéš›ã® BABA ãŒ `E:\TFJV\_BABA` ã«ã‚ã‚‹å ´åˆã¯ã€èµ·å‹•å‰ã«æ¬¡ã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚  
   `$env:JV_DATA_ROOT_DIR = "E:\TFJV"`

2. **race_info.json ã¨ kaisai_data**  
   è©²å½“æ—¥ã® `DATA_ROOT/races/å¹´/æœˆ/æ—¥/race_info.json` ã« **kaisai_data** ãŒã‚ã‚Šã€ãã®ä¸­ã«ã€Œ1å›äº¬éƒ½7æ—¥ç›®ã€ã®ã‚ˆã†ã«ç«¶é¦¬å ´ãƒ»å›ãƒ»æ—¥ãŒå…¥ã£ã¦ã„ã‚‹ã“ã¨ã€‚  
   è¡¨ç¤ºã¯ã€ã“ã® kaisai_data ã‹ã‚‰ã€Œå›ãƒ»æ—¥ã€ã‚’å–å¾—ã—ã¦ BABA ã® RX_ID ã‚’çµ„ã¿ç«‹ã¦ã¦ã„ã¾ã™ã€‚  
   kaisai_data ãŒç©ºã‚„ç„¡ã„å ´åˆã¯ã€è©²å½“æ—¥ã® **race_info.json ã‚’å†å–å¾—ãƒ»å†é…ç½®**ã—ã¦ãã ã•ã„ï¼ˆkeibabook ã® nittei å–å¾—ã‚„ race_ids ã®æ›´æ–°ãªã©ï¼‰ã€‚

3. **BABA ã® CSV ãƒ•ã‚¡ã‚¤ãƒ«**  
   `JV_DATA_ROOT_DIR/_BABA` ã®ä¸‹ã«ã€å¯¾è±¡å¹´ã”ã¨ã®æ¬¡ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚ã‚‹ã“ã¨ã€‚  
   - `cushion2026.csv`ï¼ˆã‚¯ãƒƒã‚·ãƒ§ãƒ³å€¤ï¼‰  
   - `moistureG_2026.csv`ï¼ˆã‚´ãƒ¼ãƒ«å‰å«æ°´ç‡ï¼‰  
   - `moisture4_2026.csv`ï¼ˆ4ã‚³ãƒ¼ãƒŠãƒ¼å«æ°´ç‡ï¼‰  
   è©²å½“ãƒ¬ãƒ¼ã‚¹ã® RX_ID ãŒ CSV ã«å«ã¾ã‚Œã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚  
   å†ä½œæˆãŒå¿…è¦ãªå ´åˆã¯ã€BABA ãƒ‡ãƒ¼ã‚¿ã‚’ JV ç­‰ã‹ã‚‰å–å¾—ã—ã€ä¸Šè¨˜ãƒ‘ã‚¹ã«é…ç½®ã—ã¦ãã ã•ã„ã€‚

4. **ãƒ‡ãƒãƒƒã‚°APIã§åŸå› ã‚’ç¢ºèª**  
   è¡¨ç¤ºã•ã‚Œãªã„å ´åˆã€æ¬¡ã®URLã‚’ãƒ–ãƒ©ã‚¦ã‚¶ã§é–‹ãã¨ã€Œã©ã“ã§æ­¢ã¾ã£ã¦ã„ã‚‹ã‹ã€ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚  
   `http://localhost:3000/api/debug/baba?date=2026-01-25&track=äº¬éƒ½&raceId=202601250809`  
   ï¼ˆ`date` / `track` / `raceId` ã¯ã€è¡¨ç¤ºã—ãŸã„ãƒ¬ãƒ¼ã‚¹ã®æ—¥ä»˜ãƒ»ç«¶é¦¬å ´ãƒ»URLã® id ã«åˆã‚ã›ã¦å¤‰æ›´ï¼‰  
   - **raceInfoExists: false** â†’ ãã®æ—¥ã® `race_info.json` ãŒç„¡ã„ã€ã¾ãŸã¯ `DATA_ROOT` ã®ãƒ‘ã‚¹ãŒé•ã†  
   - **kaisaiDataKeys: []** ã¾ãŸã¯ **kaisaiInfo: null** â†’ `kaisai_data` ãŒç„¡ã„ï¼ç©ºã€ã¾ãŸã¯ race_id ãŒä¸€è‡´ã—ã¦ã„ãªã„  
   - **rxId** ã¨ **sampleRxIdsInCsv** ã‚’æ¯”è¼ƒ â†’ çµ„ã¿ç«‹ã¦ãŸ RX_ID ãŒ CSV ã®å½¢å¼ã¨åˆã£ã¦ã„ã‚‹ã‹  
   - **babaFound: false** ã‹ã¤ **rxId** ã‚ã‚Š â†’ ãã® RX_ID ã®è¡ŒãŒ CSV ã«ç„¡ã„ã€ã¾ãŸã¯èŠ/ãƒ€ã®åˆ—ã®é•ã„

### ãƒ¬ãƒ¼ã‚¹ä¸€è¦§ãŒã€Œã“ã®æœˆã«ã¯ãƒ¬ãƒ¼ã‚¹ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€ã¨ãªã‚‹å ´åˆ

- **åˆ¤å®šã®ä»•æ§˜**: ãƒ¬ãƒ¼ã‚¹ä¸€è¦§ã¯æ¬¡ã®ã©ã¡ã‚‰ã‹ã§ã€Œãƒ‡ãƒ¼ã‚¿ã‚ã‚Šã€ã¨ã¿ãªã—ã¾ã™ã€‚
  1. **ç«¶é¦¬å ´ãƒ•ã‚©ãƒ«ãƒ€ï¼‹MDå‡ºèµ°è¡¨ï¼ˆ.mdï¼‰**: `races/å¹´/æœˆ/æ—¥/ä¸­å±±/` ãªã©ç«¶é¦¬å ´åãƒ•ã‚©ãƒ«ãƒ€ãŒã‚ã‚Šã€ãã®ä¸­ã« `*.md` ãŒã‚ã‚‹æ—¥
  2. **race_info.json ã®ã¿**: åŒæ—¥ä»˜ãƒ•ã‚©ãƒ«ãƒ€ã« `race_info.json`ï¼ˆ`kaisai_data` ã‚ã‚Šï¼‰ãŒã‚ã‚Œã°ã€MD ãŒç„¡ãã¦ã‚‚è¡¨ç¤ºå¯¾è±¡
- **DATA_ROOT**: ãƒ‡ãƒ¼ã‚¿ãŒ `E:\share\KEIBA-CICD\data2` ãªã©åˆ¥ãƒ‰ãƒ©ã‚¤ãƒ–ã«ã‚ã‚‹å ´åˆã¯ã€å¿…ãš `DATA_ROOT` ã‚’ãã®ãƒ‘ã‚¹ã«è¨­å®šã—ã¦ã‹ã‚‰èµ·å‹•ã—ã¦ãã ã•ã„ã€‚
- **ã‚­ãƒ£ãƒƒã‚·ãƒ¥**: æ—¥ä»˜ä¸€è¦§ã¯ `DATA_ROOT/cache/race_date_index.json` ã«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã•ã‚Œã¾ã™ã€‚å¤ã„ã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼ˆMD ã®ã¿ã§ä½œã‚‰ã‚ŒãŸã‚‚ã®ï¼‰ã¯èµ·å‹•æ™‚ã«ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãƒã‚§ãƒƒã‚¯ã§ç„¡åŠ¹åŒ–ã•ã‚Œã€è‡ªå‹•ã§å†ãƒ“ãƒ«ãƒ‰ã•ã‚Œã¾ã™ã€‚ã¾ã è¡¨ç¤ºã•ã‚Œãªã„å ´åˆã¯ã€è©²å½“ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‰Šé™¤ã—ã¦ã‹ã‚‰é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ã‚’å†èµ·å‹•ã—ã¦ãã ã•ã„ã€‚

### ãƒ¬ãƒ¼ã‚·ãƒ³ã‚°ãƒ“ãƒ¥ã‚¢ãƒ¼ï¼ˆmulti-viewï¼‰ãŒãƒªãƒ­ãƒ¼ãƒ‰ã—ç¶šã‘ã‚‹ãƒ»Turbopack FATAL ãŒå‡ºã‚‹å ´åˆï¼ˆç’°å¢ƒè¦å› ï¼‰

Next.js 16 ã§ã¯é–‹ç™ºæ™‚ï¼ˆ`npm run dev`ï¼‰ã« **Turbopack** ãŒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ä½¿ã‚ã‚Œã¾ã™ã€‚ç’°å¢ƒã«ã‚ˆã£ã¦ã¯æ¬¡ã®ã‚ˆã†ãªäº‹è±¡ãŒå‡ºã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚

- **Turbopack FATAL**: ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã« `FATAL: An unexpected Turbopack error occurred. A panic log has been written to...` ã¨å‡ºã‚‹
- **multi-view ãŒãƒªãƒ­ãƒ¼ãƒ‰ã—ç¶šã‘ã¦é–‹ã‘ãªã„**: åŒã˜ URL ãŒä½•åº¦ã‚‚ GET ã•ã‚Œã€ç”»é¢ãŒè½ã¡ç€ã‹ãªã„

**ä»¥å‰ã¯å•é¡Œãªã‹ã£ãŸãŒä»Šã¯å‡ºã‚‹**å ´åˆã¯ã€Node ã‚„ Next.js ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚¢ãƒƒãƒ—ã§ Turbopack ãŒæœ‰åŠ¹ã«ãªã£ãŸå½±éŸ¿ã®å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚

**å¯¾å‡¦ï¼ˆTurbopack ã‚’ã‚„ã‚ã¦ webpack ã§èµ·å‹•ã™ã‚‹ï¼‰:**

```powershell
cd .\keiba-cicd-core\KeibaCICD.WebViewer
npm run dev:webpack
```

`dev:webpack` ã¯ `next dev --webpack` ã§ã€Turbopack ã‚’ä½¿ã‚ãšå¾“æ¥ã® webpack ã§é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•ã—ã¾ã™ã€‚FATAL ã‚„ãƒªãƒ­ãƒ¼ãƒ‰ãƒ«ãƒ¼ãƒ—ãŒè§£æ¶ˆã™ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚

- **Node**: `engines` ã¯ `>=20.9.0` ã§ã™ã€‚åˆ¥ãƒãƒ¼ã‚¸ãƒ§ãƒ³ï¼ˆä¾‹: 18 ç³»ï¼‰ã«ã—ã¦ã„ã‚‹å ´åˆã¯ã€20 ç³»ä»¥ä¸Šã«åˆã‚ã›ã‚‹ã¨å®‰å®šã—ã‚„ã™ã„ã§ã™ã€‚
- **ã‚¦ã‚¤ãƒ«ã‚¹å¯¾ç­–ãƒ»OneDrive ç­‰**: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ•ã‚©ãƒ«ãƒ€ãŒãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åŒæœŸã‚„ã‚¹ã‚­ãƒ£ãƒ³å¯¾è±¡ã ã¨ã€ãƒ•ã‚¡ã‚¤ãƒ«ç›£è¦–ãŒé‡ããªã‚Š Turbopack ãŒä¸å®‰å®šã«ãªã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚é™¤å¤–ã‚„åˆ¥ãƒ‰ãƒ©ã‚¤ãƒ–ã§ã®å®Ÿè¡Œã‚’æ¤œè¨ã—ã¦ãã ã•ã„ã€‚

---

## 0.5 KeibaCICD.keibabook ã® Python ä¾å­˜ï¼ˆåˆå›ãƒ»ã‚¨ãƒ©ãƒ¼æ™‚ï¼‰

`fast_batch_cli` ã‚„ `jockey_cli` ç­‰ã‚’å®Ÿè¡Œã™ã‚‹å‰ã«ã€keibabook ã®ä¾å­˜ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ãã ã•ã„ã€‚

```powershell
cd .\keiba-cicd-core\KeibaCICD.keibabook\src
pip install -r requirements.txt
```

`ModuleNotFoundError: No module named 'requests'` ã‚„ `No module named 'dotenv'` ãŒå‡ºã‚‹å ´åˆã¯ã€ä¸Šè¨˜ã‚’å®Ÿè¡Œã—ã¦ã‹ã‚‰å†åº¦ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚

### ç®¡ç†ç”»é¢ã®ã€Œãƒ¬ãƒ¼ã‚¹å¾Œæ›´æ–°ã€ã§åŒã˜ã‚¨ãƒ©ãƒ¼ãŒå‡ºã‚‹å ´åˆï¼ˆæ¨å¥¨: .venv ã‚’1å›ã ã‘ä½œæˆï¼‰

ç®¡ç†ç”»é¢ï¼ˆ/adminï¼‰ã¯ã€**KeibaCICD.keibabook ã« `.venv` ãŒã‚ã‚‹ã¨ãã® Python ã‚’è‡ªå‹•ã§ä½¿ç”¨**ã—ã¾ã™ã€‚æ¬¡ã®æ‰‹é †ã‚’1å›ã ã‘å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚

```powershell
cd .\keiba-cicd-core\KeibaCICD.keibabook
python -m venv .venv
.\.venv\Scripts\Activate.ps1
pip install -r src\requirements.txt
```

ãã®å¾Œã€**WebViewer ã‚’å†èµ·å‹•**ï¼ˆ`npm run dev` ã‚’æ­¢ã‚ã¦å†åº¦å®Ÿè¡Œï¼‰ã™ã‚‹ã¨ã€ãƒ¬ãƒ¼ã‚¹å¾Œæ›´æ–°ã¯ `.venv` å†…ã® Python ã§å‹•ãã¾ã™ã€‚**PYTHON_PATH ã®è¨­å®šã¯ä¸è¦**ã§ã™ã€‚

- **PYTHON_PATH** ã‚’è¨­å®šã—ã¦ã„ã‚‹å ´åˆã¯ã€ãã® Python ãŒå„ªå…ˆã•ã‚Œã¾ã™ã€‚
- `.venv` ãŒãªã„å ´åˆã¯å¾“æ¥ã©ãŠã‚Š PATH ã® `python` ã‚’ä½¿ã†ãŸã‚ã€ãã® Python ã« `pip install -r src\requirements.txt` ãŒå¿…è¦ã§ã™ã€‚

---

## 0.6 é¦¬åè¾æ›¸ï¼ˆèª¿æ•™ã‚µãƒãƒªç”¨ï¼‰ã®åˆæœŸã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

èª¿æ•™ã‚µãƒãƒªç”Ÿæˆã§ã¯ã€å‡ºèµ°è¡¨ã®é¦¬åã‹ã‚‰ JRA-VAN è¡€çµ±ç•ªå·ï¼ˆ10æ¡ï¼‰ã‚’å¼•ããŸã‚ã«**é¦¬åè¾æ›¸ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹**ã‚’ä½¿ã„ã¾ã™ã€‚TARGET ã® UM_DATAï¼ˆ`UM{å¹´}{åŠæœŸ}.DAT`ï¼‰ã‚’èª­ã¿ã€é¦¬åâ†’è¡€çµ±ç•ªå·ã®è¾æ›¸ã‚’ KeibaCICD ç”¨ã« 1 å›ã ã‘ä½œæˆã—ã¦ãã ã•ã„ã€‚

- **å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«ä¾‹**: `E:\TFJV\UM_DATA\2021\UM20211.DAT`, `UM20212.DAT` ãªã©ã€‚10æ­³ã¾ã§å¯¾å¿œã™ã‚‹ãŸã‚ç›´è¿‘ç´„ 20 ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿ã¾ã™ã€‚
- **å‡ºåŠ›å…ˆ**: `keiba-cicd-core\KeibaCICD.TARGET\data\horse_name_index.json`ï¼ˆé¦¬åã¨è¡€çµ±ç•ªå·ã®ã¿ã€‚ç«¶é¦¬ãƒ–ãƒƒã‚¯é¦¬IDã¨ã®ãƒãƒƒãƒãƒ³ã‚°çµæœã‚’å°†æ¥å«ã‚ã‚‹ã“ã¨ã‚‚å¯èƒ½ï¼‰

**æ‰‹é †ï¼ˆ1å›ã ã‘ï¼‰:**

```powershell
$env:JV_DATA_ROOT_DIR = "E:\TFJV"   # TARGET ã® JV ãƒ‡ãƒ¼ã‚¿ãƒ«ãƒ¼ãƒˆ
cd .\keiba-cicd-core\KeibaCICD.TARGET
python scripts/horse_id_mapper.py --build-index
```

æ­£å¸¸ãªã‚‰ã€ŒBuilt index with XXXXX entriesã€ã®ã‚ˆã†ã«è¡¨ç¤ºã•ã‚Œã€`data\horse_name_index.json` ãŒä½œæˆã•ã‚Œã¾ã™ã€‚ãã®å¾Œã€ç®¡ç†ç”»é¢ã®ã€Œèª¿æ•™ã‚µãƒãƒªç”Ÿæˆã€ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€é¦¬åã‹ã‚‰è¡€çµ±ç•ªå·ã‚’å¼•ã„ã¦ CK_DATA ã¨çªãåˆã‚ã›ã¾ã™ã€‚

- UM_DATA ã« `UM{å¹´}{åŠæœŸ}.DAT` ãŒç„¡ã„å ´åˆã¯ã€TARGET ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã§é¦¬ãƒ‡ãƒ¼ã‚¿ï¼ˆUMï¼‰ã‚’å–å¾—ã—ã¦ãã ã•ã„ã€‚
- è¾æ›¸ã‚’ã‚„ã‚Šç›´ã™ã¨ãã¯ã€å†åº¦ `--build-index` ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚

### èª¿æ•™ã‚µãƒãƒªã®ã€Œå ´æ‰€ã€ï¼ˆå‚/ã‚³ï¼‰ãŒãšã‚Œã‚‹å ´åˆ

èª¿æ•™åˆ†æã®ã€Œå ´æ‰€ã€ã¯ CK_DATA ã®**ãƒ•ã‚¡ã‚¤ãƒ«åã®å…ˆé ­2æ–‡å­—ã®ã¿**ã§åˆ¤å®šã—ã¦ã„ã¾ã™ï¼ˆHC=å‚è·¯â†’å‚ã€WC/WD=ã‚³ãƒ¼ã‚¹â†’ã‚³ï¼‰ã€‚ãƒ¬ã‚³ãƒ¼ãƒ‰é•·ã§ã¯åˆ¤å®šã—ã¾ã›ã‚“ã€‚

- **ã™ã¹ã¦ã‚³ãƒ¼ã‚¹ã«ãªã‚‹å ´åˆ**  
  HC*.DAT ãŒåŒã˜ãƒ•ã‚©ãƒ«ãƒ€ã«ã‚ã‚ŠãªãŒã‚‰ã™ã¹ã¦ã‚³ãƒ¼ã‚¹ã¨å‡ºã‚‹å ´åˆã¯ã€ã‚¹ã‚¯ãƒªãƒ—ãƒˆå®Ÿè¡Œæ™‚ã® CK_DATA å‚ç…§å…ˆï¼ˆ`JV_DATA_ROOT_DIR`ï¼‰ãŒã€HC/WC ãŒå…¥ã£ã¦ã„ã‚‹ãƒ•ã‚©ãƒ«ãƒ€ã‚’æŒ‡ã—ã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„ã€‚ç®¡ç†ç”»é¢ã‹ã‚‰å®Ÿè¡Œã™ã‚‹å ´åˆã¯ã€WebViewer ã® `.env` / `.env.local` ã§ `JV_DATA_ROOT_DIR` ãŒè¨­å®šã•ã‚Œã€ãã®ä¸‹ã® `CK_DATA\å¹´\å¹´æœˆ\` ã« HC/WC ãŒã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚
- **ãƒ‡ãƒãƒƒã‚°**  
  ã©ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã‚“ã§ã©ã®å ´æ‰€ã‚’ä»˜ã‘ã¦ã„ã‚‹ã‹ç¢ºèªã™ã‚‹ã«ã¯ã€TARGET ã® scripts ã§æ¬¡ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ï¼ˆPowerShell ä¾‹ï¼‰ã€‚  
  `$env:JV_DATA_ROOT_DIR = "E:\TFJV"; $env:CK_DEBUG = "1"; python scripts/generate_training_summary.py --date 2026-01-25`  
  ãƒ­ã‚°ã« `[CK] HC020260121.DAT -> HC -> å‚è·¯` ã‚„ `[CK] WC020260121.DAT -> WC -> ã‚³ãƒ¼ã‚¹` ã®ã‚ˆã†ã«å‡ºã¾ã™ã€‚HC ãŒ 0 ä»¶ã®å ´åˆã¯ã€`JV_DATA_ROOT_DIR` ã®ãƒ‘ã‚¹ã‚„ CK_DATA ã®éšå±¤ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚

---

## 1. ç«¶é¦¬ãƒ–ãƒƒã‚¯WEBã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°

### 1.1 é¨æ‰‹æƒ…å ±ã‚’æ›´æ–°

```powershell
cd .\keiba-cicd-core\KeibaCICD.keibabook
python -m src.jockey_cli leading
python -m src.jockey_cli update --top 200
```

### 1.2 é–‹å‚¬æ—¥è¨­å®š

```powershell
cd .\keiba-cicd-core\KeibaCICD.keibabook
$from_date = "2026/01/18"
$to_date = "2026/01/18"
$date = "20260118"
```

### 1.3 åŸºæœ¬ãƒ‡ãƒ¼ã‚¿å–å¾—

```powershell
# ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«å–å¾—
python -m src.fast_batch_cli schedule --start $from_date --end $to_date

# åŸºæœ¬ãƒ‡ãƒ¼ã‚¿å–å¾—ï¼ˆå‡ºé¦¬è¡¨ã€èª¿æ•™ã€è«‡è©±ã€å‹å› ï¼‰
python -m src.fast_batch_cli full --start $from_date --end $from_date --data-types shutsuba,cyokyo,danwa,syoin

# ãƒ‘ãƒ‰ãƒƒã‚¯ã€æˆç¸¾ãƒ‡ãƒ¼ã‚¿å–å¾—
python -m src.fast_batch_cli full --start $from_date --end $from_date --data-types paddok,seiseki

# ãƒ‡ãƒ¼ã‚¿çµ±åˆãƒ»MDç”Ÿæˆ
python -m src.integrator_cli batch --date $from_date
python -m src.markdown_cli batch --date $from_date --organized

# é¦¬ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”Ÿæˆ
python -m src.horse_profile_cli --date $from_date --all --with-history --with-seiseki-table
```

### 1.4 èª¿æ•™ãƒ‡ãƒ¼ã‚¿é›†è¨ˆï¼ˆTARGETé€£æºï¼‰

```powershell
# ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å ´æ‰€: keiba-cicd-core\KeibaCICD.TARGET\scripts\training_summary.py
# ãƒ‡ãƒ¼ã‚¿ã®å ´æ‰€: Z:\KEIBA-CICD\èª¿æ•™ãƒ‡ãƒ¼ã‚¿\

cd Y:\TXT
cd Z:\KEIBA-CICD\èª¿æ•™ãƒ‡ãƒ¼ã‚¿
$script = "C:\source\git-h.fukuda1207\_keiba\keiba-cicd-core\KeibaCICD.TARGET\scripts\training_summary.py"
$date = "20260124"

# é¦¬åãƒ»èª¿æ•™ã‚¿ã‚¤ãƒ ã‚’ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ï¼ˆTARGETã«è²¼ã‚Šä»˜ã‘ç”¨ï¼‰
python $script --sakamichi chokyo_å‚è·¯.csv --course chokyo_ã‚³ãƒ¼ã‚¹.csv --date $date --output output.txt --clip-time

# é¦¬åãƒ»èª¿æ•™ãƒ©ãƒƒãƒ—ã‚’ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ï¼ˆTARGETã«è²¼ã‚Šä»˜ã‘ç”¨ï¼‰
python $script --sakamichi chokyo_å‚è·¯.csv --course chokyo_ã‚³ãƒ¼ã‚¹.csv --date $date --output output.txt --clip-lap

# é¦¬åãƒ»èª¿æ•™è©³ç´°ã‚’ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼
python $script --sakamichi chokyo_å‚è·¯.csv --course chokyo_ã‚³ãƒ¼ã‚¹.csv --date $date --output output.txt --clip-detail
```

### 1.5 èª¿æ•™ã‚³ãƒ¡ãƒ³ãƒˆãƒ»æœ¬èªŒå°å‡ºåŠ›ï¼ˆç«¶é¦¬ãƒ–ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ï¼‰

```powershell
cd .\keiba-cicd-core\KeibaCICD.keibabook\scripts

# èª¿æ•™ã‚³ãƒ¡ãƒ³ãƒˆã‚’ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼
python clip_training_comment.py --date $date

# æœ¬èªŒå°ã‚’ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼
python clip_honshi_mark.py --date $date
```

**å‡ºåŠ›å½¢å¼**:
- èª¿æ•™ã‚³ãƒ¡ãƒ³ãƒˆ: `é¦¬å<TAB>èª¿æ•™ã‚³ãƒ¡ãƒ³ãƒˆ`
- æœ¬èªŒå°: `é¦¬å<TAB>æœ¬èªŒå°`

---

## 2. èª¿æ•™ãƒ‡ãƒ¼ã‚¿é›†è¨ˆï¼ˆTARGETç”¨ï¼‰è©³ç´°

> **ã‚¹ã‚¯ãƒªãƒ—ãƒˆé…ç½®å ´æ‰€**: `keiba-cicd-core\KeibaCICD.TARGET\scripts\training_summary.py`
> **ä»•æ§˜æ›¸**: `keiba-cicd-core\KeibaCICD.TARGET\docs\èª¿æ•™ãƒ‡ãƒ¼ã‚¿ä½œæˆã‚¹ã‚¯ãƒªãƒ—ãƒˆé–‹ç™º.md`
> **ä½¿ã„æ–¹ã‚¬ã‚¤ãƒ‰**: `keiba-cicd-core\KeibaCICD.TARGET\docs\training_summary_ä½¿ã„æ–¹.md`

### 2.1 åŸºæœ¬çš„ãªä½¿ã„æ–¹

```powershell
cd Z:\KEIBA-CICD\èª¿æ•™ãƒ‡ãƒ¼ã‚¿
$script = "C:\source\git-h.fukuda1207\_keiba\keiba-cicd-core\KeibaCICD.TARGET\scripts\training_summary.py"
```

### 2.2 ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«å‡ºåŠ›

```powershell
python $script --sakamichi chokyo_260104_å‚è·¯.csv --course chokyo_260104_ã‚³ãƒ¼ã‚¹.csv --date 20260111 --output chokyo_260104.txt
```

### 2.3 Excelå‡ºåŠ›

```powershell
python $script --sakamichi chokyo_260104_å‚è·¯.csv --course chokyo_260104_ã‚³ãƒ¼ã‚¹.csv --date 20260111 --output chokyo_260104.xlsx --excel
```

### 2.4 ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰å‡ºåŠ›

```powershell
# é¦¬åãƒ»èª¿æ•™ãƒ©ãƒƒãƒ—ã‚’ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ï¼ˆTARGETã«è²¼ã‚Šä»˜ã‘ç”¨ï¼‰
python $script --sakamichi chokyo_å‚è·¯.csv --course chokyo_ã‚³ãƒ¼ã‚¹.csv --date 20260111 --output output.txt --clip-lap

# é¦¬åãƒ»èª¿æ•™ã‚¿ã‚¤ãƒ ã‚’ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ï¼ˆTARGETã«è²¼ã‚Šä»˜ã‘ç”¨ï¼‰
python $script --sakamichi chokyo_å‚è·¯.csv --course chokyo_ã‚³ãƒ¼ã‚¹.csv --date 20260111 --output output.txt --clip-time

# é¦¬åãƒ»èª¿æ•™è©³ç´°ã‚’ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ï¼ˆTARGETã«è²¼ã‚Šä»˜ã‘ç”¨ï¼‰
python $script --sakamichi chokyo_å‚è·¯.csv --course chokyo_ã‚³ãƒ¼ã‚¹.csv --date 20260111 --output output.txt --clip-detail
```

### 2.5 ã‚ªãƒ—ã‚·ãƒ§ãƒ³ä¸€è¦§

| ã‚ªãƒ—ã‚·ãƒ§ãƒ³ | èª¬æ˜ |
|:---|:---|
| `-s`, `--sakamichi` | å‚è·¯CSVãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹ |
| `-c`, `--course` | ã‚³ãƒ¼ã‚¹èª¿æ•™CSVãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹ |
| `-d`, `--date` | åŸºæº–æ—¥ï¼ˆYYYYMMDDå½¢å¼ï¼‰**å¿…é ˆ** |
| `-o`, `--output` | å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹ **å¿…é ˆ** |
| `--clip-lap` | é¦¬åãƒ»èª¿æ•™ãƒ©ãƒƒãƒ—ã‚’ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ |
| `--clip-time` | é¦¬åãƒ»èª¿æ•™ã‚¿ã‚¤ãƒ ã‚’ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ |
| `--clip-detail` | é¦¬åãƒ»èª¿æ•™è©³ç´°ã‚’ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ |
| `--excel` | Excelãƒ•ã‚¡ã‚¤ãƒ«(.xlsx)ã§å‡ºåŠ› |

### 2.6 èª¿æ•™ãƒ©ãƒƒãƒ—åˆ†é¡ãƒ«ãƒ¼ãƒ«

| åˆ†é¡ | æ¡ä»¶ | èª¬æ˜ |
|:---:|:---|:---|
| **SS** | å¥½ã‚¿ã‚¤ãƒ  + Såˆ†é¡ + åŠ é€ŸoråŒã‚¿ã‚¤ãƒ  | æœ€é«˜ï¼ˆå¥½ã‚¿ã‚¤ãƒ  + å¥½ãƒ©ãƒƒãƒ—ï¼‰ |
| **S** | Lap2ãƒ»Lap1ãŒ11ç§’å°ä»¥ä¸‹ | å¥½ãƒ©ãƒƒãƒ—ï¼ˆ2Fé€£ç¶š11ç§’å°ä»¥ä¸‹ï¼‰ |
| **A** | Lap1ãŒ11ç§’å°ä»¥ä¸‹ã€Lap2ãŒ12ç§’å°ä»¥ä¸Š | å¥½ï¼ˆåŠ é€Ÿã—ã¦çµ‚ã„11ç§’å°ä»¥ä¸‹ï¼‰ |
| **B** | Lap2ãƒ»Lap1ãŒ12ç§’å° | è‰¯ï¼ˆ2Fé€£ç¶š12ç§’å°ï¼‰ |
| **C** | Lap1ãŒ12ç§’å° | æ™®é€šï¼ˆçµ‚ã„12ç§’å°ï¼‰ |
| **D** | Lap1ãŒ13ç§’å°ä»¥ä¸Š | è»½ã‚ |

è¨˜å·: `+` = åŠ é€Ÿ, `-` = æ¸›é€Ÿ, `=` = åŒã‚¿ã‚¤ãƒ 

### 2.7 èª¿æ•™ã‚¿ã‚¤ãƒ åˆ†é¡

| è¨˜å· | æ„å‘³ |
|:---:|:---|
| **å‚** | å‚è·¯ã§å¥½ã‚¿ã‚¤ãƒ  |
| **ã‚³** | ã‚³ãƒ¼ã‚¹ã§å¥½ã‚¿ã‚¤ãƒ  |
| **ä¸¡** | å‚è·¯+ã‚³ãƒ¼ã‚¹ä¸¡æ–¹ã§å¥½ã‚¿ã‚¤ãƒ  |
| (ãƒ–ãƒ©ãƒ³ã‚¯) | å¥½ã‚¿ã‚¤ãƒ ãªã— |

**å¥½ã‚¿ã‚¤ãƒ åŸºæº–ï¼ˆ4Fï¼‰:**
- ç¾æµ¦å‚è·¯: 52.9ç§’ä»¥ä¸‹
- æ —æ±å‚è·¯: 53.9ç§’ä»¥ä¸‹
- ç¾æµ¦/æ —æ±ã‚³ãƒ¼ã‚¹: 52.2ç§’ä»¥ä¸‹

---

## 3. èª¿æ•™ãƒ‡ãƒ¼ã‚¿ç›´æ¥å–å¾—ï¼ˆTARGETãƒ‡ãƒ¼ã‚¿å‚ç…§ï¼‰[NEW]

> **CSVã‚’æ¯å›å‡ºåŠ›ã—ãªãã¦ã‚‚ã€TARGETã®ãƒ‡ãƒ¼ã‚¿ã‚’ç›´æ¥å‚ç…§ã—ã¦èª¿æ•™ã‚µãƒãƒªãƒ¼ã‚’ç”Ÿæˆã§ãã¾ã™ã€‚**

### 3.1 èª¿æ•™ã‚µãƒãƒªãƒ¼API

KeibaCICD.WebViewerãŒèµ·å‹•ã—ã¦ã„ã‚‹çŠ¶æ…‹ã§ã€ãƒ–ãƒ©ã‚¦ã‚¶ã¾ãŸã¯curlã§ã‚¢ã‚¯ã‚»ã‚¹ï¼š

```
http://localhost:3000/api/training/summary?date=YYYYMMDD
```

**ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿:**
- `date`: ãƒ¬ãƒ¼ã‚¹é–‹å‚¬æ—¥ï¼ˆåŸºæº–æ—¥ï¼‰YYYYMMDDå½¢å¼
- `format`: `json`ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰ã¾ãŸã¯ `tsv`ï¼ˆTARGETå–ã‚Šè¾¼ã¿ç”¨ï¼‰

**ä¾‹:**
```powershell
# JSONå½¢å¼ã§å–å¾—
Invoke-WebRequest -Uri "http://localhost:3000/api/training/summary?date=20260125" -UseBasicParsing

# TSVå½¢å¼ã§ãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜
Invoke-WebRequest -Uri "http://localhost:3000/api/training/summary?date=20260125&format=tsv" -OutFile "training_20260125.txt"
```

### 3.2 ãƒ‡ãƒãƒƒã‚°APIï¼ˆèª¿æ•™ãƒ‡ãƒ¼ã‚¿ç¢ºèªï¼‰

ç‰¹å®šæ—¥ã®èª¿æ•™ãƒ‡ãƒ¼ã‚¿ã‚’ç›´æ¥ç¢ºèªï¼š

```
http://localhost:3000/api/debug/training?date=YYYYMMDD
```

**ä¾‹:**
```powershell
Invoke-WebRequest -Uri "http://localhost:3000/api/debug/training?date=20260123" -UseBasicParsing
```

### 3.3 ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹

TARGETã®èª¿æ•™ãƒ‡ãƒ¼ã‚¿ã‚’ç›´æ¥å‚ç…§ï¼š
- **ãƒ‘ã‚¹**: `Y:\CK_DATA\YYYY\YYYYMM\`
- **å‚è·¯èª¿æ•™**: `WC{0|1}YYYYMMDD.DAT` (0=ç¾æµ¦, 1=æ —æ±)
- **ã‚³ãƒ¼ã‚¹èª¿æ•™**: `HC{0|1}YYYYMMDD.DAT`

**ä»•æ§˜æ›¸**: `KeibaCICD.TARGET\docs\CK_DATA_èª¿æ•™ãƒ‡ãƒ¼ã‚¿ä»•æ§˜.md`

### 3.4 ãƒ‡ãƒ¼ã‚¿ä¿å­˜ã¨å‡ºèµ°è¡¨è¡¨ç¤º

ç®¡ç†ç”»é¢ã§ã€Œãƒ‡ãƒ¼ã‚¿ä¿å­˜ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã€ä»¥ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒç”Ÿæˆã•ã‚Œã¾ã™ï¼š

```
Z:\KEIBA-CICD\data2\races\{year}\{month}\{day}\temp\training_summary.json
```

ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã™ã‚‹ã¨ã€å‡ºèµ°è¡¨ã«ã€Œï¾€ï½²ï¾‘ã€ã€Œï¾—ï½¯ï¾Œï¾Ÿã€åˆ—ãŒè‡ªå‹•è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

**ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼:**
1. ç®¡ç†ç”»é¢ï¼ˆ/adminï¼‰ã§ãƒ¬ãƒ¼ã‚¹é–‹å‚¬æ—¥ã‚’é¸æŠ
2. ã€Œã‚µãƒãƒªãƒ¼ç”Ÿæˆã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
3. çµæœã‚’ç¢ºèªã—ã¦ã€Œãƒ‡ãƒ¼ã‚¿ä¿å­˜ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
4. å‡ºèµ°è¡¨ãƒšãƒ¼ã‚¸ï¼ˆ/races-v2/...ï¼‰ã§è‡ªå‹•çš„ã«ã‚¿ã‚¤ãƒ ãƒ»ãƒ©ãƒƒãƒ—ãŒè¡¨ç¤º

### 3.5 å¾“æ¥æ–¹å¼ã¨ã®æ¯”è¼ƒ

| é …ç›® | å¾“æ¥æ–¹å¼ï¼ˆCSVï¼‰ | æ–°æ–¹å¼ï¼ˆAPIï¼‰ |
|:---|:---|:---|
| äº‹å‰æº–å‚™ | TARGETã‹ã‚‰CSVå‡ºåŠ›ãŒå¿…è¦ | ä¸è¦ï¼ˆè‡ªå‹•å–å¾—ï¼‰ |
| ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ | CSVãƒ•ã‚¡ã‚¤ãƒ« | TARGET CK_DATAã‚’ç›´æ¥å‚ç…§ |
| é¦¬åå–å¾— | CSVã«å«ã¾ã‚Œã‚‹ | SE_DATAã‹ã‚‰è‡ªå‹•å–å¾— |
| å®Ÿè¡Œæ–¹æ³• | Pythonã‚¹ã‚¯ãƒªãƒ—ãƒˆ | WebViewer API |
| å‡ºåŠ›å½¢å¼ | TXT/Excel | JSON/TSV |
| å‡ºèµ°è¡¨é€£æº | æ‰‹å‹• | è‡ªå‹•ï¼ˆä¿å­˜å¾Œè‡ªå‹•è¡¨ç¤ºï¼‰ |

---

## 4. ãƒ¬ãƒ¼ã‚¹ç‰¹æ€§åŸºæº–å€¤ç®—å‡ºï¼ˆRPCIåˆ†æï¼‰

> **JRA-VANãƒ‡ãƒ¼ã‚¿ã‹ã‚‰ç¬ç™ºæˆ¦/æŒç¶šæˆ¦ã®åŸºæº–å€¤ã‚’çµ±è¨ˆçš„ã«ç®—å‡ºã§ãã¾ã™ã€‚**
> **ç«¶é¦¬å ´Ã—èŠ/ãƒ€ãƒ¼ãƒˆÃ—è·é›¢åˆ¥ã«83ã‚³ãƒ¼ã‚¹ã®åŸºæº–å€¤ã‚’ç®—å‡ºã€‚é¡ä¼¼ã‚³ãƒ¼ã‚¹ã®ç™ºè¦‹ã‚‚å¯èƒ½ã€‚**

### 4.1 æ¦‚è¦

RPCIï¼ˆRace Pace Change Indexï¼‰ã‚’ä½¿ã£ã¦ã€å„ã‚³ãƒ¼ã‚¹ã®ãƒ¬ãƒ¼ã‚¹å‚¾å‘ã‚’åˆ†æï¼š

- **RPCI = (å‰3Fã‚¿ã‚¤ãƒ  / å¾Œ3Fã‚¿ã‚¤ãƒ ) Ã— 50**
- **RPCI > 50**: ã‚¹ãƒ­ãƒ¼ãƒšãƒ¼ã‚¹ï¼ˆå‰åŠé…ã„ï¼‰â†’ ç¬ç™ºæˆ¦å‚¾å‘
- **RPCI < 50**: ãƒã‚¤ãƒšãƒ¼ã‚¹ï¼ˆå‰åŠé€Ÿã„ï¼‰â†’ æŒç¶šæˆ¦å‚¾å‘

### 4.2 ç®¡ç†ç”»é¢ã‹ã‚‰ã®å®Ÿè¡Œ

1. ç®¡ç†ç”»é¢ï¼ˆhttp://localhost:3000/adminï¼‰ã‚’é–‹ã
2. ã€ŒğŸ“Š ãƒ‡ãƒ¼ã‚¿åˆ†æã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’å±•é–‹
3. ã€Œãƒ¬ãƒ¼ã‚¹ç‰¹æ€§åŸºæº–å€¤ç®—å‡ºã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
4. çµæœã¯ `KeibaCICD.TARGET/data/race_type_standards.json` ã«å‡ºåŠ›

### 4.3 ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã‹ã‚‰ã®å®Ÿè¡Œ

```powershell
cd .\keiba-cicd-core\KeibaCICD.TARGET
$env:JV_DATA_ROOT_DIR = "E:\TFJV"
python scripts/calculate_race_type_standards_jv.py --years 2024,2025 --output data/race_type_standards.json
```

**ã‚ªãƒ—ã‚·ãƒ§ãƒ³:**

| ã‚ªãƒ—ã‚·ãƒ§ãƒ³ | èª¬æ˜ | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ |
|:---|:---|:---|
| `--years` | å¯¾è±¡å¹´ï¼ˆã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šï¼‰ | 2024,2025 |
| `--output` | å‡ºåŠ›ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ | data/race_type_standards.json |

### 4.4 èŠ/ãƒ€ãƒ¼ãƒˆÃ—è·é›¢åˆ¥åŸºæº–å€¤ï¼ˆ2024-2025å¹´ãƒ‡ãƒ¼ã‚¿ï¼‰

| ã‚«ãƒ†ã‚´ãƒª | ä»¶æ•° | RPCIå¹³å‡ | å‚¾å‘ | ç¬ç™ºæˆ¦é–¾å€¤ | æŒç¶šæˆ¦é–¾å€¤ |
|:---|:---:|:---:|:---|:---:|:---:|
| **Dirt 1200mä»¥ä¸‹** | 836 | 46.45 | ãƒã‚¤ | >47.4 | <45.5 |
| Dirt 1400-1600m | 807 | 47.25 | ãƒã‚¤ | >48.2 | <46.3 |
| Dirt 1800-2200m | 1,382 | 46.35 | ãƒã‚¤ | >48.3 | <44.4 |
| Dirt 2400mä»¥ä¸Š | 41 | 48.69 | å¹³å‡ | >50.7 | <46.6 |
| Turf 1200mä»¥ä¸‹ | 643 | 48.71 | å¹³å‡ | >49.4 | <48.0 |
| Turf 1400-1600m | 961 | 50.46 | ã‚¹ãƒ­ãƒ¼ | >51.7 | <49.3 |
| **Turf 1800-2200m** | 1,464 | **51.31** | ã‚¹ãƒ­ãƒ¼ | >52.5 | <50.1 |
| Turf 2400mä»¥ä¸Š | 240 | 51.19 | ã‚¹ãƒ­ãƒ¼ | >52.6 | <49.8 |

### 4.5 é¡ä¼¼ã‚³ãƒ¼ã‚¹åˆ†æ

åŒã˜RPCIå‚¾å‘ã‚’æŒã¤ã‚³ãƒ¼ã‚¹ã‚’è‡ªå‹•æ¤œå‡ºï¼ˆRPCIå·®â‰¤0.8ã§é¡ä¼¼ã¨åˆ¤å®šï¼‰

**ãƒ€ãƒ¼ãƒˆé¡ä¼¼ã‚³ãƒ¼ã‚¹ï¼ˆä¾‹ï¼‰:**
| ã‚³ãƒ¼ã‚¹A | RPCI | ã‚³ãƒ¼ã‚¹B | RPCI | å·® |
|:---|:---:|:---|:---:|:---:|
| ç¦å³¶ãƒ€1700m | 39.83 | å°å€‰ãƒ€1700m | 40.20 | 0.37 |
| å‡½é¤¨ãƒ€1700m | 40.19 | å°å€‰ãƒ€1700m | 40.20 | 0.01 |
| ä¸­äº¬ãƒ€1800m | 49.18 | é˜ªç¥ãƒ€1800m | 49.10 | 0.08 |
| ä¸­å±±ãƒ€1800m | 48.07 | æ–°æ½Ÿãƒ€1800m | 47.95 | 0.12 |

**èŠé¡ä¼¼ã‚³ãƒ¼ã‚¹ï¼ˆä¾‹ï¼‰:**
| ã‚³ãƒ¼ã‚¹A | RPCI | ã‚³ãƒ¼ã‚¹B | RPCI | å·® |
|:---|:---:|:---|:---:|:---:|
| é˜ªç¥èŠ1600m | 51.52 | æ±äº¬èŠ1600m | 51.52 | 0.00 |
| é˜ªç¥èŠ2000m | 51.83 | äº¬éƒ½èŠ2000m | 51.85 | 0.02 |
| å°å€‰èŠ1800m | 50.21 | ä¸­å±±èŠ1600m | 50.19 | 0.02 |

### 4.6 ã‚³ãƒ¼ã‚¹æ¯”è¼ƒä¾‹

| ã‚³ãƒ¼ã‚¹A | RPCI | ã‚³ãƒ¼ã‚¹B | RPCI | å·® | å‚™è€ƒ |
|:---|:---:|:---|:---:|:---:|:---|
| ä¸­å±±èŠ1600m | 50.19 | æ±äº¬èŠ1600m | 51.52 | +1.33 | æ±äº¬ãŒã‚¹ãƒ­ãƒ¼å‚¾å‘ |
| ä¸­å±±èŠ2000m | 51.04 | æ±äº¬èŠ2000m | 53.44 | +2.40 | æ˜ç¢ºã«ç•°ãªã‚‹ |
| é˜ªç¥èŠ1600m | 51.52 | äº¬éƒ½èŠ1600m | 50.07 | -1.45 | é˜ªç¥ãŒã‚¹ãƒ­ãƒ¼å‚¾å‘ |

### 4.7 å‡ºåŠ›ãƒ‡ãƒ¼ã‚¿æ§‹é€ 

```json
{
  "metadata": { ... },
  "by_distance_group": {
    "Turf_1800-2200m": {
      "sample_count": 1464,
      "rpci": { "mean": 51.31, "stdev": 2.43 },
      "thresholds": { "instantaneous": 52.52, "sustained": 50.09 }
    }
  },
  "courses": {
    "Tokyo_Turf_2000m": {
      "sample_count": 206,
      "rpci": { "mean": 53.44, "stdev": 2.09 },
      "thresholds": { "instantaneous": 54.48, "sustained": 52.39 }
    }
  },
  "similar_courses": {
    "Fukushima_Dirt_1700m": ["Kokura_Dirt_1700m", "Hakodate_Dirt_1700m"]
  }
}
```

### 4.8 ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹

- **å…¥åŠ›**: JRA-VAN SR_DATAï¼ˆãƒ¬ãƒ¼ã‚¹æ¯æˆç¸¾ï¼‰
- **ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰**: HaronTimeS3ï¼ˆå‰3Fï¼‰, HaronTimeL3ï¼ˆå¾Œ3Fï¼‰, Kyoriï¼ˆè·é›¢ï¼‰, TrackCDï¼ˆèŠ/ãƒ€ãƒ¼ãƒˆï¼‰
- **ãƒ‘ã‚¹**: `$env:JV_DATA_ROOT_DIR/SE_DATA/{å¹´}/SR*.DAT`
- **ã‚³ãƒ¼ã‚¹æ•°**: 83ã‚³ãƒ¼ã‚¹ï¼ˆ2024-2025å¹´ãƒ‡ãƒ¼ã‚¿ï¼‰

---

## 5. ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### 5.1 èª¿æ•™å¸«ã‚³ãƒ¡ãƒ³ãƒˆãŒè¡¨ç¤ºã•ã‚Œãªã„å•é¡Œ

#### å•é¡Œã®çŠ¶æ³

èª¿æ•™åˆ†æãƒ†ãƒ¼ãƒ–ãƒ«ã§èª¿æ•™å¸«ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¤ã‚³ãƒ³ï¼ˆğŸ’¬ï¼‰ãŒè¡¨ç¤ºã•ã‚Œãªã„ã€‚

**ç¢ºèªæ—¥**: 2026-01-30  
**å¯¾è±¡ãƒ¬ãƒ¼ã‚¹**: `202601000910`ï¼ˆäº¬éƒ½10Rï¼‰  
**å¯¾è±¡èª¿æ•™å¸«**: æ–è—¤èª ï¼ˆ`trainer_id: ï½»112`ï¼‰

#### ç¾çŠ¶ã®ç¢ºèªçµæœ

1. **`trainer_id_index.json`ã®çŠ¶æ…‹**
   - ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹: `E:\share\KEIBA-CICD\data2\target\trainer_id_index.json`
   - `ï½»112`ã®ã‚¨ãƒ³ãƒˆãƒªã¯å­˜åœ¨ã—ã€`comment`ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚‚æ­£ã—ãè¨­å®šã•ã‚Œã¦ã„ã‚‹
   ```json
   {
     "ï½»112": {
       "keibabook_id": "ï½»112",
       "jvn_code": "01086",
       "name": "æ–è—¤èª ",
       "tozai": "ç¾æµ¦",
       "comment": "ç‰¹å¾´: å‚è·¯è¿½ã„åˆ‡ã‚Šã§äººæ°—è–„ã§ã‚‚å¥½èµ°ãŒå¤šã„..."
     }
   }
   ```

2. **çµ±åˆãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ`integrated_202601000910.json`ï¼‰ã®çŠ¶æ…‹**
   - ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹: `E:\share\KEIBA-CICD\data2\races\2026\01\25\temp\integrated_202601000910.json`
   - `trainer_id`ã¯æ­£ã—ãè¨­å®šã•ã‚Œã¦ã„ã‚‹: `"trainer_id": "ï½»112"`
   - ã—ã‹ã—ã€`trainer_comment`ã¯ç©ºæ–‡å­—åˆ—: `"trainer_comment": ""`
   - `trainer_tozai`ã‚‚`null`ã®ã¾ã¾: `"trainer_tozai": null`

3. **çµ±åˆå‡¦ç†ã‚³ãƒ¼ãƒ‰ã®çŠ¶æ…‹**
   - ãƒ•ã‚¡ã‚¤ãƒ«: `KeibaCICD.keibabook/src/integrator/race_data_integrator.py`ï¼ˆ343-361è¡Œç›®ï¼‰
   - `get_trainer_info`ã‚’å‘¼ã³å‡ºã—ã¦ã‚³ãƒ¡ãƒ³ãƒˆã‚’è¨­å®šã™ã‚‹å‡¦ç†ã¯å®Ÿè£…æ¸ˆã¿
   - ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°ã‚‚è¿½åŠ æ¸ˆã¿

#### åŸå› ã®æ¨æ¸¬

1. **çµ±åˆãƒ‡ãƒ¼ã‚¿ãŒå¤ã„å¯èƒ½æ€§**
   - `integrated_202601000910.json`ã®ä½œæˆæ—¥æ™‚: `2026-01-30T20:04:57`
   - `trainer_id_index.json`ãŒæ›´æ–°ã•ã‚Œã‚‹å‰ã«çµ±åˆãƒ‡ãƒ¼ã‚¿ãŒä½œæˆã•ã‚ŒãŸå¯èƒ½æ€§ãŒã‚ã‚‹

2. **çµ±åˆå‡¦ç†æ™‚ã®ã‚¨ãƒ©ãƒ¼**
   - `get_trainer_info`ã®å‘¼ã³å‡ºã—ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¦ã„ã‚‹å¯èƒ½æ€§
   - ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã§å‡¦ç†ãŒç¶šè¡Œã•ã‚Œã¦ã„ã‚‹ãŸã‚ã€ã‚¨ãƒ©ãƒ¼ãŒãƒ­ã‚°ã«è¨˜éŒ²ã•ã‚Œã¦ã„ãªã„å¯èƒ½æ€§

3. **ã‚¤ãƒ³ãƒãƒ¼ãƒˆã®å•é¡Œ**
   - `get_trainer_info`ãŒæ­£ã—ãã‚¤ãƒ³ãƒãƒ¼ãƒˆã§ãã¦ã„ãªã„å¯èƒ½æ€§
   - ãƒ‘ã‚¹ã®å•é¡Œã§`common.jravan`ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒè¦‹ã¤ã‹ã‚‰ãªã„å¯èƒ½æ€§

#### è§£æ±ºæ–¹æ³•

1. **çµ±åˆãƒ‡ãƒ¼ã‚¿ã®å†ç”Ÿæˆï¼ˆæ¨å¥¨ï¼‰**
   
   **æ–¹æ³•1: ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã‹ã‚‰å®Ÿè¡Œ**
   ```powershell
   cd e:\share\KEIBA-CICD\_keiba\keiba-cicd-core\KeibaCICD.keibabook
   python -c "from src.integrator.race_data_integrator import RaceDataIntegrator; integrator = RaceDataIntegrator(); integrator.create_integrated_file('202601000910')"
   ```
   
   **æ–¹æ³•2: ãƒãƒƒãƒå‡¦ç†ã§å†ç”Ÿæˆ**
   ```powershell
   cd e:\share\KEIBA-CICD\_keiba\keiba-cicd-core\KeibaCICD.keibabook
   python -m src.integrator_cli batch --date 20260125
   ```
   
   **æ–¹æ³•3: ç®¡ç†ç”»é¢ã‹ã‚‰å†ç”Ÿæˆ**
   - ç®¡ç†ç”»é¢ã®ã€Œãƒ‡ãƒ¼ã‚¿ç™»éŒ²ã€ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰çµ±åˆãƒ‡ãƒ¼ã‚¿ã‚’å†ç”Ÿæˆ

2. **ãƒ­ã‚°ã®ç¢ºèª**
   - çµ±åˆå‡¦ç†å®Ÿè¡Œæ™‚ã«ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°ã‚’ç¢ºèª
   - `èª¿æ•™å¸«ã‚³ãƒ¡ãƒ³ãƒˆè¨­å®š:` ã¾ãŸã¯ `èª¿æ•™å¸«æƒ…å ±ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“:` ã®ãƒ­ã‚°ã‚’ç¢ºèª
   - ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«ã‚’`DEBUG`ã«è¨­å®šã™ã‚‹ã¨è©³ç´°ãªãƒ­ã‚°ãŒå‡ºåŠ›ã•ã‚Œã¾ã™

3. **æ‰‹å‹•ã§ã®ç¢ºèª**
   - Pythonã§ç›´æ¥`get_trainer_info`ã‚’å‘¼ã³å‡ºã—ã¦ç¢ºèª
   ```python
   import sys
   sys.path.insert(0, 'e:\\share\\KEIBA-CICD\\_keiba\\keiba-cicd-core\\KeibaCICD.TARGET')
   from common.jravan import get_trainer_info
   result = get_trainer_info('ï¾…032')
   print(result)
   # æœŸå¾…ã•ã‚Œã‚‹çµæœ: {'keibabook_id': 'ï¾…032', 'jvn_code': '01137', 'name': 'ä¸­å†…ç”°å……', 'tozai': 'æ —æ±', 'comment': '...'}
   ```

4. **çµ±åˆãƒ‡ãƒ¼ã‚¿ã®ç¢ºèª**
   - å†ç”Ÿæˆå¾Œã€çµ±åˆãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ã„ã¦`trainer_comment`ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
   ```python
   import json
   with open('E:/share/KEIBA-CICD/data2/races/2026/01/25/temp/integrated_202601000910.json', 'r', encoding='utf-8') as f:
       data = json.load(f)
   for entry in data.get('entries', []):
       trainer_id = entry.get('entry_data', {}).get('trainer_id')
       trainer_comment = entry.get('entry_data', {}).get('trainer_comment')
       if trainer_id == 'ï¾…032':
           print(f"trainer_id: {trainer_id}, trainer_comment: {trainer_comment}")
   ```

#### å®Ÿè£…æ¸ˆã¿ã®ä¿®æ­£

1. **çµ±åˆå‡¦ç†ã‚³ãƒ¼ãƒ‰ã®æ”¹å–„**ï¼ˆ`race_data_integrator.py`ï¼‰
   - `trainer_info.get('comment')`ã‚’ä½¿ç”¨ã™ã‚‹ã‚ˆã†ã«å¤‰æ›´ï¼ˆ352è¡Œç›®ï¼‰
   - ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°ã‚’è¿½åŠ ï¼ˆ354è¡Œç›®ã€356è¡Œç›®ã€361è¡Œç›®ï¼‰

2. **UIå®Ÿè£…**ï¼ˆ`TrainingAnalysisSection.tsx`ï¼‰
   - èª¿æ•™å¸«ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¤ã‚³ãƒ³ï¼ˆğŸ’¬ï¼‰ã®è¡¨ç¤ºæ©Ÿèƒ½ã‚’å®Ÿè£…
   - ã‚¯ãƒªãƒƒã‚¯ã§ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤ºã™ã‚‹æ©Ÿèƒ½ã‚’å®Ÿè£…

#### æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

1. çµ±åˆãƒ‡ãƒ¼ã‚¿ã‚’å†ç”Ÿæˆã—ã¦ã€`trainer_comment`ãŒæ­£ã—ãè¨­å®šã•ã‚Œã‚‹ã‹ç¢ºèª
2. å†ç”Ÿæˆå¾Œã‚‚ã‚³ãƒ¡ãƒ³ãƒˆãŒè¡¨ç¤ºã•ã‚Œãªã„å ´åˆã¯ã€ãƒ­ã‚°ã‚’ç¢ºèªã—ã¦åŸå› ã‚’ç‰¹å®š
3. å¿…è¦ã«å¿œã˜ã¦ã€çµ±åˆå‡¦ç†ã®ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚’æ”¹å–„

#### é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«

- `KeibaCICD.keibabook/src/integrator/race_data_integrator.py`ï¼ˆ343-361è¡Œç›®ï¼‰
- `KeibaCICD.TARGET/common/jravan/trainer_mapper.py`
- `KeibaCICD.TARGET/scripts/build_trainer_index.py`
- `KeibaCICD.WebViewer/src/components/race-v2/TrainingAnalysisSection.tsx`
- `E:\share\KEIBA-CICD\data2\target\trainer_id_index.json`

---

### 5.2 èª¿æ•™å¸«ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®æ–‡å­—åŒ–ã‘å•é¡Œ

#### å•é¡Œã®çŠ¶æ³

èª¿æ•™å¸«ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ï¼ˆ`trainer_id_index.json`ï¼‰ã«æ–‡å­—åŒ–ã‘ãŒç™ºç”Ÿã—ã¦ã„ã‚‹ã€‚

**ç¢ºèªæ—¥**: 2026-01-31  
**ç—‡çŠ¶**: 
- `jvn_code`ã«`ï¿½`ï¼ˆç½®æ›æ–‡å­—ï¼‰ãŒå«ã¾ã‚Œã‚‹ï¼ˆä¾‹: `"jvn_code": "1173ï¿½"`ï¼‰
- `name`ã«æ–‡å­—åŒ–ã‘ãŒç™ºç”Ÿï¼ˆä¾‹: `"name": "ï½·è°·å·æµ©ï¿½"`ï¼‰
- UM_DATAã‹ã‚‰å–å¾—ã—ãŸèª¿æ•™å¸«åã«æ–‡å­—åŒ–ã‘ï¼ˆä¾‹: `nè¾ºè–«å½¦`, `å½¢å’Œå¹¸`ï¼‰

#### åŸå› ã®åˆ†æ

1. **CSVãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼**
   - ã‚¨ãƒ©ãƒ¼: `'shift_jis' codec can't decode byte 0x87 in position 8173: illegal multibyte sequence`
   - CSVãƒ•ã‚¡ã‚¤ãƒ«ã®ä¸€éƒ¨ãŒShift-JISã§æ­£ã—ããƒ‡ã‚³ãƒ¼ãƒ‰ã§ããªã„

2. **UM_DATAã®ãƒ‡ã‚³ãƒ¼ãƒ‰å•é¡Œ**
   - èª¿æ•™å¸«åã®ã‚ªãƒ•ã‚»ãƒƒãƒˆï¼ˆ855-862ãƒã‚¤ãƒˆï¼‰ãŒ1ãƒã‚¤ãƒˆãšã‚Œã¦ã„ã‚‹å¯èƒ½æ€§
   - `decode_sjis`é–¢æ•°ã§ç½®æ›æ–‡å­—ï¼ˆ`\ufffd`ï¼‰ãŒç™ºç”Ÿã—ã¦ã„ã‚‹

3. **æ–‡å­—åŒ–ã‘ãƒ‡ãƒ¼ã‚¿ã®ä¿å­˜**
   - æ–‡å­—åŒ–ã‘ãƒã‚§ãƒƒã‚¯ãŒä¸ååˆ†ã§ã€ä¸æ­£ãªãƒ‡ãƒ¼ã‚¿ãŒã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã«ä¿å­˜ã•ã‚Œã¦ã„ã‚‹

#### å®Ÿè£…æ¸ˆã¿ã®ä¿®æ­£

1. **CSVãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿æ”¹å–„**ï¼ˆ`build_trainer_index.py`ï¼‰
   - è¤‡æ•°ã®ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚’è©¦ã™ï¼ˆ`shift_jis`, `cp932`, `utf-8-sig`, `utf-8`ï¼‰
   - ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚’è¿½åŠ 

2. **æ–‡å­—åŒ–ã‘ãƒã‚§ãƒƒã‚¯ã®è¿½åŠ **
   - ç½®æ›æ–‡å­—ï¼ˆ`\ufffd`, `ï¿½`ï¼‰ã®æ¤œå‡º
   - ä¸æ­£ãªæ–‡å­—ãƒ‘ã‚¿ãƒ¼ãƒ³ã®æ¤œå‡ºï¼ˆä¾‹: æœ€åˆã®æ–‡å­—ãŒè‹±æ•°å­—1æ–‡å­—ã ã‘ï¼‰
   - æ–‡å­—åŒ–ã‘ã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ã—ãªã„ã‚ˆã†ã«ã™ã‚‹

3. **æ—¢å­˜ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°**
   - æ—¢å­˜ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚€éš›ã«æ–‡å­—åŒ–ã‘ãƒã‚§ãƒƒã‚¯ã‚’å®Ÿæ–½
   - æ–‡å­—åŒ–ã‘ã—ãŸã‚¨ãƒ³ãƒˆãƒªã‚’ã‚¹ã‚­ãƒƒãƒ—

#### æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

1. **ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®å†ç”Ÿæˆ**
   - ä¿®æ­£å¾Œã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã§ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’å†ç”Ÿæˆ
   - æ–‡å­—åŒ–ã‘ãŒè§£æ¶ˆã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª

2. **UM_DATAã®ã‚ªãƒ•ã‚»ãƒƒãƒˆç¢ºèª**
   - `parse_jv_horse_data.py`ã®`parse_um_record`é–¢æ•°ã§èª¿æ•™å¸«åã®ã‚ªãƒ•ã‚»ãƒƒãƒˆã‚’ç¢ºèª
   - å¿…è¦ã«å¿œã˜ã¦ã‚ªãƒ•ã‚»ãƒƒãƒˆã‚’èª¿æ•´ï¼ˆ855â†’854ãªã©ï¼‰

3. **CSVãƒ•ã‚¡ã‚¤ãƒ«ã®ç¢ºèª**
   - CSVãƒ•ã‚¡ã‚¤ãƒ«ã®æ–‡å­—ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚’ç¢ºèª
   - å¿…è¦ã«å¿œã˜ã¦UTF-8ã«å¤‰æ›

#### ç¢ºèªæ–¹æ³•

```python
# ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ã®æ–‡å­—åŒ–ã‘ãƒã‚§ãƒƒã‚¯
import json
with open('E:/share/KEIBA-CICD/data2/target/trainer_id_index.json', 'r', encoding='utf-8') as f:
    index = json.load(f)
    
for keibabook_id, info in index.items():
    name = info.get('name', '')
    jvn_code = info.get('jvn_code', '')
    if '\ufffd' in name or '\ufffd' in jvn_code or 'ï¿½' in name or 'ï¿½' in jvn_code:
        print(f"æ–‡å­—åŒ–ã‘æ¤œå‡º: {keibabook_id} -> {name}, {jvn_code}")
```

#### é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«

- `KeibaCICD.TARGET/scripts/build_trainer_index.py`ï¼ˆ300è¡Œç›®ä»˜è¿‘: CSVèª­ã¿è¾¼ã¿ã€140è¡Œç›®ä»˜è¿‘: UM_DATAå‡¦ç†ï¼‰
- `KeibaCICD.TARGET/scripts/parse_jv_horse_data.py`ï¼ˆ121è¡Œç›®: `decode_sjis`é–¢æ•°ã€194è¡Œç›®: èª¿æ•™å¸«åã®ãƒ‡ã‚³ãƒ¼ãƒ‰ï¼‰
- `E:\share\KEIBA-CICD\data2\target\trainer_id_index.json`