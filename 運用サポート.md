# 運用サポート - 競馬予想準備

## 1. 競馬ブックWEBスクレイピング

### 1.1 騎手情報を更新

```powershell
cd .\keiba-cicd-core\KeibaCICD.keibabook
python -m src.jockey_cli leading
python -m src.jockey_cli update --top 200
```

### 1.2 開催日設定

```powershell
cd .\keiba-cicd-core\KeibaCICD.keibabook
$from_date = "2026/01/12"
$to_date = "2026/01/12"
$date = "20260112"
```

### 1.3 基本データ取得

```powershell
# スケジュール取得
python -m src.fast_batch_cli schedule --start $from_date --end $to_date

# 基本データ取得（出馬表、調教、談話、勝因）
python -m src.fast_batch_cli full --start $from_date --end $from_date --data-types shutsuba,cyokyo,danwa,syoin

# パドック、成績データ取得
python -m src.fast_batch_cli full --start $from_date --end $from_date --data-types paddok,seiseki

# データ統合・MD生成
python -m src.integrator_cli batch --date $from_date
python -m src.markdown_cli batch --date $from_date --organized

python -m src.integrator_cli batch --date $to_date
python -m src.markdown_cli batch --date $to_date --organized

# 馬プロフィール生成
python -m src.horse_profile_cli --date $from_date --all --with-history --with-seiseki-table
```

### 1.4 調教コメント出力（競馬ブックデータ）

```powershell

cd Z:\KEIBA-CICD\調教データ
$date = "20260112"

# 馬名・調教タイムをクリップボードにコピー（TARGETに貼り付け用）
python training_summary.py --sakamichi chokyo_坂路.csv --course chokyo_コース.csv --date $date --output output.txt --clip-time

# 馬名・調教ラップをクリップボードにコピー（TARGETに貼り付け用）
python training_summary.py --sakamichi chokyo_坂路.csv --course chokyo_コース.csv --date $date --output output.txt --clip-lap

# 馬名・調教詳細をクリップボードにコピー
python training_summary.py --sakamichi chokyo_坂路.csv --course chokyo_コース.csv --date $date --output output.txt --clip-detail


cd .\keiba-cicd-core\KeibaCICD.keibabook\scripts

# 調教コメントをクリップボードにコピー
python clip_training_comment.py --date $date

# 本誌印をクリップボードにコピー
python clip_honshi_mark.py --date $date
```

**出力形式**:
- 調教コメント: `馬名<TAB>調教コメント`
- 本誌印: `馬名<TAB>本誌印`

---

## 2. 調教データ集計（TARGET用）

### 2.1 基本的な使い方

```powershell
cd Z:\KEIBA-CICD\調教データ
```

### 2.2 テキストファイル出力

```powershell
python training_summary.py --sakamichi chokyo_260104_坂路.csv --course chokyo_260104_コース.csv --date 20260111 --output chokyo_260104.txt
```

### 2.3 Excel出力

```powershell
python training_summary.py --sakamichi chokyo_260104_坂路.csv --course chokyo_260104_コース.csv --date 20260111 --output chokyo_260104.xlsx --excel
```

### 2.4 クリップボード出力

```powershell
# 馬名・調教ラップをクリップボードにコピー（TARGETに貼り付け用）
python training_summary.py --sakamichi chokyo_坂路.csv --course chokyo_コース.csv --date 20260111 --output output.txt --clip-lap

# 馬名・調教タイムをクリップボードにコピー（TARGETに貼り付け用）
python training_summary.py --sakamichi chokyo_坂路.csv --course chokyo_コース.csv --date 20260111 --output output.txt --clip-time

# 馬名・調教詳細をクリップボードにコピー（TARGETに貼り付け用）
python training_summary.py --sakamichi chokyo_坂路.csv --course chokyo_コース.csv --date 20260111 --output output.txt --clip-detail
```

### 2.5 オプション一覧

| オプション | 説明 |
|:---|:---|
| `-s`, `--sakamichi` | 坂路CSVファイルのパス |
| `-c`, `--course` | コース調教CSVファイルのパス |
| `-d`, `--date` | 基準日（YYYYMMDD形式）**必須** |
| `-o`, `--output` | 出力ファイルのパス **必須** |
| `--clip-lap` | 馬名・調教ラップをクリップボードにコピー |
| `--clip-time` | 馬名・調教タイムをクリップボードにコピー |
| `--clip-detail` | 馬名・調教詳細をクリップボードにコピー |
| `--excel` | Excelファイル(.xlsx)で出力 |

### 2.6 調教ラップ分類ルール

| 分類 | 条件 | 説明 |
|:---:|:---|:---|
| **SS** | 好タイム + S分類 + 加速or同タイム | 最高（好タイム + 好ラップ） |
| **S** | Lap2・Lap1が11秒台以下 | 好ラップ（2F連続11秒台以下） |
| **A** | Lap1が11秒台以下、Lap2が12秒台以上 | 好（加速して終い11秒台以下） |
| **B** | Lap2・Lap1が12秒台 | 良（2F連続12秒台） |
| **C** | Lap1が12秒台 | 普通（終い12秒台） |
| **D** | Lap1が13秒台以上 | 軽め |

記号: `+` = 加速, `-` = 減速, `=` = 同タイム

### 2.7 調教タイム分類

| 記号 | 意味 |
|:---:|:---|
| **坂** | 坂路で好タイム |
| **コ** | コースで好タイム |
| **両** | 坂路+コース両方で好タイム |
| (ブランク) | 好タイムなし |

**好タイム基準（4F）:**
- 美浦坂路: 52.9秒以下
- 栗東坂路: 53.9秒以下
- 美浦/栗東コース: 52.2秒以下
