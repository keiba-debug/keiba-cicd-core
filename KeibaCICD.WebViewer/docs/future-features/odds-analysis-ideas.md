# オッズ分析機能 将来検討アイデア

## 概要
TARGET frontier JVのオッズ分析画面を参考に、将来実装を検討する機能をまとめる。

---

## 1. 馬別シェア円グラフ

### 機能概要
- 各馬の単勝オッズから算出した「得票シェア」を円グラフで視覚化
- 人気順/馬番順で表示切替可能
- 枠色で色分け

### 実装のポイント
- オッズから得票率を算出: `share = (1 / odds) / Σ(1 / odds) * 100`
- Recharts の `PieChart` で実装可能
- 枠色対応は既存の `getWakuColor()` を活用

### 優先度: ⭐⭐⭐ (中)
視覚的にわかりやすく、実装も比較的容易。

---

## 2. 馬別単勝・連勝シェア横棒グラフ

### 機能概要
- 単勝シェアと連勝（複勝）シェアを横棒グラフで並べて比較
- シェアの差が大きい馬 = 「単勝では過小評価」の可能性

### 実装のポイント
- 複勝オッズからも得票率を算出
- `BarChart` (横向き) で2系列表示
- 差分が大きい馬をハイライト

### 優先度: ⭐⭐⭐ (中)
単複オッズの乖離分析は馬券戦略に有用。

---

## 3. 時系列オッズテーブル

### 機能概要
- 時刻ごとのオッズ変動を表形式で表示
- 各馬の列、各時刻の行
- オッズ変動を色で表現（上昇=青、下降=赤）

### 実装のポイント
- JI_2026 (JTファイル) から時系列データを取得
- 既存の `getJiOddsTimeSeries()` を活用
- セル単位で前回比の色付け

### 優先度: ⭐⭐⭐⭐ (高)
時系列データは既に取得可能。UI実装のみで対応可能。

### 技術メモ
```typescript
// 既存関数を活用
import { getJiOddsTimeSeries } from '@/lib/data/rt-data-reader';
const timeSeries = getJiOddsTimeSeries(raceId);
// timeSeries[i].odds = { '1': 2.3, '2': 5.6, ... }
```

---

## 4. 馬連分析表（オッズマトリクス）

### 機能概要
- 馬連オッズをマトリクス形式で表示
- 各馬の得票率グラフ
- 変動幅グラフ

### 実装のポイント
- HY_DATA から馬連オッズを取得（O3レコード）
- マトリクス表示はテーブルまたはヒートマップ
- 期待値計算との連携

### 優先度: ⭐⭐ (低〜中)
馬連データの取得・パースが必要。工数大。

---

## 5. 異常票検出グラフ

### 機能概要
- 時系列で「異常票」と「一般票」を区別して表示
- 急激な投票増加を検出
- 「見つけやすい時間帯」「見つけにくい時間帯」を可視化

### 実装のポイント
- 投票数の時系列変化を分析
- 移動平均からの乖離を「異常」と判定
- アラート機能との連携

### 優先度: ⭐⭐⭐⭐⭐ (最高)
「オッズのゆがみ」検出の核心機能。ユーザー価値が高い。

### アルゴリズム案
```
1. 時刻ごとの投票増加量を計算
2. 過去N期間の平均投票増加量を算出
3. 平均の2σ以上の増加 = 「異常票」候補
4. 複数馬で同時発生 = 「馬連・3連」狙いの可能性
```

---

## 6. 時系列オッズトレンドグラフ

### 機能概要
- 各馬のオッズ推移を折れ線グラフで表示
- 投票数の棒グラフをオーバーレイ
- 上位人気馬を強調表示

### 実装のポイント
- Recharts の `ComposedChart` (Line + Bar)
- 馬番ごとに色分け（枠色または固定色）
- ズーム・スクロール対応

### 優先度: ⭐⭐⭐⭐ (高)
視覚的インパクトが大きく、ユーザー体験向上に貢献。

---

## 実装優先順位（提案）

| 順位 | 機能 | 理由 |
|------|------|------|
| 1 | 時系列オッズテーブル | データ取得済み、UI実装のみ |
| 2 | 時系列オッズトレンドグラフ | 視覚的効果大 |
| 3 | 異常票検出 | ユーザー価値最大、差別化要素 |
| 4 | 馬別シェア円グラフ | 実装容易、視覚的 |
| 5 | 単勝・連勝シェア比較 | 戦略立案に有用 |
| 6 | 馬連マトリクス | 工数大、後回し可 |

---

## 技術的な課題

### データソース
| 機能 | データソース | 現状 |
|------|-------------|------|
| 時系列単勝 | JI_2026/JTファイル | ✅ 取得可能 |
| 時系列複勝 | JI_2026/JFファイル | 🔧 パーサー追加必要 |
| 馬連オッズ | HY_DATA/O3レコード | 🔧 パーサー追加必要 |
| 投票数 | HY_DATA | 🔧 パーサー追加必要 |

### フロントエンド
- Recharts ライブラリで対応可能
- 大量データの場合はバーチャルスクロール検討

---

## 参考資料
- TARGET frontier JV オッズ画面キャプチャ（2026-01-31）
- JV-Data仕様書（O1, O3レコード）

---

## 更新履歴
- 2026-01-31: 初版作成
