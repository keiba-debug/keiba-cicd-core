# 実行コマンド一覧

## 📋 完全自動実行（推奨）

### 本番環境向け - 元ファイル削除付き完全処理

```bash
# ステップ1: 日程データ取得とレースデータ一括取得
python -m src.fast_batch_cli full --start 2025/08/09 --end 2025/08/10 --delay 0.5 --max-workers 10

# ステップ2: データ統合（実際の開催日で作成）
python -m src.integrator_cli batch --start-date 2025/08/09 --end-date 2025/08/10

# ステップ3: Markdown生成（organized以下に出力）
python -m src.markdown_cli batch --date 2025/08/09 --organized
python -m src.markdown_cli batch --date 2025/08/10 --organized

# ステップ4: ファイル整理とtempフォルダクリーンアップ
python -m src.organizer_cli organize --copy --delete-original

# ステップ5: インデックス作成
python -m src.organizer_cli index


# パドック情報を定期更新（5分間隔で20回）
python -m src.paddock_updater --date 2025/08/10 --continuous --interval 300
--max-iterations 20

# 統合ファイルとMarkdown生成（競馬場別フォルダに保存）
python -m src.integrator_cli single --race-id 202501080609
python -m src.markdown_cli single --race-id 202501080609

```

## 🚀 高速データ取得コマンド

### フル処理（推奨）
```bash
# 日程取得 → 全データタイプ取得を一括実行
# デフォルトで6種類すべて取得: seiseki,shutsuba,cyokyo,danwa,syoin,paddok
python -m src.fast_batch_cli full --start 2025/08/09 --end 2025/08/10 --delay 0.5 --max-workers 8
```

### 個別処理

#### 日程データのみ
```bash
python -m src.fast_batch_cli schedule --start 2025-08-09 --end 2025-08-10
```

#### 特定データタイプのみ
```bash
# 基本4データ
python -m src.fast_batch_cli data --start 2025-08-09 --end 2025-08-10 --data-types seiseki,shutsuba,cyokyo,danwa

# 新規データタイプのみ（前走インタビュー、パドック）
python -m src.fast_batch_cli data --start 2025-08-09 --end 2025-08-10 --data-types syoin,paddok

# 全データタイプ明示指定
python -m src.fast_batch_cli data --start 2025-08-09 --end 2025-08-10 --data-types seiseki,shutsuba,cyokyo,danwa,syoin,paddok
```

## 📊 データ統合コマンド

### バッチ統合（期間指定）
```bash
python -m src.integrator_cli batch --start-date 2025/08/09 --end-date 2025/08/10
```

### 単日統合
```bash
python -m src.integrator_cli batch --date 2025/08/09
```

### 個別レース統合
```bash
python -m src.integrator_cli integrate --race-id 202508090101
```

## 📝 Markdown生成コマンド

### バッチ生成（organized以下に出力）
```bash
# --organizedオプションでorganized/YYYY/MM/DD/以下に出力
python -m src.markdown_cli batch --date 2025/08/09 --organized
python -m src.markdown_cli batch --date 2025/08/10 --organized
```

### 個別レース生成
```bash
python -m src.markdown_cli single --race-id 202508090101 --organized
```

### プレビュー（保存なし）
```bash
python -m src.markdown_cli preview --race-id 202508090101
```

### 既存JSONから一括変換
```bash
python -m src.markdown_cli convert --source-dir Z:/KEIBA-CICD/data/integrated --organized
```

## 📁 ファイル整理コマンド

### 整理（コピー + tempフォルダ削除）
```bash
# tempフォルダからorganizedへコピー後、tempフォルダをクリーンアップ
python -m src.organizer_cli organize --copy --delete-original
```

### 整理（移動のみ）
```bash
python -m src.organizer_cli organize
```

### インデックス作成
```bash
python -m src.organizer_cli index
```

### ファイル検索
```bash
# 日付で検索
python -m src.organizer_cli find --date 2025/08/09

# 競馬場で検索
python -m src.organizer_cli find --venue 東京

# データタイプで検索
python -m src.organizer_cli find --data-type integrated
```

### 統計情報表示
```bash
python -m src.organizer_cli stats --detailed
```

## 🔧 パラメータ説明

### 共通パラメータ

| パラメータ | 説明 | デフォルト | 例 |
|----------|------|-----------|-----|
| `--start` / `--start-date` | 開始日 | - | 2025-08-09, 2025/08/09, 20250809 |
| `--end` / `--end-date` | 終了日 | 開始日と同じ | 2025-08-10 |
| `--date` | 単一日付 | - | 2025/08/09 |

### fast_batch_cli専用

| パラメータ | 説明 | デフォルト | 推奨値 |
|----------|------|-----------|--------|
| `--delay` | リクエスト間の遅延（秒） | 1.0 | 0.5 |
| `--max-workers` | 並列ワーカー数 | 5 | 8-10 |
| `--data-types` | 取得データタイプ | seiseki,shutsuba,cyokyo,danwa,syoin,paddok | 全タイプ |
| `--wait-between-phases` | Phase間の待機時間 | 2.0 | 2.0 |

### データタイプ一覧

| タイプ | 説明 | URL |
|--------|------|-----|
| `seiseki` | 成績データ | /cyuou/seiseki/ |
| `shutsuba` | 出馬表（本誌印含む） | /cyuou/syutuba/ |
| `cyokyo` | 調教データ | /cyuou/cyokyo/ |
| `danwa` | 厩舎談話 | /cyuou/danwa/ |
| `syoin` | 前走インタビュー | /cyuou/syoin/ |
| `paddok` | パドック情報 | /cyuou/paddok/ |

## 📂 ディレクトリ構成

```
Z:/KEIBA-CICD/data/
├── temp/              # 一時ダウンロードフォルダ（自動削除）
├── race_ids/          # 日程データ
├── integrated/        # 統合JSONファイル
├── markdown/          # Markdownファイル（通常）
├── organized/         # 整理済みファイル
│   └── 2025/
│       └── 08/
│           ├── 09/    # 8月9日開催
│           │   ├── 札幌/
│           │   ├── 新潟/
│           │   ├── 中京/
│           │   └── *.md  # Markdownファイル
│           └── 10/    # 8月10日開催
└── logs/              # ログファイル
```

## 💡 使用例

### 例1: 土日のデータを完全処理（推奨）
```bash
# すべて自動で処理（tempフォルダも自動削除）
python -m src.fast_batch_cli full --start 2025/08/09 --end 2025/08/10 --delay 0.5 --max-workers 8
python -m src.integrator_cli batch --start-date 2025/08/09 --end-date 2025/08/10
python -m src.markdown_cli batch --date 2025/08/09 --organized
python -m src.markdown_cli batch --date 2025/08/10 --organized
python -m src.organizer_cli organize --copy --delete-original
python -m src.organizer_cli index
```

### 例2: 過去データの補完
```bash
# 特定期間のデータを一括取得
python -m src.fast_batch_cli full --start 2025/01/01 --end 2025/01/31 --delay 0.8 --max-workers 6
```

### 例3: リアルタイム更新
```bash
# 当日のデータを高速更新
TODAY=$(date +%Y/%m/%d)
python -m src.fast_batch_cli full --start $TODAY --delay 0.3 --max-workers 12
python -m src.integrator_cli batch --date $TODAY
python -m src.markdown_cli batch --date $TODAY --organized
```

## ⚠️ 注意事項

1. **データフロー**: temp → integrated → organized の順序を守る
2. **日付形式**: `YYYY-MM-DD`, `YYYY/MM/DD`, `YYYYMMDD` すべて対応
3. **tempフォルダ**: `--delete-original`で自動削除される
4. **race_id形式**: 実際の開催日ではなく競馬の開催回次で管理
   - 例: 202502070501 = 2025年第2回新潟7日目第1レース（実際は8月9日開催）

## 🐛 トラブルシューティング

### エラー: 日付形式が認識されない
```bash
# ハイフン、スラッシュ、数字のみ すべて対応
--start 2025-08-09  # OK
--start 2025/08/09  # OK
--start 20250809    # OK
```

### エラー: syoin/paddokデータが取得できない
```bash
# 明示的にデータタイプを指定
python -m src.fast_batch_cli data --start 2025/08/09 --data-types syoin,paddok
```

### エラー: データが見つからない
```bash
# race_idsファイルを確認
ls Z:/KEIBA-CICD/data/race_ids/

# 日程データを再取得
python -m src.fast_batch_cli schedule --start 2025-08-09
```

### エラー: 統合ファイルが空
```bash
# 必要なデータタイプがあるか確認
ls Z:/KEIBA-CICD/data/temp/*202508090101*

# データを再取得
python -m src.fast_batch_cli data --start 2025-08-09 --data-types seiseki,shutsuba,cyokyo,danwa,syoin,paddok
```

## 🔄 更新履歴

### 最新の変更点
- tempフォルダを作業用ディレクトリとして使用
- 実際の開催日付（8/9, 8/10）でorganizedディレクトリを構成
- syoin（前走インタビュー）とpaddok（パドック情報）をデフォルトに追加
- Markdownファイルをorganized以下に直接出力可能
- race_info要素にrace_idを追加
- 元ファイル自動削除オプションの改善