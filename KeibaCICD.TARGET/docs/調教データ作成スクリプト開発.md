## ✅ 更新版プロンプト

```markdown
# 調教データ集計スクリプト作成依頼

## 目的
2種類の調教CSV（坂路・コース）を読み込み、馬ごとの調教ラップ分類・調教タイム分類と調教詳細を
タブ区切りファイルで出力する。出力ファイルはTARGET（競馬ソフト）に取り込む。

## 実行環境・コマンド
- 言語: Python または PowerShell
- 実行例:
  ```bash
  python training_summary.py --sakamichi sakamichi.csv --course course.csv --date 20251228 --output output.txt
  ```

## 入力ファイル仕様

### 坂路CSV
```csv
場所,年月日,曜日,馬名,調教師,Time1,Time2,Time3,Time4,Lap4,Lap3,Lap2,Lap1
美浦,20251210,水,エナジーショット,矢嶋大樹,51.3,38.3,25.8,13.2,13.0,12.5,12.6,13.2
```

### コース調教CSV
```csv
場所,コース,回り,年月日,曜日,馬名,調教師,5F,4F,3F,2F,1F,Lap5,Lap4,Lap3,Lap2,Lap1
美浦,D,右,20251224,水,マイバラード,松永康利,64.3,49.7,36.4,24.0,12.0,14.6,13.3,12.4,12.0,12.0
```

## 調教ラップ分類定義

### 判定カラム
- `Lap2`: ラスト2Fラップ（秒）
- `Lap1`: ラスト1Fラップ（秒）

### 秒数の定義
| 表記 | 範囲 |
|------|------|
| 11秒台以下 | x < 12.0 |
| 12秒台 | 12.0 ≤ x < 13.0 |
| 13秒台以上 | 13.0 ≤ x |

### 加速/減速/同タイムの判定
| 記号 | 条件 | 例 |
|------|------|-----|
| +（加速） | Lap2 > Lap1 | 12.4 → 12.0 |
| -（減速） | Lap2 < Lap1 | 12.0 → 12.4 |
| =（同タイム） | Lap2 == Lap1 | 12.0 → 12.0 |

### 主分類ルール

| 分類 | 条件 | 説明 |
|------|------|------|
| **SS** | 好タイム + S分類 + 加速or同タイム | 最高（好タイム + 好ラップ） |
| **S** | Lap2: 11秒台以下 AND Lap1: 11秒台以下 | 好ラップ（2F連続11秒台以下） |
| **A** | Lap1: 11秒台以下 AND Lap2: 12秒台以上 | 好（加速して終い11秒台以下） |
| **B** | Lap2: 12秒台 AND Lap1: 12秒台 | 良（2F連続12秒台） |
| **C** | Lap1: 12秒台 AND (Lap2が11秒台以下 or 13秒台以上) | 普通（終い12秒台） |
| **D** | Lap1: 13秒台以上 | 軽め |

### SS分類の条件
- **好タイム** + **S分類（Lap2・Lap1が11秒台以下）** + **加速or同タイム**
- S分類でも減速（S-）の場合はSSにならない

### 優先度（点数順）

| 優先度 | 分類 | 説明 |
|--------|------|------|
| 16 | SS | 好タイム + S分類 + 加速or同タイム |
| 15 | S+ | 2F連続11秒台以下 加速 |
| 14 | S= | 2F連続11秒台以下 同タイム |
| 13 | S- | 2F連続11秒台以下 減速 |
| 12 | A+ | 終い11秒台以下 加速 |
| 11 | A= | 終い11秒台以下 同タイム |
| 10 | A- | 終い11秒台以下 減速 |
| 9 | B+ | 2F連続12秒台 加速 |
| 8 | B= | 2F連続12秒台 同タイム |
| 7 | B- | 2F連続12秒台 減速 |
| 6 | C+ | 終い12秒台 加速 |
| 5 | C= | 終い12秒台 同タイム |
| 4 | C- | 終い12秒台 減速 |
| 3 | D+ | 終い13秒台以上 加速 |
| 2 | D= | 終い13秒台以上 同タイム |
| 1 | D- | 終い13秒台以上 減速 |

※ 分類記号は半角2文字（例: SS, S+, A-, B=）

### 分類判定フローチャート
```
1. Lap2とLap1を比較 → 加速(+) / 減速(-) / 同タイム(=) を決定
2. Lap2が11秒台以下 AND Lap1が11秒台以下 → S分類
3. S分類 + 加速or同タイム + 好タイム → SS
4. Lap1が11秒台以下 AND Lap2が12秒台以上 → A
5. Lap2が12秒台 AND Lap1が12秒台 → B
6. Lap1が12秒台 AND (Lap2が11秒台以下 or 13秒台以上) → C
7. Lap1が13秒台以上 → D
8. 分類 + 加速減速記号を組み合わせ → 例: SS, S+, A-, B=
```

### 判定例

| Lap2 | Lap1 | 4Fタイム | 分類 | 解釈 |
|------|------|----------|------|------|
| 11.5 | 11.2 | 52.0（美浦坂路） | **SS** | 好タイム + S分類 + 加速 |
| 11.5 | 11.2 | 54.0（栗東坂路） | **S+** | S分類 + 加速（好タイムなし） |
| 10.5 | 11.2 | 52.0（美浦坂路） | **S-** | S分類 + 減速（SSにならない） |
| 12.4 | 11.8 | 51.5（コース） | **A+** | 12秒台→11秒台加速 |
| 12.4 | 12.0 | 53.0 | **B+** | 両方12秒台で加速 |

## 調教タイム分類定義

### 好タイム基準（4F）

| 場所 | 種別 | 基準 |
|------|------|------|
| 美浦 | 坂路 | 52.9秒以下 |
| 栗東 | 坂路 | 53.9秒以下 |
| 美浦 | コース | 52.2秒以下 |
| 栗東 | コース | 52.2秒以下 |

### 調教タイム分類記号（全角1文字）

| 記号 | 意味 |
|------|------|
| 坂 | 坂路で好タイム |
| コ | コースで好タイム |
| 両 | 坂路+コース両方で好タイム |
| (ブランク) | 好タイムなし |

### 判定期間
- 全期間（最終追い切り + 一週前 + 水木以外）で好タイムがあるかどうか

## 日付判定ルール

### パラメータ
- `--date YYYYMMDD`: 基準日を指定（必須）

### 追い切り期間の定義
| 分類 | 対象 |
|------|------|
| 最終追い切り | 基準日から遡って直近の水曜・木曜 |
| 一週前追い切り | 最終追い切りの7日前の水曜・木曜 |

### 曜日別の扱い
| 曜日 | 扱い |
|------|------|
| 水曜・木曜 | 最終 or 一週前の追い切りとして集計 |
| その他の曜日 | SS, S, Aランクの場合のみ調教詳細に出力 |

## 重複・集計ルール

### 同一馬・同一日に複数データがある場合
- 点数（優先度）が高い分類を採用

### 同じ週に坂路とコース両方ある場合
- **調教ラップ分類**: 点数が高い方を採用
- **調教詳細**: 両方を記載（点数高い方を先に）

### 調教分類の最終決定（重要）
- **全期間で最高優先度の分類を採用**
- 水木以外（土日など）で高評価の追切がある場合、そちらを優先
- 例：水曜がD-、前週土曜がSS → **SSを採用**

| ケース | 水曜 | 土曜 | 採用分類 |
|--------|------|------|----------|
| 土曜が高評価 | D- | SS | SS |
| 水曜が高評価 | A+ | B- | A+ |
| 同評価 | A+ | A+ | A+ |

## 出力ファイル仕様

### フォーマット
- 区切り: タブ区切り
- 文字コード: Shift-JIS
- ヘッダー: あり

### 出力カラム
```
馬名	調教師	調教ラップ	調教タイム	調教詳細
```

### 調教詳細のフォーマット
- 区切り文字: 半角スペース
- 場所表記: 坂路 / コース
- 曜日表記: (月)(火)(金)(土)(日) ※水木以外
- 好タイムの場合: 括弧内にタイム表示（例: SS(52.1)）

| ケース | 出力例 |
|--------|--------|
| 最終のみ（好タイム） | `最終坂路SS(52.1)` |
| 最終のみ（普通タイム） | `最終坂路S+` |
| 最終（坂路+コース） | `最終坂路SS(52.5) コースA+(51.9)` |
| 一週前のみ | `最終なし 一週前コースB-` |
| 最終+一週前 | `最終坂路SS(52.1) 一週前コースB-` |
| 水木以外でSSあり | `最終なし (土)コースSS(50.4)` |

### 出力例
```
馬名	調教師	調教ラップ	調教タイム	調教詳細
シートゥサミット	田中太郎	SS	コ	最終なし (土)コースSS(50.4)
エナジーショット	矢嶋大樹	S+	－	最終坂路S+
マイバラード	松永康利	A+	コ	最終コースA+(51.8) 一週前坂路B+
サンプルホース	佐藤三郎	C-	－	最終なし 一週前コースC-
```

### 出力対象
- 対象データがある馬のみ出力（データなしの馬は出力しない）

## エラーハンドリング
- ファイルが存在しない場合: エラーメッセージを表示して終了
- 必須パラメータ不足: 使用方法を表示して終了
- 不正なデータ行: スキップしてログ出力（標準エラー出力）
- Lap値が数値でない場合: スキップしてログ出力

## 処理完了時の出力
```
処理完了:
  坂路データ読込: XXX件
  コースデータ読込: XXX件
  出力馬数: XXX頭
  出力ファイル: output.txt
```
```

---

主な変更点：
1. **分類体系**: SS > S > A > B > C > D の6段階に変更
2. **SS分類追加**: 好タイム + S分類 + 加速or同タイム
3. **調教タイム分類追加**: 坂/コ/両/－ の全角1文字
4. **出力カラム**: 5カラム（馬名、調教師、調教ラップ、調教タイム、調教詳細）
5. **好タイム基準**: 場所・種別ごとに4F基準値を設定
6. **調教詳細**: 好タイムの場合は括弧内にタイム表示
