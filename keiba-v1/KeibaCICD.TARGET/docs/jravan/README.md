# JRA-VAN ãƒ‡ãƒ¼ã‚¿ä»•æ§˜æ›¸

KeibaCICDãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ãŠã‘ã‚‹JRA-VAN Data Lab ãƒ‡ãƒ¼ã‚¿ã®è§£æãƒ»æ´»ç”¨ã®ãŸã‚ã®çµ±ä¸€ä»•æ§˜æ›¸ã§ã™ã€‚

## ğŸ“‹ ç›®çš„

- **ä»•æ§˜ã®ä¸€å…ƒç®¡ç†**: ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã‚’æ¯å›èª¿ã¹ã‚‹å¿…è¦ã‚’ãªãã™
- **IDå¤‰æ›ã®åŠ¹ç‡åŒ–**: ç«¶é¦¬ãƒ–ãƒƒã‚¯ID â‡” JRA-VAN ID ã®å¤‰æ›ã‚’é«˜é€ŸåŒ–
- **å†åˆ©ç”¨å¯èƒ½ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒª**: å…±é€šå‡¦ç†ã‚’ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åŒ–ã—ã¦ä½¿ã„ã¾ã‚ã™

## ğŸ“‚ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 

```
docs/jravan/
â”œâ”€â”€ README.md              # ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆæ¦‚è¦ï¼‰
â”œâ”€â”€ ID_MAPPING.md          # IDå¤‰æ›ä»•æ§˜æ›¸
â”œâ”€â”€ data-types/            # ãƒ‡ãƒ¼ã‚¿ã‚¿ã‚¤ãƒ—åˆ¥ä»•æ§˜
â”‚   â”œâ”€â”€ CK_DATA.md        # èª¿æ•™ãƒ‡ãƒ¼ã‚¿ï¼ˆå‚è·¯ãƒ»ã‚³ãƒ¼ã‚¹ï¼‰
â”‚   â”œâ”€â”€ UM_DATA.md        # é¦¬ãƒã‚¹ã‚¿ãƒ‡ãƒ¼ã‚¿
â”‚   â”œâ”€â”€ DE_DATA.md        # å‡ºé¦¬è¡¨ãƒ‡ãƒ¼ã‚¿
â”‚   â””â”€â”€ SE_DATA.md        # æˆç¸¾ãƒ‡ãƒ¼ã‚¿
â””â”€â”€ examples/              # å®Ÿè£…ä¾‹
    â”œâ”€â”€ id_conversion.md
    â””â”€â”€ data_indexing.md
```

## ğŸ”‘ ä¸»è¦ãªIDä½“ç³»

### 1. é¦¬IDï¼ˆHorse IDï¼‰

| ã‚·ã‚¹ãƒ†ãƒ  | IDå½¢å¼ | ä¾‹ | èª¬æ˜ |
|---------|--------|-----|------|
| JRA-VAN | 10æ¡æ•°å€¤ | `2020104764` | è¡€çµ±ç™»éŒ²ç•ªå·ï¼ˆã‚±ãƒˆã‚¦ãƒˆã‚¦ãƒ­ã‚¯ãƒãƒ³ã‚´ã‚¦ï¼‰ |
| ç«¶é¦¬ãƒ–ãƒƒã‚¯ | `umacd` | ä¸æ˜ | ç«¶é¦¬ãƒ–ãƒƒã‚¯å†…éƒ¨ID |

**å¤‰æ›æ–¹æ³•**: [horse_id_mapper.py](../../scripts/horse_id_mapper.py) ã§é¦¬åã‚’çµŒç”±ã—ã¦å¤‰æ›

### 2. ãƒ¬ãƒ¼ã‚¹IDï¼ˆRace IDï¼‰

| ã‚·ã‚¹ãƒ†ãƒ  | IDå½¢å¼ | ä¾‹ | èª¬æ˜ |
|---------|--------|-----|------|
| JRA-VAN | 16æ¡ | `2026012406010208` | Year(4)+MonthDay(4)+Jyo(2)+Kaiji(2)+Nichiji(2)+RaceNum(2) |
| ç«¶é¦¬ãƒ–ãƒƒã‚¯ | URLå½¢å¼ | `/race/2026010608/` | æ—¥ä»˜å½¢å¼ï¼ˆYYYYMMDD + ãƒ¬ãƒ¼ã‚¹ç•ªå·?ï¼‰ |

**æ§‹æˆè¦ç´ **:
- Year: é–‹å‚¬å¹´ï¼ˆ4æ¡ï¼‰ä¾‹: `2026`
- MonthDay: æœˆæ—¥ï¼ˆ4æ¡ï¼‰ä¾‹: `0124` = 1æœˆ24æ—¥
- JyoCD: ç«¶é¦¬å ´ã‚³ãƒ¼ãƒ‰ï¼ˆ2æ¡ï¼‰ä¾‹: `06` = ä¸­å±±
- Kaiji: å›æ¬¡ï¼ˆ2æ¡ï¼‰ä¾‹: `01` = 1å›
- Nichiji: æ—¥æ¬¡ï¼ˆ2æ¡ï¼‰ä¾‹: `02` = 2æ—¥ç›®
- RaceNum: ãƒ¬ãƒ¼ã‚¹ç•ªå·ï¼ˆ2æ¡ï¼‰ä¾‹: `08` = 8R

### 3. ç«¶é¦¬å ´ã‚³ãƒ¼ãƒ‰ï¼ˆTrack Codeï¼‰

| ã‚³ãƒ¼ãƒ‰ | ç«¶é¦¬å ´å | JRA-VAN JyoCD |
|-------|---------|--------------|
| 01 | æœ­å¹Œ | 01 |
| 02 | å‡½é¤¨ | 02 |
| 03 | ç¦å³¶ | 03 |
| 04 | æ–°æ½Ÿ | 04 |
| 05 | æ±äº¬ | 05 |
| 06 | ä¸­å±± | 06 |
| 07 | ä¸­äº¬ | 07 |
| 08 | äº¬éƒ½ | 08 |
| 09 | é˜ªç¥ | 09 |
| 10 | å°å€‰ | 10 |

## ğŸ“Š ãƒ‡ãƒ¼ã‚¿ã‚¿ã‚¤ãƒ—ä¸€è¦§

### èª¿æ•™ãƒ‡ãƒ¼ã‚¿ (CK_DATA)

**ç”¨é€”**: é¦¬ã®èª¿æ•™å±¥æ­´åˆ†æã€è¿½åˆ‡è©•ä¾¡

- **ãƒ•ã‚¡ã‚¤ãƒ«**: `CK_DATA/{å¹´}/{å¹´æœˆ}/HC*.DAT`, `WC*.DAT`
- **ç¨®é¡**:
  - HC: å‚è·¯èª¿æ•™ï¼ˆHanro Courseï¼‰
  - WC: ã‚³ãƒ¼ã‚¹èª¿æ•™ï¼ˆWood Courseï¼‰
- **è©³ç´°**: [data-types/CK_DATA.md](./data-types/CK_DATA.md)

### é¦¬ãƒã‚¹ã‚¿ãƒ‡ãƒ¼ã‚¿ (UM_DATA)

**ç”¨é€”**: é¦¬ã®åŸºæœ¬æƒ…å ±å–å¾—ã€IDå¤‰æ›

- **ãƒ•ã‚¡ã‚¤ãƒ«**: `UM_DATA/{å¹´}/UM{å¹´}{åŠæœŸ}.DAT`
- **ãƒ¬ã‚³ãƒ¼ãƒ‰é•·**: 1609ãƒã‚¤ãƒˆ
- **è©³ç´°**: [data-types/UM_DATA.md](./data-types/UM_DATA.md)

### å‡ºé¦¬è¡¨ãƒ‡ãƒ¼ã‚¿ (DE_DATA)

**ç”¨é€”**: ãƒ¬ãƒ¼ã‚¹æƒ…å ±ã€ç™ºèµ°æ™‚åˆ»ã€å‡ºèµ°é¦¬ä¸€è¦§

- **ãƒ•ã‚¡ã‚¤ãƒ«**: `DE_DATA/{å¹´}/DR{YYYYMMDD}.DAT`
- **ä¸»è¦ãƒ¬ã‚³ãƒ¼ãƒ‰**: RAï¼ˆãƒ¬ãƒ¼ã‚¹æƒ…å ±ï¼‰
- **è©³ç´°**: [data-types/DE_DATA.md](./data-types/DE_DATA.md)

### æˆç¸¾ãƒ‡ãƒ¼ã‚¿ (SE_DATA)

**ç”¨é€”**: ãƒ¬ãƒ¼ã‚¹çµæœã€ç€é †ã€ã‚¿ã‚¤ãƒ 

- **ãƒ•ã‚¡ã‚¤ãƒ«**: `SE_DATA/{å¹´}/SR{YYYYMMDD}.DAT`
- **ä¸»è¦ãƒ¬ã‚³ãƒ¼ãƒ‰**: SEï¼ˆãƒ¬ãƒ¼ã‚¹çµæœï¼‰
- **è©³ç´°**: [data-types/SE_DATA.md](./data-types/SE_DATA.md)

## ğŸ”§ å…±é€šãƒ©ã‚¤ãƒ–ãƒ©ãƒª

### ã‚¤ãƒ³ãƒãƒ¼ãƒˆ

```python
from common.jravan import (
    # IDå¤‰æ›
    get_horse_id_by_name,
    get_horse_name_by_id,

    # ãƒ‡ãƒ¼ã‚¿å–å¾—
    get_horse_info,
    get_race_info,
    get_training_data,

    # ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ç®¡ç†
    HorseIdIndex,
    RaceIdIndex,
)
```

### ä½¿ç”¨ä¾‹

#### é¦¬å â†’ JRA-VAN ID å¤‰æ›

```python
from common.jravan import get_horse_id_by_name

# é¦¬åã‹ã‚‰10æ¡IDã‚’å–å¾—
horse_id = get_horse_id_by_name("ãƒ‰ã‚¦ãƒ‡ãƒ¥ãƒ¼ã‚¹")
# => "2019103487"
```

#### ãƒ¬ãƒ¼ã‚¹IDç”Ÿæˆ

```python
from common.jravan.race_id import build_race_id

race_id = build_race_id(
    year=2026,
    month=1,
    day=24,
    track_code="06",  # ä¸­å±±
    kaiji=1,
    nichiji=2,
    race_num=8
)
# => "2026012406010208"
```

#### èª¿æ•™ãƒ‡ãƒ¼ã‚¿å–å¾—

```python
from common.jravan import get_training_data

# é¦¬ã®èª¿æ•™ãƒ‡ãƒ¼ã‚¿å–å¾—ï¼ˆãƒ¬ãƒ¼ã‚¹æ—¥ã‹ã‚‰14æ—¥å‰ã¾ã§ï¼‰
training = get_training_data(
    horse_id="2020104764",
    race_date="20260125",
    days_back=14
)
```

## ğŸš€ ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

### åˆå›ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ï¼ˆå¿…é ˆï¼‰

é¦¬åã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’æ§‹ç¯‰ã—ã¾ã™ï¼ˆåˆå›ã®ã¿å®Ÿè¡Œã€ç´„1åˆ†ï¼‰:

```powershell
cd KeibaCICD.TARGET
python scripts/horse_id_mapper.py --build-index
```

### ç’°å¢ƒå¤‰æ•°

`.env` ã¾ãŸã¯ç’°å¢ƒå¤‰æ•°ã§è¨­å®š:

```
KEIBA_DATA_ROOT_DIR=E:\share\KEIBA-CICD\data2
JV_DATA_ROOT_DIR=C:\TFJV
```

## ğŸ“š å‚è€ƒè³‡æ–™

### JRA-VAN å…¬å¼

- [JV-Dataä»•æ§˜æ›¸](https://jra-van.jp/dlb/sdk/document.html)
- [Data Lab SDK](https://jra-van.jp/dlb/)

### ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå†…ãƒªã‚½ãƒ¼ã‚¹

- [ç’°å¢ƒå¤‰æ•°è¨­å®šã‚¬ã‚¤ãƒ‰](../MIGRATION_GUIDE.md)
- [å…±é€šè¨­å®šãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«](../../common/config.py)
- [é¦¬IDå¤‰æ›ãƒ„ãƒ¼ãƒ«](../../scripts/horse_id_mapper.py)

## ğŸ” ãƒ‡ãƒ¼ã‚¿æ¤œç´¢Tips

### é¦¬ã‚’æ¤œç´¢

```powershell
# é¦¬åæ¤œç´¢
python scripts/parse_jv_horse_data.py --search "ãƒ‰ã‚¦ãƒ‡ãƒ¥ãƒ¼ã‚¹"

# é¦¬IDæ¤œç´¢
python scripts/parse_jv_horse_data.py --horse-id 2019103487
```

### èª¿æ•™ãƒ‡ãƒ¼ã‚¿æ¤œç´¢

```powershell
# ç‰¹å®šé¦¬ã®èª¿æ•™ãƒ‡ãƒ¼ã‚¿
python scripts/parse_ck_data.py --horse 2020104764 --date 20260125 --days 14
```

### ãƒ¬ãƒ¼ã‚¹ãƒ‡ãƒ¼ã‚¿æ¤œç´¢

```powershell
# æŒ‡å®šæ—¥ã®ãƒ¬ãƒ¼ã‚¹æƒ…å ±å–å¾—
python scripts/parse_jv_race_data.py --date 2026-01-24
```

## ğŸ’¡ é–‹ç™ºã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³

### æ–°ã—ã„ãƒ‡ãƒ¼ã‚¿ã‚¿ã‚¤ãƒ—ã‚’è¿½åŠ ã™ã‚‹å ´åˆ

1. `docs/jravan/data-types/{TYPE}.md` ã«ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä½œæˆ
2. `common/jravan/{type}_parser.py` ã«ãƒ‘ãƒ¼ã‚µãƒ¼å®Ÿè£…
3. `scripts/parse_{type}_data.py` ã«CLIãƒ„ãƒ¼ãƒ«ä½œæˆ
4. ã“ã®READMEã®ãƒ‡ãƒ¼ã‚¿ã‚¿ã‚¤ãƒ—ä¸€è¦§ã«è¿½åŠ 

### IDå¤‰æ›å‡¦ç†ã‚’è¿½åŠ ã™ã‚‹å ´åˆ

1. `docs/jravan/ID_MAPPING.md` ã«ä»•æ§˜ã‚’è¿½åŠ 
2. `common/jravan/id_converter.py` ã«å®Ÿè£…
3. ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã‚’è¿½åŠ 

---

*æœ€çµ‚æ›´æ–°: 2026-01-30*
