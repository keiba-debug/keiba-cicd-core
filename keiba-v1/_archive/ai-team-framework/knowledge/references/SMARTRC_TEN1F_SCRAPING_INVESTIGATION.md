# SmartRc テン1F スクレイピング可否調査

**調査者**: テンテン（フロントエンド）  
**対象**: https://www.smartrc.jp/v3/ スマート出馬表  
**調査日**: 2026-02-08

---

## 結論

**スクレイピングは技術的に可能**です。テン1Fの値は最終的にDOMの `<td>` にテキストとして描画されているため、適切なセレクタと待機処理で取得できます。

---

## 根拠

### 1. DOM 上のデータ存在

提供いただいた情報より:

- **実際のHTML**: `<td cid="24" class="s-f13-5 s-ta-l" ...>123⑤</td>`
- テン1Fの値（例: `123⑤`）は **プレーンテキスト** として `<td>` 内に格納されている。
- 表示形式: **3桁タイム + 丸数字（順位）**（例: 123⑤ = 12.3秒、5位相当）。

### 2. ページ構造の特徴

- **フレームワーク**: ExtJS（`ext-viewport`, `ext-element-*`, `ext-exgrid-*`, `ext-panel-*` 等）と推測。
- **グリッド**: `table.-rcv .-f13 .-rcv-b` のようなクラスを持つテーブルで、行が `tbody > tr`、セルが `td`。
- **列の識別**: `cid="24"` やクラス `s-f13-5`, `s-ta-l` がテン1F列のセルに付与されている。

### 3. データソース（参考）

SmartRc のテンプレート仕様から、テン1F関連のデータは次のような項目で保持されていると推測されます。

- 出馬表: `ten1f_best` / `ten1f_best_rank`、前走: `h1_ten1f` / `h1_ten1f_rank`
- 表示は `SG.n2rank(...)` により「タイム＋順位丸数字」に変換されてDOMに出力されている。

---

## スクレイピング時の注意点・推奨

### セレクタ

| 方式 | 推奨度 | 備考 |
|------|--------|------|
| `ext-element-*` 等のID | ❌ 非推奨 | セッション/描画ごとに変わる動的IDのため不安定。 |
| `td.s-f13-5.s-ta-l` | ✅ 推奨 | クラスは列の意味で固定されている可能性が高く、安定。 |
| `td[cid="24"]` | △ 要確認 | `cid` が列インデックスで固定なら有効。ページ・タブで変わる可能性あり。 |
| テーブル + 列インデックス | △ 代替案 | ヘッダーから「テン1F」列の index を取得し、各行のその index の `td` を取得。 |

**推奨**: まずは **`table.-rcv table` 内の `td.s-f13-5.s-ta-l`** でテン1Fセルを取得し、行単位で対応する馬と紐付ける方式が扱いやすいです。

### 非同期・描画待ち

- 「Now loading component...」の通り、一覧は **非同期で描画** される。
- スクレイパーでは **グリッドのテーブル（またはテン1Fのセル）が出現するまで待つ** 必要がある（例: 一定時間ポーリング、または要素の出現を検知）。

### ナビゲーション

- トップは「開催一覧」。**特定の日付・競馬場・レースを選択** すると出馬表テーブルが表示される。
- テン1Fを取得するには、「出馬表」タブで **該当レースの出馬表が表示された状態** に遷移してからDOMを解析する必要がある。

### その他

- **ログイン**: 出馬表自体は未ログインでも見られる場合が多いが、利用規約・認証の変更に注意。
- **利用規約**: スクレイピングの可否は SmartRc の利用規約に依存するため、実装前に規約の確認を推奨。

---

## 取得データのパース例（案）

セルテキスト例: `123⑤`

- **タイム**: 先頭の数字部分 → `12.3` 秒（1F = 約200m のタイム）として扱う。
- **順位/評価**: 丸数字 ⑤ → 5位相当など、アプリ側でルールを定義して利用。

正規表現の例: 数値部分と丸数字を分離するなら  
`/^(\d{3})([①②③④⑤⑥⑦⑧⑨⑩]?)$/` などで分解可能（丸数字は環境によりUnicodeで表現が異なる場合あり）。

---

## 次のアクション案

1. **実スクレイパー**: ネジ（ドメイン/API設計）またはリー（バッチ・実行基盤）に、上記セレクタと待機条件を渡して実装を依頼。
2. **APIの有無**: 可能であれば、SmartRc が内部で利用している **API（XHR/Fetch）** を開発者ツールで確認し、API経由で `ten1f_*` を取得できるか検討すると、より安定した取得が期待できる。
3. **WebViewer での表示**: 取得したテン1Fを KeibaCICD.WebViewer で表示する場合は、テンテン（フロント）で型定義・UIコンポーネントを追加。

---

**以上、フロントエンド視点でのテン1Fスクレイピング可否調査でした。**
