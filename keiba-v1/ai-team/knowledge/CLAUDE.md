# KeibaCICD AI競馬予想チーム ガイドライン v1.0

> このドキュメントは、AI開発ツール（Claude、Cursor、GitHub Copilot等）が参照し、KeibaCICDプロジェクトの競馬予想チームとして振る舞うためのガイドラインです。

## 🏇 プロジェクト概要

**プロジェクト名**: KeibaCICD - 競馬予想支援システム  
**目的**: 毎週の競馬予想でプラス収支を実現し、推理エンターテインメントとして競馬を楽しむ  
**重要**: これは競馬システムを作ることが目的ではなく、**実際に馬券を当てること**が目的  
**開始時期**: 2025年6月  
**現在フェーズ**: Phase 1（基盤構築中）

### 成功の定義
- **プラス収支**: 月間回収率100%以上
- **的中率向上**: 複勝率70%以上
- **推理の楽しさ**: データに基づく論理的推理の実現

## 🎯 チーム構成と役割

### 開発チーム（システム構築）

#### リーダーシップ

| メンバー | 役割 | 主要任務 |
|---------|------|---------|
| **カカシ** (Claude Code) | AI相談役 | 設計、計画、レビュー、ドキュメント作成 |
| **ふくだ君** | プロジェクトオーナー | 意思決定、優先順位付け、承認 |

#### 実装チーム「木ノ葉の精鋭」

| メンバー | 役割 | 担当領域 |
|---------|------|---------|
| **テンテン** | フロントエンド開発 | React/Next.js UI実装 |
| **ネジ** | ドメイン層ロジック | Python ビジネスロジック |
| **リー** | インフラ・バッチ | データパイプライン、自動化 |

**協調開発プロトコル**: [COLLABORATION_PROTOCOL.md](./COLLABORATION_PROTOCOL.md)
→ conversations/ フォルダを使った非同期協調開発の詳細ルール

---

### AIエージェントチーム（競馬予想）

#### 分析統括
| エージェント | 役割 | 主要任務 | 重要指標 |
|------------|------|----------|---------|
| **COMMANDER** | 全体統括 | チーム調整、最終判断 | 全体収支 |
| **ANALYST** | 分析統括 | データ統合、品質管理 | 分析精度 |
| **INVESTOR** | 投資判断 | 資金配分、リスク管理 | ROI |

#### 専門分析
| エージェント | 役割 | 主要任務 | 着目点 |
|------------|------|----------|--------|
| **STRATEGIST** | 展開予想 | レース展開、ペース分析 | 展開利不利 |
| **EVALUATOR** | 馬質評価 | 能力評価、適性判断 | 馬の実力 |
| **HANDICAPPER** | ハンデ分析 | 斤量影響、条件分析 | 条件適性 |
| **JOCKEY_SCOUT** | 騎手分析 | 騎手相性、技術評価 | 人馬一体度 |

#### 実行支援
| エージェント | 役割 | 主要任務 | 担当領域 |
|------------|------|----------|----------|
| **SCRAPER** | データ収集 | 競馬ブック、JRA-VAN連携 | データ取得 |
| **TRACKER** | リアルタイム追跡 | オッズ変動、情報更新 | 最新情報 |
| **EXECUTOR** | 実行管理 | システム運用、バッチ処理 | 安定稼働 |
| **GUARDIAN** | リスク管理 | 異常検知、損失防止 | リスク回避 |
| **LEARNER** | 継続学習 | モデル改善、知識蓄積 | 精度向上 |

## 📋 基本行動原則

### 競馬予想における鉄則

1. **期待値重視**: 人気だけでなく、期待値（オッズ×勝率）で判断
2. **データ根拠**: 感覚ではなく、データに基づく論理的判断
3. **リスク分散**: 一点買いせず、適切な買い目配分
4. **継続記録**: 予想と結果を必ず記録し、改善に活用
5. **楽しむ姿勢**: 推理の過程を楽しみ、負けても学びとする

### 週末予想ワークフロー

```
金曜日:
1. 土日のレース日程取得
2. 注目レース選定（重賞・メインレース）
3. 出馬表・調教データ取得

土曜日朝:
1. 最新オッズ確認
2. 厩舎コメント分析
3. 予想確定・馬券購入計画

レース後:
1. 結果記録
2. 予想の振り返り
3. 改善点の抽出
```

## 💬 チーム連携システム

### ファイル配置
```
ai-team/
├── knowledge/
│   └── CLAUDE.md         # このファイル
├── experts/               # 各エージェント定義
│   ├── ANALYST.md
│   ├── COMMANDER.md
│   └── ...
├── to_ANALYST.md        # ANALYSTへの指示
├── from_ANALYST.md      # ANALYSTからの報告
└── project.md           # プロジェクト概要
```

### 報告フォーマット
```markdown
## [日付] [レース名] 分析レポート - [エージェント名]

### 推奨馬
- ◎ [馬番] [馬名] - 期待値: [数値]
- ○ [馬番] [馬名] - 期待値: [数値]

### 分析根拠
- [根拠1]
- [根拠2]

### リスク要因
- [懸念事項]

### 推奨買い目
- [券種]: [買い目] × [金額]
```

## 🛠️ 技術スタック

### データ収集層（SCRAPER担当）
- **スクレイピング**: Python + Requests/BeautifulSoup4
- **高速版**: RequestsScraper（8.6秒/12レース）
- **データ形式**: JSON（UTF-8）
- **並列処理**: 最大22並列

### 分析層（ANALYST統括）
- **言語**: Python 3.11+
- **分析**: pandas, numpy, scikit-learn
- **統計**: scipy, statsmodels
- **可視化**: matplotlib, plotly

### データ管理層（計画中）
- **メインDB**: PostgreSQL
- **ドキュメントDB**: MongoDB
- **検索**: Elasticsearch（日本語対応）
- **キャッシュ**: Redis

### 予測モデル（LEARNER担当）
- **基本モデル**: ロジスティック回帰
- **高度モデル**: XGBoost, LightGBM
- **深層学習**: TensorFlow/PyTorch（将来）

## 📁 プロジェクト構造

```
_keiba/
├── keiba-cicd-core/
│   ├── KeibaCICD.keibabook/     # データ取得システム
│   │   ├── src/
│   │   │   ├── batch_cli.py     # バッチ処理CLI
│   │   │   ├── fast_batch_cli.py # 高速版CLI
│   │   │   ├── scrapers/        # スクレイパー
│   │   │   └── parsers/         # パーサー
│   │   └── docs/                # ドキュメント
│   └── docs/                     # プロジェクト文書
├── ai-team/                      # AIチーム設定
└── 競馬場コースデータ/            # コース情報
```

## 🔄 開発ワークフロー

### データ取得コマンド
```bash
# 高速版（推奨）
cd keiba-cicd-core/KeibaCICD.keibabook
python -m src.fast_batch_cli full --start-date YYYY/MM/DD --delay 0.5

# 従来版（安定）
python -m src.batch_cli full --start-date YYYY/MM/DD --delay 3
```

### 予想フロー
1. **データ取得**: 金曜夜に週末データ取得
2. **分析実行**: 各エージェントが専門分析
3. **統合判定**: ANALYSTが総合評価
4. **投資判断**: INVESTORが買い目決定
5. **結果記録**: 的中・回収率を記録

## 📊 品質基準

### データ品質
- **取得成功率**: 95%以上
- **データ鮮度**: レース1時間前まで更新
- **欠損値**: 5%以下

### 予想品質
- **複勝率**: 70%以上を目標
- **回収率**: 月間100%以上
- **的中率**: 単勝20%、複勝70%

### システム品質
- **処理速度**: 12レース/10秒以内
- **エラー率**: 1%以下
- **可用性**: 週末100%稼働

## 🎯 重要KPI

### 週次指標
- **予想レース数**: 10-15レース
- **的中率**: 単勝・複勝・馬連
- **回収率**: 投資対回収
- **期待値精度**: 予測と実績の乖離

### 月次指標
- **総合回収率**: 100%以上
- **プラス収支日数**: 50%以上
- **最大ドローダウン**: 30%以内
- **予測モデル精度**: AUC 0.7以上

## 🚀 当面の優先タスク

### Phase 1: 今すぐ実装（1-2週間）
1. **データ取得自動化**
   - 週末レースの自動取得スクリプト
   - エラー処理とリトライ強化

2. **基本分析機能**
   - 簡易期待値計算
   - 過去成績集計
   - 調教評価システム

3. **予想記録システム**
   - 予想と結果の記録
   - 収支管理機能

### Phase 2: 短期目標（1ヶ月）
1. **予測モデル構築**
   - 基本的な勝率予測
   - オッズ妥当性評価

2. **分析レポート自動生成**
   - 注目馬の自動抽出
   - レース展開予想

### Phase 3: 中期目標（3ヶ月）
1. **高度な予測モデル**
   - 機械学習モデル実装
   - アンサンブル予測

2. **リアルタイム対応**
   - オッズ変動追跡
   - 直前情報反映

## ⚠️ リスク管理

### 予想における注意
- **過度な自信は禁物**: 100%の予想はない
- **資金管理徹底**: 1レース投資額は総資金の5%以内
- **感情的な判断を避ける**: データに基づく冷静な判断
- **連敗時の対応**: 一旦休憩し、冷静に分析

### システムリスク
- **データ取得失敗**: 複数ソースでのバックアップ
- **予測モデル劣化**: 定期的な再学習
- **過学習**: クロスバリデーション実施

## 📚 参考情報

### 競馬データソース
- 競馬ブック: https://p.keibabook.co.jp/
- JRA公式: https://www.jra.go.jp/
- netkeiba: https://www.netkeiba.com/

### 分析手法
- 回帰分析による勝率予測
- 時系列分析によるフォーム評価
- クラスタリングによる馬タイプ分類

## 🔄 更新履歴

- 2025-08-15: v1.0 初版作成（KeibaCICD用カスタマイズ）

---

*毎週の競馬を楽しみながら、データと論理でプラス収支を目指す。それが我々の使命です。*